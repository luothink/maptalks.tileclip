export default `(function(t){"use strict";function e(t,e){n(t.geometry,e)}function n(t,e){if(t)switch(t.type){case"Point":o(t.coordinates,e);break;case"MultiPoint":case"LineString":r(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let n=0,o=t.length;n<o;n++)r(t[n],e)}(t.coordinates,e);break;case"Polygon":i(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let n=0,o=t.length;n<o;n++)i(t[n],e)}(t.coordinates,e);break;case"GeometryCollection":const a=t.geometries.length;for(let o=0;o<a;o++)n(t.geometries[o],e)}}function o(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function r(t,e){for(let n=0,r=t.length;n<r;n++)o(t[n],e)}function i(t,e){t.length&&r(t[0],e)}var a=function(t){let o=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const r=t.features.length;for(let n=0;n<r;n++)e(t.features[n],o);break;case"Feature":e(t,o);break;default:n(t,o)}return o},s=h;function h(t,e,n){var o,r,i,a,s,h=t.length,u=l(t[0],e),f=[];for(n||(n=[]),o=1;o<h;o++){for(r=t[o-1],a=s=l(i=t[o],e);;){if(!(u|a)){f.push(r),a!==s?(f.push(i),o<h-1&&(n.push(f),f=[])):o===h-1&&f.push(i);break}if(u&a)break;u?u=l(r=c(r,i,u,e),e):a=l(i=c(r,i,a,e),e)}u=s}return f.length&&n.push(f),n}function c(t,e,n,o){return 8&n?[t[0]+(e[0]-t[0])*(o[3]-t[1])/(e[1]-t[1]),o[3]]:4&n?[t[0]+(e[0]-t[0])*(o[1]-t[1])/(e[1]-t[1]),o[1]]:2&n?[o[2],t[1]+(e[1]-t[1])*(o[2]-t[0])/(e[0]-t[0])]:1&n?[o[0],t[1]+(e[1]-t[1])*(o[0]-t[0])/(e[0]-t[0])]:null}function l(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function u(t){return"number"==typeof t}function f(t){return new Error(t)}function m(t){return Array.isArray(t)?t:[t]}h.polyline=h,h.polygon=function(t,e){var n,o,r,i,a,s,h;for(o=1;o<=8;o*=2){for(n=[],i=!(l(r=t[t.length-1],e)&o),a=0;a<t.length;a++)(h=!(l(s=t[a],e)&o))!==i&&n.push(c(r,s,o,e)),h&&n.push(s),r=s,i=h;if(!(t=n).length)break}return n};const d=f("not find canvas.The current environment does not support OffscreenCanvas");function g(t){const[e,n]=t,o=6378137,r=e*Math.PI/180*o,i=n*Math.PI/180;return[r,3189068.5*Math.log((1+Math.sin(i))/(1-Math.sin(i)))]}const p=f("fetch tile data cancel"),M=f("fetch tile data timeout");function b(t){return"EPSG:3857"===t}let x;function v(t=256){return!x&&OffscreenCanvas&&(x=new OffscreenCanvas(1,1)),x&&I(x,t,t),x}function I(t,e,n){t&&(t.width=e,t.height=n)}function y(t){const e=t.getContext("2d",{willReadFrequently:!0});return function(t){const e=t.canvas;t.clearRect(0,0,e.width,e.height)}(e),e}function w(t){const e=v(t);return y(e),e.transferToImageBitmap()}function z(t){if(1===t.length)return t[0];if(0===t.length)return f("merge tiles error,not find imagebitmaps");for(let e=0,n=t.length;e<n;e++){if(!(t[e]instanceof ImageBitmap))return f("merge tiles error,images not imagebitmap")}const e=t[0].width,n=v(e),o=y(n);return t.forEach((t=>{o.drawImage(t,0,0,e,e)})),n.transferToImageBitmap()}function P(t,e,n){const o=y(t);o.save();o.beginPath(),e.forEach((t=>{(t=>{for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n[0],i=n[n.length-1],[a,s]=r,[h,c]=i;a===h&&s===c||n.push(r);for(let t=0,e=n.length;t<e;t++){const[e,r]=n[t];0===t?o.moveTo(e,r):o.lineTo(e,r)}}})(t)})),o.clip("evenodd"),o.drawImage(n,0,0,t.width,t.height);const r=t.transferToImageBitmap();return o.restore(),r}function k(t){const e=v();I(e,t.width,t.height);return y(e).drawImage(t,0,0),e.convertToBlob()}function T(t,e,n){if(!n)return e;I(t,e.width,e.height);const o=y(t);o.save(),o.filter=n,o.drawImage(e,0,0),o.restore();return t.transferToImageBitmap()}function B(t,e=1){if(!u(e)||1===e||e<0||e>1)return t;const n=v();I(n,t.width,t.height);const o=y(n);o.globalAlpha=e,o.drawImage(t,0,0);const r=n.transferToImageBitmap();return o.globalAlpha=1,r}function A(t){const[e,n,o,r]=t;return[[e,n],[o,n],[o,r],[e,r]]}function E(t){let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach((t=>{e=Math.min(e,t[0]),o=Math.max(o,t[0]),n=Math.min(n,t[1]),r=Math.max(r,t[1])})),[e,n,o,r]}const O={};function R(t,e){return function(t){if(!t)return!1;const e=(t.geometry||{type:null}).type;return"Polygon"===e||"MultiPolygon"===e}(e)?O[t]?f("the"+t+" geojson Already exists"):(O[t]=e,function(t){t.bbox=t.bbox||a(t)}(e),e):f("geojson.feature is not Polygon")}function C(t,e){if(b(t)){const t=e=>{const n=[];for(let o=0,r=e.length;o<r;o++){const r=e[o];Array.isArray(r[0])?n.push(t(r)):n[o]=g(r)}return n};return t(e)}return e}function N(t,e,n){const[o,r,i,a]=t,s=(i-o)/e,h=(a-r)/e,[c,l]=n;return[(c-o)/s,e-(l-r)/h]}function S(t,e,n,o){const[r,i,a,s]=e,h=(t,e)=>{const o=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];Array.isArray(i[0])?o.push(h(i,e)):o[r]=N(e,n,i)}return o};if(b(t)){const[t,e]=g([r,i]),[n,c]=g([a,s]);return h(o,[t,e,n,c])}return h(o,e)}const j=()=>{};const L={accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.26"},U=new class{constructor(t,e){this.max=t,this.onRemove=e||j,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):(this.data.set(t,e),this.data.size>this.max&&this.shrink()),this):this}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const o of n)t[e++]=o;return t}shrink(){const t=this.data.keys();let e=t.next();for(;this.data.size>this.max;){const n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){if(!this.has(t))return null;return this.data.get(t)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.data.size>this.max&&this.shrink(),this}}(200,(t=>{t&&t.close&&t.close()}));const Y={};function G(t){const e=[];for(let n in Y){const o=Y[n]||[];if(o.length){const e=o.indexOf(t);e>-1&&o.splice(e,1)}0===o.length&&e.push(n)}e.forEach((t=>{delete Y[t]}))}function _(t,e={},n){return new Promise(((o,r)=>{const i=t=>{createImageBitmap(t).then((t=>{o(t)})).catch((t=>{r(t)}))},a=n.__taskId;if(!a)return void r(f("taskId is null"));const s=U.get(t);if(s)i(s);else{const o=n.fetchOptions||{headers:e,referrer:n.referrer},s=n.timeout||0,h=new AbortController,c=h.signal;s&&u(s)&&s>0&&setTimeout((()=>{h.abort(M)}),s),o.signal=c,delete o.timeout,function(t,e){Y[t]=Y[t]||[],Y[t].push(e)}(a,h),fetch(t,o).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((e=>{U.add(t,e),G(h),i(e)})).catch((t=>{G(h),r(t)}))}}))}function F(t){const{urlTemplate:e,x:n,y:o,z:r,maxAvailableZoom:i,subdomains:a,returnBlobURL:s}=t,h=i&&u(i)&&i>=1;return new Promise(((c,l)=>{if(!h)return void l(f("maxAvailableZoom is error"));if(!e)return void l(f("urlTemplate is error"));if(!u(n)||!u(o)||!u(r))return void l(f("x/y/z is error"));const g=m(e);for(let t=0,e=g.length;t<e;t++){const e=g[t];if(e&&e.indexOf("{s}")>-1&&(!a||0===a.length))return void l(f("not find subdomains"))}let p,M,b,x,w=n,P=o,A=r;const E=r-i;if(E>0){let t=n,e=o,a=r;for(;a>i;)t=Math.floor(t/2),e=Math.floor(e/2),a--;const s=Math.pow(2,E);let h=Math.floor(t*s),c=h+s,l=Math.floor(e*s),u=l+s;h>n&&(h--,c--),l>o&&(l--,u--),p=(n-h)/(c-h),M=(o-l)/(u-l),b=1/(c-h),x=1/(u-l),w=t,P=e,A=i}const O=g.map((t=>{let e="{x}";for(;t.indexOf(e)>-1;)t=t.replace(e,w);for(e="{y}";t.indexOf(e)>-1;)t=t.replace(e,P);for(e="{z}";t.indexOf(e)>-1;)t=t.replace(e,A);return function(t,e){if(!e||!e.length)return t;const n=e.length;let o=Math.floor(Math.random()*n);for(o=Math.min(o,n-1);t.indexOf("{s}")>-1;)t=t.replace("{s}",e[o]);return t}(t,a)})),R=Object.assign({},L,t.headers||{}),C=O.map((e=>_(e,R,t)));Promise.all(C).then((e=>{const n=v();if(!n)return void l(d);const o=z(e);if(o instanceof Error)return void l(o);let r;const i=t.filter;let a;if(r=i?T(n,o,i):o,E<=0)a=B(r,t.opacity);else{const{width:e,height:o}=r,i=function(t,e,n,o,r,i){I(t,e.width,e.height);const a=y(t);return a.save(),a.drawImage(e,n,o,r,i,0,0,t.width,t.height),a.restore(),t.transferToImageBitmap()}(n,r,e*p,o*M,e*b,o*x);a=B(i,t.opacity)}s?k(a).then((t=>{const e=URL.createObjectURL(t);c(e)})).catch((t=>{l(t)})):c(a)})).catch((t=>{l(t)}))}))}const W=Math.PI/180,D=180/Math.PI,Z=6378137,V=20037508.342789244,X="900913",q={};function K(t){return Number(t)===t&&t%1!=0}const H=256,J=[-180,90],Q=[-20037508.342787,20037508.342787],$=["EPSG:4326","EPSG:3857"],tt=new class{#t;#e;#n;#o;#r;#i;constructor(t={}){if(this.#t=t.size||256,this.#e=t.antimeridian?2:1,!q[this.#t]){let t=this.#t;const e=q[this.#t]={};e.Bc=[],e.Cc=[],e.zc=[],e.Ac=[];for(let n=0;n<30;n++)e.Bc.push(t/360),e.Cc.push(t/(2*Math.PI)),e.zc.push(t/2),e.Ac.push(t),t*=2}this.#n=q[this.#t].Bc,this.#o=q[this.#t].Cc,this.#r=q[this.#t].zc,this.#i=q[this.#t].Ac}px(t,e){if(K(e)){const n=this.#t*Math.pow(2,e),o=n/2,r=n/360,i=n/(2*Math.PI),a=n,s=Math.min(Math.max(Math.sin(W*t[1]),-.9999),.9999);let h=o+t[0]*r,c=o+.5*Math.log((1+s)/(1-s))*-i;return h>a*this.#e&&(h=a*this.#e),c>a&&(c=a),[h,c]}{const n=this.#r[e],o=Math.min(Math.max(Math.sin(W*t[1]),-.9999),.9999);let r=Math.round(n+t[0]*this.#n[e]),i=Math.round(n+.5*Math.log((1+o)/(1-o))*-this.#o[e]);return r>this.#i[e]*this.#e&&(r=this.#i[e]*this.#e),i>this.#i[e]&&(i=this.#i[e]),[r,i]}}ll(t,e){if(K(e)){const n=this.#t*Math.pow(2,e),o=n/360,r=n/(2*Math.PI),i=n/2,a=(t[1]-i)/-r;return[(t[0]-i)/o,D*(2*Math.atan(Math.exp(a))-.5*Math.PI)]}{const n=(t[1]-this.#r[e])/-this.#o[e];return[(t[0]-this.#r[e])/this.#n[e],D*(2*Math.atan(Math.exp(n))-.5*Math.PI)]}}convert(t,e){return e===X?[...this.forward(t.slice(0,2)),...this.forward(t.slice(2,4))]:[...this.inverse(t.slice(0,2)),...this.inverse(t.slice(2,4))]}inverse(t){return[t[0]*D/Z,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/Z)))*D]}forward(t){const e=[Z*t[0]*W,Z*Math.log(Math.tan(.25*Math.PI+.5*t[1]*W))];return e[0]>V&&(e[0]=V),e[0]<-V&&(e[0]=-V),e[1]>V&&(e[1]=V),e[1]<-V&&(e[1]=-V),e}bbox(t,e,n,o,r){o&&(e=Math.pow(2,n)-1-e);const i=[t*this.#t,(+e+1)*this.#t],a=[(+t+1)*this.#t,e*this.#t],s=[...this.ll(i,n),...this.ll(a,n)];return r===X?this.convert(s,X):s}xyz(t,e,n,o){const r=o===X?this.convert(t,"WGS84"):t,i=[r[0],r[1]],a=[r[2],r[3]],s=this.px(i,e),h=this.px(a,e),c=[Math.floor(s[0]/this.#t),Math.floor((h[0]-1)/this.#t)],l=[Math.floor(h[1]/this.#t),Math.floor((s[1]-1)/this.#t)],u={minX:Math.min.apply(Math,c)<0?0:Math.min.apply(Math,c),minY:Math.min.apply(Math,l)<0?0:Math.min.apply(Math,l),maxX:Math.max.apply(Math,c),maxY:Math.max.apply(Math,l)};if(n){const t={minY:Math.pow(2,e)-1-u.maxY,maxY:Math.pow(2,e)-1-u.minY};u.minY=t.minY,u.maxY=t.maxY}return u}}({size:H});function et(t){return 1.40625/Math.pow(2,t)}function nt(t,e,n,o=0){o=o||0;const[r,i]=Q,a=(s=n,156543.03392804097/Math.pow(2,s)*H);var s;const h=function(t,e,n){const[o,r]=J,i=et(n)*H;let a=t,s=e;return a=Math.floor(a),s=Math.floor(s),[o+a*i,s*i-r,o+(a+1)*i,(s+1)*i-r]}(t,e,n),c=E(A(h).map((t=>tt.forward(t)))),[l,u,f,m]=c;let d=(l-r)/a,g=(f-r)/a,p=(i-m)/a,M=(i-u)/a;if(d=Math.floor(d),g=Math.floor(g),p=Math.floor(p),M=Math.floor(M),g<d||M<p)return;const b=[];for(let t=p;t<=M;t++)for(let e=d;e<=g;e++)b.push([e,t,n+o]);const x=b.map((t=>{const[e,n,o]=t;return tt.bbox(e,n,o,!1,"900913")})),[v,I,y,w]=function(t){let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach((t=>{const[i,a,s,h]=t;e=Math.min(e,i),o=Math.max(o,s),n=Math.min(n,a),r=Math.max(r,h)})),[e,n,o,r]}(x);return{tiles:b,tilesbbox:[v,I,y,w],bbox:h,mbbox:c,x:t,y:e,z:n}}function ot(t,e,n,o){const{width:r,height:i}=t,[a,s,h,c]=e,l=(h-a)/r,u=(c-s)/i;let[f,m,d,g]=n;f-=l,d+=l,m-=u,g+=u;let p=(f-a)/l,M=(c-g)/u,b=(d-a)/l,x=(c-m)/u;p=Math.floor(p),M=Math.floor(M),b=Math.ceil(b),x=Math.ceil(x);const w=b-p,z=x-M,P=v();I(P,w,z);const k=y(P);k.drawImage(t,p,M,w,z,0,0,w,z);const T=k.getImageData(0,0,w,z).data,B=[];let A=1/0,E=1/0,O=-1/0,R=-1/0,C=-1;const N="EPSG:4326"===o?tt.forward:tt.inverse;for(let t=1;t<=z;t++){const e=g-(t-1)*u,n=e-u;for(let o=1;o<=w;o++){const r=(t-1)*w*4+4*(o-1),i=T[r],a=T[r+1],s=T[r+2],h=T[r+3],c=f+(o-1)*l,u=N([c,e]);A=Math.min(A,u[0]),O=Math.max(O,u[0]),E=Math.min(E,u[1]),R=Math.max(R,u[1]);const m=[c,n];B[++C]={point:u,point1:N(m),r:i,g:a,b:s,a:h}}}return{pixels:B,bbox:[A,E,O,R],width:w,height:z,image:P.transferToImageBitmap()}}function rt(t,e,n){const[o,r,i,a]=e,s=(i-o)/H,h=(a-r)/H,{pixels:c,bbox:l}=t,[u,f,m,d]=l;let g=(m-u)/s,p=(d-f)/h;if(g=Math.round(g),p=Math.round(p),isNaN(g)||isNaN(p)||0===Math.min(g,p)||Math.abs(g)===1/0||Math.abs(p)===1/0)return;const M=v();I(M,g,p);const b=y(M);function x(t,e){let n=Math.round((t-u)/s+1);n=Math.min(n,g);let o=Math.round((d-e)/h+1);return o=Math.min(o,p),[n,o]}const w=b.createImageData(g,p),z=w.data;for(let t=0,e=c.length;t<e;t++){const{point:e,point1:n,r:o,g:r,b:i,a:a}=c[t],[s,h]=e,[l,u]=n,[f,m]=x(s,h),[d,p]=x(l,u);for(let t=m;t<=p;t++){const e=(t-1)*g*4+4*(f-1);z[e]=o,z[e+1]=r,z[e+2]=i,z[e+3]=a}}b.putImageData(w,0,0);const P=M.transferToImageBitmap(),k=Math.round((o-u)/s),T=Math.round((d-a)/h),B=v();I(B,H,H);const A=y(M);return A.drawImage(P,k-1,T,H,H,0,0,H,H),function(t){const e=t.canvas,{width:n,height:o}=e,r=t.getImageData(0,0,n,o),i=r.data,a=()=>{for(let t=1;t<=o;t++){if(i[4*n*(t-1)+0+3]>0)return!1}return!0},s=()=>{for(let t=1;t<=n;t++){if(i[4*(t-1)+(o-1)*n*4+3]>0)return!1}return!0};if(a())for(let t=1;t<=o;t++){const e=4*n*(t-1)+0,o=e+4,r=i[o],a=i[o+1],s=i[o+2],h=i[o+3];i[e]=r,i[e+1]=a,i[e+2]=s,i[e+3]=h}if(s())for(let t=1;t<=n;t++){const e=4*(t-1)+(o-1)*n*4,r=4*(t-1)+(o-2)*n*4,a=i[r],s=i[r+1],h=i[r+2],c=i[r+3];i[e]=a,i[e+1]=s,i[e+2]=h,i[e+3]=c}t.putImageData(r,0,0)}(A),n&&(A.lineWidth=.4,A.strokeStyle="red",A.rect(0,0,H,H),A.stroke()),B.transferToImageBitmap()}function it(t){return new Promise(((e,n)=>{const{urlTemplate:o,x:r,y:i,z:a,maxAvailableZoom:s,projection:h,zoomOffset:c,errorLog:l,debug:m,returnBlobURL:d}=t,p=s&&u(s)&&s>=1;if(!h)return void n(f("not find projection"));if(-1===$.indexOf(h))return void n(f("not support projection:"+h+".the support:"+$.join(",").toString()));if(!p)return void n(f("maxAvailableZoom is error"));if(!o)return void n(f("urlTemplate is error"));if(!u(r)||!u(i)||!u(a))return void n(f("x/y/z is error"));const M=t=>{d?k(t).then((t=>{const n=URL.createObjectURL(t);e(n)})).catch((t=>{n(t)})):e(t)};(()=>{let e;"EPSG:4326"===h?e=function(t,e,n,o=0){o=o||0;const[r,i]=J,a=et(n)*H,s=tt.bbox(t,e,n),[h,c,l,u]=s;let f=(h-r)/a,m=(l-r)/a,d=(i-u)/a,p=(i-c)/a;if(f=Math.floor(f),m=Math.floor(m),d=Math.floor(d),p=Math.floor(p),m<f||p<d)return;const M=[];for(let t=d;t<=p;t++)for(let e=f;e<=m;e++)M.push([e-1,t,n+o]);return{tiles:M,tilesbbox:[r+(f-1)*a,i-(p+1)*a,r+m*a,i-d*a],bbox:s,mbbox:E(A(s).map((t=>g(t)))),x:t,y:e,z:n}}(r,i,a,c||0):"EPSG:3857"===h&&(e=nt(r,i,a,c||0));const{tiles:n}=e||{};if(!n||0===n.length)return void M(w());e.loadCount=0;const o=()=>{if(e.loadCount>=n.length){const t=function(t,e){let n=1/0,o=1/0,r=-1/0,i=-1/0,a=256;t.forEach((t=>{const[e,s]=t;n=Math.min(e,n),o=Math.min(s,o),r=Math.max(e,r),i=Math.max(s,i),a=t.tileImage.width}));const s=(r-n+1)*a,h=(i-o+1)*a,c=v();I(c,s,h);const l=y(c);return e&&(l.font="bold 48px serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="red"),t.forEach((t=>{const[r,i,s]=t,h=(r-n)*a,c=(i-o)*a;let u=t.tileImage;l.drawImage(u,h,c,a,a),e&&l.fillText([r,i,s].join("_").toString(),h+100,c+100)})),c.transferToImageBitmap()}(n,m);let o;if("EPSG:4326"===h){o=rt(ot(t,e.tilesbbox,e.bbox,h),e.mbbox,m),M(o||w())}else{o=rt(ot(t,e.tilesbbox,e.mbbox,h),e.bbox,m),M(o||w())}}else{const r=n[e.loadCount],[i,a,s]=r;F(Object.assign({},t,{x:i,y:a,z:s,returnBlobURL:!1})).then((t=>{r.tileImage=t,e.loadCount++,o()})).catch((t=>{l&&console.error(t),r.tileImage=w(),e.loadCount++,o()}))}};o()})()}))}function at(t){const e=[];return t&&t instanceof ImageBitmap&&e.push(t),e}t.initialize=function(){},t.onmessage=function(t,e){const n=t.data||{},o=n._type;if("getTile"!==o){var r;if("getTileWithMaxZoom"!==o)if("clipTile"!==o)if("transformTile"!==o){if("injectMask"===o){const t=R(n.maskId,n.geojsonFeature);return t instanceof Error?void e(t):void e()}if("removeMask"===o)return i=n.maskId,delete O[i],void e();var i;if("cancelFetch"===o){const t=n.taskId||n.__taskId;return t?(function(t){const e=Y[t]||[];e.length&&e.forEach((t=>{t.abort(p)})),delete Y[t]}(t),void e()):void e(f("cancelFetch need taskId"))}console.error("not support message type:",o)}else it(n).then((t=>{e(null,t,at(t))})).catch((t=>{e(t)}));else(r=n,new Promise(((t,e)=>{const{tile:n,tileBBOX:o,projection:i,tileSize:a,maskId:h,returnBlobURL:c}=r;if(!n)return void e(f("tile is null.It should be a ImageBitmap"));if(!o)return void e(f("tileBBOX is null"));if(!i)return void e(f("projection is null"));if(!a)return void e(f("tileSize is null"));if(!h)return void e(f("maskId is null"));const l=O[h];if(!l)return void e(f("not find mask by maskId:"+h));const u=v(a);if(!u)return void e(d);const m=n=>{c?k(n).then((e=>{const n=URL.createObjectURL(e);t(n)})).catch((t=>{e(t)})):t(n)},g=l.bbox;if(!g)return void m(n);const{coordinates:p,type:M}=l.geometry;if(!p.length)return void m(n);if(x=o,(b=g)[2]<x[0]||b[1]>x[3]||b[0]>x[2]||b[3]<x[1])return void m(w(a));var b,x;let I,y=p;if("Polygon"===M&&(y=[y]),function(t,e){const[n,o,r,i]=t;return n>=e[0]&&r<=e[2]&&o>=e[1]&&i<=e[3]}(g,o))return I=C(i,y),void m(P(u,S(i,o,a,I),n));const z=t=>{if(t.length>0){let e=1/0,n=-1/0,o=1/0,r=-1/0;for(let i=0,a=t.length;i<a;i++){const[a,s]=t[i];e=Math.min(a,e),o=Math.min(s,o),n=Math.max(a,n),r=Math.max(s,r)}if(e!==n&&o!==r)return!0}return!1},T=[];for(let t=0,e=y.length;t<e;t++){const e=y[t];for(let t=0,n=e.length;t<n;t++){const n=e[t],r=s.polygon(n,o);z(r)&&T.push([r])}}0!==T.length?(I=C(i,T),m(P(u,S(i,o,a,I),n))):m(w())}))).then((t=>{e(null,t,at(t))})).catch((t=>{e(t)}));else F(n).then((t=>{e(null,t,at(t))})).catch((t=>{e(t)}))}else{const{url:t}=n;(function(t,e){return new Promise(((n,o)=>{if(!t)return void o(f("url is null"));const r=m(t),i=Object.assign({},L,e.headers||{}),a=r.map((t=>_(t,i,e))),{returnBlobURL:s}=e;Promise.all(a).then((t=>{const r=v();if(!r)return void o(d);const i=z(t);if(i instanceof Error)return void o(i);const a=e.filter;let h;h=a?T(r,i,a):i;const c=B(h,e.opacity);s?k(c).then((t=>{const e=URL.createObjectURL(t);n(e)})).catch((t=>{o(t)})):n(c)})).catch((t=>{o(t)}))}))})(t,n).then((t=>{e(null,t,at(t))})).catch((t=>{e(t)}))}},Object.defineProperty(t,"__esModule",{value:!0})})`
