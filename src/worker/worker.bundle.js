export default `(function(t){"use strict";function e(t){return"number"==typeof t}function n(t){return new Error(t)}function o(t){return Array.isArray(t)?t:[t]}const r=n("not find canvas.The current environment does not support OffscreenCanvas");function i(t){const[e,n]=t,o=6378137,r=e*Math.PI/180*o,i=n*Math.PI/180;return[r,3189068.5*Math.log((1+Math.sin(i))/(1-Math.sin(i)))]}const a=n("fetch tile data cancel"),s=n("fetch tile data timeout");function c(t){return"EPSG:3857"===t}const h={accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.26"};let l,u=0;function f(t){Array.isArray(t)||(t=[t]),t.forEach((t=>{t&&t.close&&t.close()}))}function m(t=256){return!l&&OffscreenCanvas&&(l=new OffscreenCanvas(1,1)),l&&d(l,t,t),l}function d(t,e,n){t&&(t.width=e,t.height=n)}function g(t){const e=t.getContext("2d",{willReadFrequently:!0});return function(t){const e=t.canvas;t.clearRect(0,0,e.width,e.height)}(e),e}function p(t){const e=m(t);return g(e),e.transferToImageBitmap()}function M(t){if(1===t.length)return t[0];if(0===t.length)return n("merge tiles error,not find imagebitmaps");for(let e=0,o=t.length;e<o;e++){if(!(t[e]instanceof ImageBitmap))return n("merge tiles error,images not imagebitmap")}const e=t[0].width,o=m(e),r=g(o);return t.forEach((t=>{r.drawImage(t,0,0,e,e)})),f(t),o.transferToImageBitmap()}function b(t,e,n){const o=g(t);o.save();o.beginPath(),e.forEach((t=>{(t=>{for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n[0],i=n[n.length-1],[a,s]=r,[c,h]=i;a===c&&s===h||n.push(r);for(let t=0,e=n.length;t<e;t++){const[e,r]=n[t];0===t?o.moveTo(e,r):o.lineTo(e,r)}}})(t)})),o.clip("evenodd"),o.drawImage(n,0,0,t.width,t.height);const r=t.transferToImageBitmap();return o.restore(),f(n),r}function x(t){const e=m();d(e,t.width,t.height);return g(e).drawImage(t,0,0),f(t),e.convertToBlob()}function v(t,e,n){if(!n)return e;d(t,e.width,e.height);const o=g(t);o.save(),o.filter=n,o.drawImage(e,0,0),o.restore();const r=t.transferToImageBitmap();return f(e),r}function I(t,n=1){if(!e(n)||1===n||n<0||n>1)return t;const o=m();d(o,t.width,t.height);const r=g(o);r.globalAlpha=n,r.drawImage(t,0,0);const i=o.transferToImageBitmap();return r.globalAlpha=1,f(t),i}const w=()=>{};const y=new class{constructor(t,e){this.max=t,this.onRemove=e||w,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):(this.data.set(t,e),this.data.size>this.max&&this.shrink()),this):this}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const o of n)t[e++]=o;return t}shrink(){const t=this.data.keys();let e=t.next();for(;this.data.size>this.max;){const n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){if(!this.has(t))return null;return this.data.get(t)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.data.size>this.max&&this.shrink(),this}}(200,(t=>{f(t)}));const z={};function P(t){const e=[];for(let n in z){const o=z[n]||[];if(o.length){const e=o.indexOf(t);e>-1&&o.splice(e,1)}0===o.length&&e.push(n)}e.forEach((t=>{delete z[t]}))}function B(t,o={},r){return new Promise(((i,a)=>{const c=t=>{createImageBitmap(t).then((t=>{i(t)})).catch((t=>{a(t)}))},h=r.__taskId;if(!h)return void a(n("taskId is null"));const l=y.get(t);if(l)c(l);else{const n=r.fetchOptions||{headers:o,referrer:r.referrer},i=r.timeout||0,l=new AbortController,u=l.signal;i&&e(i)&&i>0&&setTimeout((()=>{l.abort(s)}),i),n.signal=u,delete n.timeout,function(t,e){z[t]=z[t]||[],z[t].push(e)}(h,l),fetch(t,n).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((e=>{!0!==r.disableCache&&y.add(t,e),P(l),c(e)})).catch((t=>{P(l),a(t)}))}}))}function T(t){const{urlTemplate:i,x:a,y:s,z:c,maxAvailableZoom:l,subdomains:u,returnBlobURL:p}=t,b=l&&e(l)&&l>=1;return new Promise(((w,y)=>{if(!b)return void y(n("maxAvailableZoom is error"));if(!i)return void y(n("urlTemplate is error"));if(!e(a)||!e(s)||!e(c))return void y(n("x/y/z is error"));const z=o(i);for(let t=0,e=z.length;t<e;t++){const e=z[t];if(e&&e.indexOf("{s}")>-1&&(!u||0===u.length))return void y(n("not find subdomains"))}let P,T,k,A,E=a,O=s,R=c;const C=c-l;if(C>0){let t=a,e=s,n=c;for(;n>l;)t=Math.floor(t/2),e=Math.floor(e/2),n--;const o=Math.pow(2,C);let r=Math.floor(t*o),i=r+o,h=Math.floor(e*o),u=h+o;r>a&&(r--,i--),h>s&&(h--,u--),P=(a-r)/(i-r),T=(s-h)/(u-h),k=1/(i-r),A=1/(u-h),E=t,O=e,R=l}const j=z.map((t=>{let e="{x}";for(;t.indexOf(e)>-1;)t=t.replace(e,E);for(e="{y}";t.indexOf(e)>-1;)t=t.replace(e,O);for(e="{z}";t.indexOf(e)>-1;)t=t.replace(e,R);return function(t,e){if(!e||!e.length)return t;const n=e.length;let o=Math.floor(Math.random()*n);for(o=Math.min(o,n-1);t.indexOf("{s}")>-1;)t=t.replace("{s}",e[o]);return t}(t,u)})),S=Object.assign({},h,t.headers||{}),L=j.map((e=>B(e,S,t)));Promise.all(L).then((e=>{const n=m();if(!n)return void y(r);const o=M(e);if(o instanceof Error)return void y(o);let i;const a=t.filter;let s;if(i=a?v(n,o,a):o,C<=0)s=I(i,t.opacity);else{const{width:e,height:o}=i,r=function(t,e,n,o,r,i){d(t,e.width,e.height);const a=g(t);a.save(),a.drawImage(e,n,o,r,i,0,0,t.width,t.height),a.restore();const s=t.transferToImageBitmap();return f(e),s}(n,i,e*P,o*T,e*k,o*A);s=I(r,t.opacity)}p?x(s).then((t=>{const e=URL.createObjectURL(t);w(e)})).catch((t=>{y(t)})):w(s)})).catch((t=>{y(t)}))}))}const k=512;function A(t){return new Promise(((e,n)=>{const o=t.debug,r=t.items,i=t._workerId,a=[];r.forEach(((t,s)=>{const c=new OffscreenCanvas(t.width,t.height);g(c).drawImage(t.image,0,0),o&&console.log("workerId:"+i+",image to blob url :"+(s+1)+"/"+r.length),c.convertToBlob().then((n=>{const o=URL.createObjectURL(n);t.url=o,a.push(1),f(t.image),delete t.image,a.length===r.length&&e(r)})).catch((t=>{console.error(t),n(t)}))}))}))}function E(t,e){O(t.geometry,e)}function O(t,e){if(t)switch(t.type){case"Point":R(t.coordinates,e);break;case"MultiPoint":case"LineString":C(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let n=0,o=t.length;n<o;n++)C(t[n],e)}(t.coordinates,e);break;case"Polygon":j(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let n=0,o=t.length;n<o;n++)j(t[n],e)}(t.coordinates,e);break;case"GeometryCollection":const n=t.geometries.length;for(let o=0;o<n;o++)O(t.geometries[o],e)}}function R(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function C(t,e){for(let n=0,o=t.length;n<o;n++)R(t[n],e)}function j(t,e){t.length&&C(t[0],e)}var S=function(t){let e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const n=t.features.length;for(let o=0;o<n;o++)E(t.features[o],e);break;case"Feature":E(t,e);break;default:O(t,e)}return e},L=N;function N(t,e,n){var o,r,i,a,s,c=t.length,h=Y(t[0],e),l=[];for(n||(n=[]),o=1;o<c;o++){for(r=t[o-1],a=s=Y(i=t[o],e);;){if(!(h|a)){l.push(r),a!==s?(l.push(i),o<c-1&&(n.push(l),l=[])):o===c-1&&l.push(i);break}if(h&a)break;h?h=Y(r=U(r,i,h,e),e):a=Y(i=U(r,i,a,e),e)}h=s}return l.length&&n.push(l),n}function U(t,e,n,o){return 8&n?[t[0]+(e[0]-t[0])*(o[3]-t[1])/(e[1]-t[1]),o[3]]:4&n?[t[0]+(e[0]-t[0])*(o[1]-t[1])/(e[1]-t[1]),o[1]]:2&n?[o[2],t[1]+(e[1]-t[1])*(o[2]-t[0])/(e[0]-t[0])]:1&n?[o[0],t[1]+(e[1]-t[1])*(o[0]-t[0])/(e[0]-t[0])]:null}function Y(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function _(t){const[e,n,o,r]=t;return[[e,n],[o,n],[o,r],[e,r]]}function G(t){let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach((t=>{e=Math.min(e,t[0]),o=Math.max(o,t[0]),n=Math.min(n,t[1]),r=Math.max(r,t[1])})),[e,n,o,r]}N.polyline=N,N.polygon=function(t,e){var n,o,r,i,a,s,c;for(o=1;o<=8;o*=2){for(n=[],i=!(Y(r=t[t.length-1],e)&o),a=0;a<t.length;a++)(c=!(Y(s=t[a],e)&o))!==i&&n.push(U(r,s,o,e)),c&&n.push(s),r=s,i=c;if(!(t=n).length)break}return n};const F={};function W(t,e){return function(t){if(!t)return!1;const e=(t.geometry||{type:null}).type;return"Polygon"===e||"MultiPolygon"===e}(e)?F[t]?n("the"+t+" geojson Already exists"):(F[t]=e,function(t){t.bbox=t.bbox||S(t)}(e),e):n("geojson.feature is not Polygon")}function D(t,e){if(c(t)){const t=e=>{const n=[];for(let o=0,r=e.length;o<r;o++){const r=e[o];Array.isArray(r[0])?n.push(t(r)):n[o]=i(r)}return n};return t(e)}return e}function Z(t,e,n){const[o,r,i,a]=t,s=(i-o)/e,c=(a-r)/e,[h,l]=n;return[(h-o)/s,e-(l-r)/c]}function V(t,e,n,o){const[r,a,s,h]=e,l=(t,e)=>{const o=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];Array.isArray(i[0])?o.push(l(i,e)):o[r]=Z(e,n,i)}return o};if(c(t)){const[t,e]=i([r,a]),[n,c]=i([s,h]);return l(o,[t,e,n,c])}return l(o,e)}const X=Math.PI/180,q=180/Math.PI,H=6378137,K=20037508.342789244,J="900913",Q={};function $(t){return Number(t)===t&&t%1!=0}const tt=256,et=[-180,90],nt=[-20037508.342787,20037508.342787],ot=["EPSG:4326","EPSG:3857"],rt=new class{#t;#e;#n;#o;#r;#i;constructor(t={}){if(this.#t=t.size||256,this.#e=t.antimeridian?2:1,!Q[this.#t]){let t=this.#t;const e=Q[this.#t]={};e.Bc=[],e.Cc=[],e.zc=[],e.Ac=[];for(let n=0;n<30;n++)e.Bc.push(t/360),e.Cc.push(t/(2*Math.PI)),e.zc.push(t/2),e.Ac.push(t),t*=2}this.#n=Q[this.#t].Bc,this.#o=Q[this.#t].Cc,this.#r=Q[this.#t].zc,this.#i=Q[this.#t].Ac}px(t,e){if($(e)){const n=this.#t*Math.pow(2,e),o=n/2,r=n/360,i=n/(2*Math.PI),a=n,s=Math.min(Math.max(Math.sin(X*t[1]),-.9999),.9999);let c=o+t[0]*r,h=o+.5*Math.log((1+s)/(1-s))*-i;return c>a*this.#e&&(c=a*this.#e),h>a&&(h=a),[c,h]}{const n=this.#r[e],o=Math.min(Math.max(Math.sin(X*t[1]),-.9999),.9999);let r=Math.round(n+t[0]*this.#n[e]),i=Math.round(n+.5*Math.log((1+o)/(1-o))*-this.#o[e]);return r>this.#i[e]*this.#e&&(r=this.#i[e]*this.#e),i>this.#i[e]&&(i=this.#i[e]),[r,i]}}ll(t,e){if($(e)){const n=this.#t*Math.pow(2,e),o=n/360,r=n/(2*Math.PI),i=n/2,a=(t[1]-i)/-r;return[(t[0]-i)/o,q*(2*Math.atan(Math.exp(a))-.5*Math.PI)]}{const n=(t[1]-this.#r[e])/-this.#o[e];return[(t[0]-this.#r[e])/this.#n[e],q*(2*Math.atan(Math.exp(n))-.5*Math.PI)]}}convert(t,e){return e===J?[...this.forward(t.slice(0,2)),...this.forward(t.slice(2,4))]:[...this.inverse(t.slice(0,2)),...this.inverse(t.slice(2,4))]}inverse(t){return[t[0]*q/H,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/H)))*q]}forward(t){const e=[H*t[0]*X,H*Math.log(Math.tan(.25*Math.PI+.5*t[1]*X))];return e[0]>K&&(e[0]=K),e[0]<-K&&(e[0]=-K),e[1]>K&&(e[1]=K),e[1]<-K&&(e[1]=-K),e}bbox(t,e,n,o,r){o&&(e=Math.pow(2,n)-1-e);const i=[t*this.#t,(+e+1)*this.#t],a=[(+t+1)*this.#t,e*this.#t],s=[...this.ll(i,n),...this.ll(a,n)];return r===J?this.convert(s,J):s}xyz(t,e,n,o){const r=o===J?this.convert(t,"WGS84"):t,i=[r[0],r[1]],a=[r[2],r[3]],s=this.px(i,e),c=this.px(a,e),h=[Math.floor(s[0]/this.#t),Math.floor((c[0]-1)/this.#t)],l=[Math.floor(c[1]/this.#t),Math.floor((s[1]-1)/this.#t)],u={minX:Math.min.apply(Math,h)<0?0:Math.min.apply(Math,h),minY:Math.min.apply(Math,l)<0?0:Math.min.apply(Math,l),maxX:Math.max.apply(Math,h),maxY:Math.max.apply(Math,l)};if(n){const t={minY:Math.pow(2,e)-1-u.maxY,maxY:Math.pow(2,e)-1-u.minY};u.minY=t.minY,u.maxY=t.maxY}return u}}({size:tt});function it(t){return 1.40625/Math.pow(2,t)}function at(t,e,n,o=0){o=o||0;const[r,i]=nt,a=(s=n,156543.03392804097/Math.pow(2,s)*tt);var s;const c=function(t,e,n){const[o,r]=et,i=it(n)*tt;let a=t,s=e;return a=Math.floor(a),s=Math.floor(s),[o+a*i,s*i-r,o+(a+1)*i,(s+1)*i-r]}(t,e,n),h=G(_(c).map((t=>rt.forward(t)))),[l,u,f,m]=h;let d=(l-r)/a,g=(f-r)/a,p=(i-m)/a,M=(i-u)/a;if(d=Math.floor(d),g=Math.floor(g),p=Math.floor(p),M=Math.floor(M),g<d||M<p)return;const b=[];for(let t=p;t<=M;t++)for(let e=d;e<=g;e++)b.push([e,t,n+o]);const x=b.map((t=>{const[e,n,o]=t;return rt.bbox(e,n,o,!1,"900913")})),[v,I,w,y]=function(t){let e=1/0,n=1/0,o=-1/0,r=-1/0;return t.forEach((t=>{const[i,a,s,c]=t;e=Math.min(e,i),o=Math.max(o,s),n=Math.min(n,a),r=Math.max(r,c)})),[e,n,o,r]}(x);return{tiles:b,tilesbbox:[v,I,w,y],bbox:c,mbbox:h,x:t,y:e,z:n}}function st(t,e,n,o){const{width:r,height:i}=t,[a,s,c,h]=e,l=(c-a)/r,u=(h-s)/i;let[p,M,b,x]=n;p-=l,b+=l,M-=u,x+=u;let v=(p-a)/l,I=(h-x)/u,w=(b-a)/l,y=(h-M)/u;v=Math.floor(v),I=Math.floor(I),w=Math.ceil(w),y=Math.ceil(y);const z=w-v,P=y-I,B=m();d(B,z,P);const T=g(B);T.drawImage(t,v,I,z,P,0,0,z,P),f(t);const k=T.getImageData(0,0,z,P).data,A=[];let E=1/0,O=1/0,R=-1/0,C=-1/0,j=-1;const S="EPSG:4326"===o?rt.forward:rt.inverse;for(let t=1;t<=P;t++){const e=x-(t-1)*u,n=e-u;for(let o=1;o<=z;o++){const r=(t-1)*z*4+4*(o-1),i=k[r],a=k[r+1],s=k[r+2],c=k[r+3],h=p+(o-1)*l,u=S([h,e]);E=Math.min(E,u[0]),R=Math.max(R,u[0]),O=Math.min(O,u[1]),C=Math.max(C,u[1]);const f=[h,n];A[++j]={point:u,point1:S(f),r:i,g:a,b:s,a:c}}}return{pixels:A,bbox:[E,O,R,C],width:z,height:P,image:B.transferToImageBitmap()}}function ct(t,e,n){const[o,r,i,a]=e,s=(i-o)/tt,c=(a-r)/tt,{pixels:h,bbox:l}=t,[u,f,p,M]=l;let b=(p-u)/s,x=(M-f)/c;if(b=Math.round(b),x=Math.round(x),isNaN(b)||isNaN(x)||0===Math.min(b,x)||Math.abs(b)===1/0||Math.abs(x)===1/0)return;const v=m();d(v,b,x);const I=g(v);function w(t,e){let n=Math.round((t-u)/s+1);n=Math.min(n,b);let o=Math.round((M-e)/c+1);return o=Math.min(o,x),[n,o]}const y=I.createImageData(b,x),z=y.data;for(let t=0,e=h.length;t<e;t++){const{point:e,point1:n,r:o,g:r,b:i,a:a}=h[t],[s,c]=e,[l,u]=n,[f,m]=w(s,c),[d,g]=w(l,u);for(let t=m;t<=g;t++){const e=(t-1)*b*4+4*(f-1);z[e]=o,z[e+1]=r,z[e+2]=i,z[e+3]=a}}I.putImageData(y,0,0);const P=v.transferToImageBitmap(),B=Math.round((o-u)/s),T=Math.round((M-a)/c),k=m();d(k,tt,tt);const A=g(v);return A.drawImage(P,B-1,T,tt,tt,0,0,tt,tt),function(t){const e=t.canvas,{width:n,height:o}=e,r=t.getImageData(0,0,n,o),i=r.data,a=()=>{for(let t=1;t<=o;t++){if(i[4*n*(t-1)+0+3]>0)return!1}return!0},s=()=>{for(let t=1;t<=n;t++){if(i[4*(t-1)+(o-1)*n*4+3]>0)return!1}return!0};if(a())for(let t=1;t<=o;t++){const e=4*n*(t-1)+0,o=e+4,r=i[o],a=i[o+1],s=i[o+2],c=i[o+3];i[e]=r,i[e+1]=a,i[e+2]=s,i[e+3]=c}if(s())for(let t=1;t<=n;t++){const e=4*(t-1)+(o-1)*n*4,r=4*(t-1)+(o-2)*n*4,a=i[r],s=i[r+1],c=i[r+2],h=i[r+3];i[e]=a,i[e+1]=s,i[e+2]=c,i[e+3]=h}t.putImageData(r,0,0)}(A),n&&(A.lineWidth=.4,A.strokeStyle="red",A.rect(0,0,tt,tt),A.stroke()),k.transferToImageBitmap()}function ht(t){return new Promise(((o,r)=>{const{urlTemplate:a,x:s,y:c,z:h,maxAvailableZoom:l,projection:u,zoomOffset:M,errorLog:b,debug:v,returnBlobURL:I}=t,w=l&&e(l)&&l>=1;if(!u)return void r(n("not find projection"));if(-1===ot.indexOf(u))return void r(n("not support projection:"+u+".the support:"+ot.join(",").toString()));if(!w)return void r(n("maxAvailableZoom is error"));if(!a)return void r(n("urlTemplate is error"));if(!e(s)||!e(c)||!e(h))return void r(n("x/y/z is error"));const y=t=>{I?x(t).then((t=>{const e=URL.createObjectURL(t);o(e)})).catch((t=>{r(t)})):o(t)};(()=>{let e;"EPSG:4326"===u?e=function(t,e,n,o=0){o=o||0;const[r,a]=et,s=it(n)*tt,c=rt.bbox(t,e,n),[h,l,u,f]=c;let m=(h-r)/s,d=(u-r)/s,g=(a-f)/s,p=(a-l)/s;if(m=Math.floor(m),d=Math.floor(d),g=Math.floor(g),p=Math.floor(p),d<m||p<g)return;const M=[];for(let t=g;t<=p;t++)for(let e=m;e<=d;e++)M.push([e-1,t,n+o]);return{tiles:M,tilesbbox:[r+(m-1)*s,a-(p+1)*s,r+d*s,a-g*s],bbox:c,mbbox:G(_(c).map((t=>i(t)))),x:t,y:e,z:n}}(s,c,h,M||0):"EPSG:3857"===u&&(e=at(s,c,h,M||0));const{tiles:n}=e||{};if(!n||0===n.length)return void y(p());e.loadCount=0;const o=()=>{if(e.loadCount>=n.length){const t=function(t,e){let n=1/0,o=1/0,r=-1/0,i=-1/0,a=256;t.forEach((t=>{const[e,s]=t;n=Math.min(e,n),o=Math.min(s,o),r=Math.max(e,r),i=Math.max(s,i),a=t.tileImage.width}));const s=(r-n+1)*a,c=(i-o+1)*a,h=m();d(h,s,c);const l=g(h);return e&&(l.font="bold 48px serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="red"),t.forEach((t=>{const[r,i,s]=t,c=(r-n)*a,h=(i-o)*a;let u=t.tileImage;l.drawImage(u,c,h,a,a),e&&l.fillText([r,i,s].join("_").toString(),c+100,h+100)})),f(t.map((t=>t.tileImage))),h.transferToImageBitmap()}(n,v);let o;if("EPSG:4326"===u){o=ct(st(t,e.tilesbbox,e.bbox,u),e.mbbox,v),y(o||p())}else{o=ct(st(t,e.tilesbbox,e.mbbox,u),e.bbox,v),y(o||p())}}else{const r=n[e.loadCount],[i,a,s]=r;T(Object.assign({},t,{x:i,y:a,z:s,returnBlobURL:!1})).then((t=>{r.tileImage=t,e.loadCount++,o()})).catch((t=>{b&&console.error(t),r.tileImage=p(),e.loadCount++,o()}))}};o()})()}))}function lt(t){const e=[];return t&&t instanceof ImageBitmap&&e.push(t),e}t.initialize=function(){},t.onmessage=function(t,e){const i=t.data||{},s=i._type;if("getTile"!==s){var c;if("getTileWithMaxZoom"!==s)if("clipTile"!==s)if("transformTile"!==s){if("injectMask"===s){const t=W(i.maskId,i.geojsonFeature);return t instanceof Error?void e(t):void e()}if("removeMask"===s)return l=i.maskId,delete F[l],void e();var l;if("cancelFetch"===s){const t=i.taskId||i.__taskId;return t?(function(t){const e=z[t]||[];e.length&&e.forEach((t=>{t.abort(a)})),delete z[t]}(t),void e()):void e(n("cancelFetch need taskId"))}"imageSlicing"!==s?"imageToBlobURL"!==s?console.error("not support message type:",s):A(i).then((t=>{e(null,t,[])})).catch((t=>{e(t)})):function(t){return t.disableCache=!0,new Promise(((e,i)=>{const{url:a}=t;if(!a)return void i(n("url is null"));const s=o(a),c=Object.assign({},h,t.headers||{}),l=s.map((e=>B(e,c,t)));Promise.all(l).then((n=>{const o=m(k);if(!o)return void i(r);const a=M(n);if(a instanceof Error)return void i(a);const{width:s,height:c}=a,h=Math.ceil(c/k),l=Math.ceil(s/k),p=[];for(let e=1;e<=h;e++){const n=(e-1)*k,r=Math.min(c,e*k);for(let i=1;i<=l;i++){const c=(i-1)*k,h=Math.min(s,i*k)-c,l=r-n;d(o,h,l),g(o).drawImage(a,c,n,h,l,0,0,o.width,o.height);const f=o.transferToImageBitmap(),m=t.filter;let M;M=m?v(o,f,m):f;const b=I(M,t.opacity);p.push({id:(u++,u),x:c,y:n,width:h,height:l,row:e,col:i,image:b})}}const b={rows:h,cols:l,rowWidth:k,colsHeight:k,width:s,height:c,items:p};f(a),e(b)})).catch((t=>{i(t)}))}))}(i).then((t=>{const n=[];(t.items||[]).forEach((t=>{t.image&&t.image instanceof ImageBitmap&&n.push(t.image)})),e(null,t,n)})).catch((t=>{e(t)}))}else ht(i).then((t=>{e(null,t,lt(t))})).catch((t=>{e(t)}));else(c=i,new Promise(((t,e)=>{const{tile:o,tileBBOX:i,projection:a,tileSize:s,maskId:h,returnBlobURL:l}=c;if(!o)return void e(n("tile is null.It should be a ImageBitmap"));if(!i)return void e(n("tileBBOX is null"));if(!a)return void e(n("projection is null"));if(!s)return void e(n("tileSize is null"));if(!h)return void e(n("maskId is null"));const u=F[h];if(!u)return void e(n("not find mask by maskId:"+h));const f=m(s);if(!f)return void e(r);const d=n=>{l?x(n).then((e=>{const n=URL.createObjectURL(e);t(n)})).catch((t=>{e(t)})):t(n)},g=u.bbox;if(!g)return void d(o);const{coordinates:M,type:v}=u.geometry;if(!M.length)return void d(o);if(w=i,(I=g)[2]<w[0]||I[1]>w[3]||I[0]>w[2]||I[3]<w[1])return void d(p(s));var I,w;let y,z=M;if("Polygon"===v&&(z=[z]),function(t,e){const[n,o,r,i]=t;return n>=e[0]&&r<=e[2]&&o>=e[1]&&i<=e[3]}(g,i))return y=D(a,z),void d(b(f,V(a,i,s,y),o));const P=t=>{if(t.length>0){let e=1/0,n=-1/0,o=1/0,r=-1/0;for(let i=0,a=t.length;i<a;i++){const[a,s]=t[i];e=Math.min(a,e),o=Math.min(s,o),n=Math.max(a,n),r=Math.max(s,r)}if(e!==n&&o!==r)return!0}return!1},B=[];for(let t=0,e=z.length;t<e;t++){const e=z[t];for(let t=0,n=e.length;t<n;t++){const n=e[t],o=L.polygon(n,i);P(o)&&B.push([o])}}0!==B.length?(y=D(a,B),d(b(f,V(a,i,s,y),o))):d(p())}))).then((t=>{e(null,t,lt(t))})).catch((t=>{e(t)}));else T(i).then((t=>{e(null,t,lt(t))})).catch((t=>{e(t)}))}else{const{url:t}=i;(function(t,e){return new Promise(((i,a)=>{if(!t)return void a(n("url is null"));const s=o(t),c=Object.assign({},h,e.headers||{}),l=s.map((t=>B(t,c,e))),{returnBlobURL:u}=e;Promise.all(l).then((t=>{const n=m();if(!n)return void a(r);const o=M(t);if(o instanceof Error)return void a(o);const s=e.filter;let c;c=s?v(n,o,s):o;const h=I(c,e.opacity);u?x(h).then((t=>{const e=URL.createObjectURL(t);i(e)})).catch((t=>{a(t)})):i(h)})).catch((t=>{a(t)}))}))})(t,i).then((t=>{e(null,t,lt(t))})).catch((t=>{e(t)}))}},Object.defineProperty(t,"__esModule",{value:!0})})`
