export default (function(t){"use strict";function e(t){return"number"==typeof t}function r(t){return new Error(t)}function n(t){return Array.isArray(t)?t:[t]}function i(t){const[e,r]=t,n=6378137,i=e*Math.PI/180*n,a=r*Math.PI/180;return[i,3189068.5*Math.log((1+Math.sin(a))/(1-Math.sin(a)))]}const a=r("fetch tile data cancel"),o=r("fetch tile data timeout");function s(t){return"EPSG:3857"===t}const h={accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.26"};let c=0;function f(t){return t&&t instanceof ImageBitmap}function l(t){Array.isArray(t)||(t=[t]),t.forEach((t=>{t&&t.close&&t.close()}))}function u(t,e){const r=Math.floor(10*(t+1e4)),n=r>>16,i=r>>8&255,a=255&r;return e?(e[0]=n,e[1]=i,e[2]=a,e):[n,i,a]}var g,p,d,m,b,y;function M(t,e,r,n,i,a){var o,s,h,c,f,l,u,g,p,d,m,b,y,M,w,v,A,x,E,I,k,P,U,B,T,S,z,G,C,N;for(T=0;T<a;T++){for(U=T,B=0,h=(o=t[P=T*i])>>8&255,c=o>>16&255,f=o>>24&255,M=x=(s=255&o)*n[6],w=E=h*n[6],v=I=c*n[6],A=k=f*n[6],z=n[0],G=n[1],C=n[4],N=n[5],S=0;S<i;S++)d=(l=255&(o=t[P]))*z+s*G+M*C+x*N,m=(u=o>>8&255)*z+h*G+w*C+E*N,b=(g=o>>16&255)*z+c*G+v*C+I*N,y=(p=o>>24&255)*z+f*G+A*C+k*N,x=M,E=w,I=v,k=A,M=d,w=m,v=b,A=y,s=l,h=u,c=g,f=p,r[B]=M,r[B+1]=w,r[B+2]=v,r[B+3]=A,B+=4,P++;for(B-=4,U+=a*(i-1),h=(o=t[--P])>>8&255,c=o>>16&255,f=o>>24&255,M=x=(s=255&o)*n[7],w=E=h*n[7],v=I=c*n[7],A=k=f*n[7],l=s,u=h,g=c,p=f,z=n[2],G=n[3],S=i-1;S>=0;S--)d=l*z+s*G+M*C+x*N,m=u*z+h*G+w*C+E*N,b=g*z+c*G+v*C+I*N,y=p*z+f*G+A*C+k*N,x=M,E=w,I=v,k=A,M=d,w=m,v=b,A=y,s=l,h=u,c=g,f=p,l=255&(o=t[P]),u=o>>8&255,g=o>>16&255,p=o>>24&255,o=(r[B]+M|0)+(r[B+1]+w<<8)+(r[B+2]+v<<16)+(r[B+3]+A<<24),e[U]=o,P--,B-=4,U-=a}}var w=function(t,e,r,n){if(n){var i=new Uint32Array(t.buffer),a=new Uint32Array(i.length),o=new Float32Array(4*Math.max(e,r)),s=function(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,r=Math.exp(-e),n=Math.exp(-2*e),i=(1-r)*(1-r)/(1+2*e*r-n);return g=i,p=i*(e-1)*r,d=i*(e+1)*r,m=-i*n,b=2*r,y=-n,new Float32Array([g,p,d,m,b,y,(g+p)/(1-b-y),(d+m)/(1-b-y)])}(n);M(i,a,o,s,e,r),M(a,i,o,s,r,e)}};let v;function A(t=256){return!v&&OffscreenCanvas&&(v=new OffscreenCanvas(1,1)),v&&x(v,t,t),v}function x(t,e,r){t&&(t.width=e,t.height=r)}function E(t){const e=t.getContext("2d",{willReadFrequently:!0});return function(t){const e=t.canvas;t.clearRect(0,0,e.width,e.height)}(e),e}function I(t){const e=A(t);return E(e),e.transferToImageBitmap()}function k(t,e){if(1===t.length)return t[0];if(0===t.length)return r("merge tiles error,not find imagebitmaps");for(let e=0,n=t.length;e<n;e++){if(!f(t[e]))return r("merge tiles error,images not imagebitmap")}const n=t[0].width,i=A(n),a=E(i);return e&&(a.save(),a.globalCompositeOperation=e),t.forEach((t=>{a.drawImage(t,0,0,n,n)})),e&&a.restore(),l(t),i.transferToImageBitmap()}function P(t,e,r,n){const i=E(t);i.save();i.beginPath(),n&&i.rect(0,0,t.width,t.height),e.forEach((t=>{(t=>{for(let e=0,r=t.length;e<r;e++){const r=t[e],n=r[0],a=r[r.length-1],[o,s]=n,[h,c]=a;o===h&&s===c||r.push(n);for(let t=0,e=r.length;t<e;t++){const[e,n]=r[t];0===t?i.moveTo(e,n):i.lineTo(e,n)}}})(t)})),i.clip("evenodd"),i.drawImage(r,0,0,t.width,t.height);const a=t.transferToImageBitmap();return i.restore(),l(r),a}function U(t){const e=A();x(e,t.width,t.height);return E(e).drawImage(t,0,0),l(t),e.convertToBlob()}function B(t,e,r){if(!r)return e;x(t,e.width,e.height);const n=E(t);n.save(),n.filter=r,n.drawImage(e,0,0),n.restore();const i=t.transferToImageBitmap();return l(e),i}function T(t,r,n){if(!e(n)||n<=0)return r;x(t,r.width,r.height);const i=E(t);i.drawImage(r,0,0);const a=i.getImageData(0,0,t.width,t.height);w(a.data,t.width,t.height,n),i.putImageData(a,0,0);const o=t.transferToImageBitmap();return l(r),o}function S(t,r=1){if(!e(r)||1===r||r<0||r>1)return t;const n=A();x(n,t.width,t.height);const i=E(n);i.globalAlpha=r,i.drawImage(t,0,0);const a=n.transferToImageBitmap();return i.globalAlpha=1,l(t),a}const z=()=>{};class G{constructor(t,e){this.max=t,this.onRemove=e||z,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):(this.data.set(t,e),this.data.size>this.max&&this.shrink()),this):this}keys(){const t=new Array(this.data.size);let e=0;const r=this.data.keys();for(const n of r)t[e++]=n;return t}shrink(){const t=this.data.keys();let e=t.next();for(;this.data.size>this.max;){const r=this.getAndRemove(e.value);r&&this.onRemove(r),e=t.next()}}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){if(!this.has(t))return null;return this.data.get(t)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.data.size>this.max&&this.shrink(),this}}
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){function t(t){throw t}var e=void 0,r=!0,n=this;function i(t,r){var i,a=t.split("."),o=n;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||r===e?o=o[i]?o[i]:o[i]={}:o[i]=r}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function o(e,r){this.index="number"==typeof r?r:0,this.i=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}o.prototype.f=function(){var t,e=this.buffer,r=e.length,n=new(a?Uint8Array:Array)(r<<1);if(a)n.set(e);else for(t=0;t<r;++t)n[t]=e[t];return this.buffer=n},o.prototype.d=function(t,e,r){var n,i=this.buffer,a=this.index,o=this.i,s=i[a];if(r&&1<e&&(t=8<e?(u[255&t]<<24|u[t>>>8&255]<<16|u[t>>>16&255]<<8|u[t>>>24&255])>>32-e:u[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(n=0;n<e;++n)s=s<<1|t>>e-n-1&1,8==++o&&(o=0,i[a++]=u[s],s=0,a===i.length&&(i=this.f()));i[a]=s,this.buffer=i,this.i=o,this.index=a},o.prototype.finish=function(){var t,e=this.buffer,r=this.index;return 0<this.i&&(e[r]<<=8-this.i,e[r]=u[e[r]],r++),a?t=e.subarray(0,r):(e.length=r,t=e),t};var s,h=new(a?Uint8Array:Array)(256);for(s=0;256>s;++s){for(var c=l=s,f=7,l=l>>>1;l;l>>>=1)c<<=1,c|=1&l,--f;h[s]=(c<<f&255)>>>0}var u=h;function g(t){this.buffer=new(a?Uint16Array:Array)(2*t),this.length=0}function p(t){var e,r,n,i,o,s,h,c,f,l,u=t.length,g=0,p=Number.POSITIVE_INFINITY;for(c=0;c<u;++c)t[c]>g&&(g=t[c]),t[c]<p&&(p=t[c]);for(e=1<<g,r=new(a?Uint32Array:Array)(e),n=1,i=0,o=2;n<=g;){for(c=0;c<u;++c)if(t[c]===n){for(s=0,h=i,f=0;f<n;++f)s=s<<1|1&h,h>>=1;for(l=n<<16|c,f=s;f<e;f+=o)r[f]=l;++i}++n,i<<=1,o<<=1}return[r,g,p]}function d(t,e){this.h=b,this.w=0,this.input=a&&t instanceof Array?new Uint8Array(t):t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=a&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}g.prototype.getParent=function(t){return 2*((t-2)/4|0)},g.prototype.push=function(t,e){var r,n,i,a=this.buffer;for(r=this.length,a[this.length++]=e,a[this.length++]=t;0<r&&(n=this.getParent(r),a[r]>a[n]);)i=a[r],a[r]=a[n],a[n]=i,i=a[r+1],a[r+1]=a[n+1],a[n+1]=i,r=n;return this.length},g.prototype.pop=function(){var t,e,r,n,i,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],i=0;!((n=2*i+2)>=this.length)&&(n+2<this.length&&a[n+2]>a[n]&&(n+=2),a[n]>a[i]);)r=a[i],a[i]=a[n],a[n]=r,r=a[i+1],a[i+1]=a[n+1],a[n+1]=r,i=n;return{index:t,value:e,length:this.length}};var m,b=2,y={NONE:0,r:1,k:b,N:3},M=[];for(m=0;288>m;m++)switch(r){case 143>=m:M.push([m+48,8]);break;case 255>=m:M.push([m-144+400,9]);break;case 279>=m:M.push([m-256+0,7]);break;case 287>=m:M.push([m-280+192,8]);break;default:t("invalid literal: "+m)}function w(t,e){this.length=t,this.G=e}d.prototype.j=function(){var n,i,s,h,c=this.input;switch(this.h){case 0:for(s=0,h=c.length;s<h;){var f,l,u,g=i=a?c.subarray(s,s+65535):c.slice(s,s+65535),p=(s+=i.length)===h,d=e,m=e,y=this.a,w=this.b;if(a){for(y=new Uint8Array(this.a.buffer);y.length<=w+g.length+5;)y=new Uint8Array(y.length<<1);y.set(this.a)}if(f=p?1:0,y[w++]=0|f,u=65536+~(l=g.length)&65535,y[w++]=255&l,y[w++]=l>>>8&255,y[w++]=255&u,y[w++]=u>>>8&255,a)y.set(g,w),w+=g.length,y=y.subarray(0,w);else{for(d=0,m=g.length;d<m;++d)y[w++]=g[d];y.length=w}this.b=w,this.a=y}break;case 1:var v=new o(a?new Uint8Array(this.a.buffer):this.a,this.b);v.d(1,1,r),v.d(1,2,r);var A,E,P,U=x(this,c);for(A=0,E=U.length;A<E;A++)if(P=U[A],o.prototype.d.apply(v,M[P]),256<P)v.d(U[++A],U[++A],r),v.d(U[++A],5),v.d(U[++A],U[++A],r);else if(256===P)break;this.a=v.finish(),this.b=this.a.length;break;case b:var B,T,S,z,G,C,N,L,O,D,R,_,j,F,Y,W=new o(a?new Uint8Array(this.a.buffer):this.a,this.b),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=Array(19);for(B=b,W.d(1,1,r),W.d(B,2,r),T=x(this,c),N=k(C=I(this.L,15)),O=k(L=I(this.K,7)),S=286;257<S&&0===C[S-1];S--);for(z=30;1<z&&0===L[z-1];z--);var V,Z,H,$,K,X,Q=S,tt=z,et=new(a?Uint32Array:Array)(Q+tt),rt=new(a?Uint32Array:Array)(316),nt=new(a?Uint8Array:Array)(19);for(V=Z=0;V<Q;V++)et[Z++]=C[V];for(V=0;V<tt;V++)et[Z++]=L[V];if(!a)for(V=0,$=nt.length;V<$;++V)nt[V]=0;for(V=K=0,$=et.length;V<$;V+=Z){for(Z=1;V+Z<$&&et[V+Z]===et[V];++Z);if(H=Z,0===et[V])if(3>H)for(;0<H--;)rt[K++]=0,nt[0]++;else for(;0<H;)(X=138>H?H:138)>H-3&&X<H&&(X=H-3),10>=X?(rt[K++]=17,rt[K++]=X-3,nt[17]++):(rt[K++]=18,rt[K++]=X-11,nt[18]++),H-=X;else if(rt[K++]=et[V],nt[et[V]]++,3>--H)for(;0<H--;)rt[K++]=et[V],nt[et[V]]++;else for(;0<H;)(X=6>H?H:6)>H-3&&X<H&&(X=H-3),rt[K++]=16,rt[K++]=X-3,nt[16]++,H-=X}for(n=a?rt.subarray(0,K):rt.slice(0,K),D=I(nt,7),F=0;19>F;F++)J[F]=D[q[F]];for(G=19;4<G&&0===J[G-1];G--);for(R=k(D),W.d(S-257,5,r),W.d(z-1,5,r),W.d(G-4,4,r),F=0;F<G;F++)W.d(J[F],3,r);for(F=0,Y=n.length;F<Y;F++)if(_=n[F],W.d(R[_],D[_],r),16<=_){switch(F++,_){case 16:j=2;break;case 17:j=3;break;case 18:j=7;break;default:t("invalid code: "+_)}W.d(n[F],j,r)}var it,at,ot,st,ht,ct,ft,lt,ut=[N,C],gt=[O,L];for(ht=ut[0],ct=ut[1],ft=gt[0],lt=gt[1],it=0,at=T.length;it<at;++it)if(ot=T[it],W.d(ht[ot],ct[ot],r),256<ot)W.d(T[++it],T[++it],r),st=T[++it],W.d(ft[st],lt[st],r),W.d(T[++it],T[++it],r);else if(256===ot)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var v=function(){function e(e){switch(r){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var n,i,a=[];for(n=3;258>=n;n++)i=e(n),a[n]=i[2]<<24|i[1]<<16|i[0];return a}(),A=a?new Uint32Array(v):v;function x(n,i){function o(e,n){var i,a,o,s,h=e.G,c=[],f=0;switch(i=A[e.length],c[f++]=65535&i,c[f++]=i>>16&255,c[f++]=i>>24,r){case 1===h:a=[0,h-1,0];break;case 2===h:a=[1,h-2,0];break;case 3===h:a=[2,h-3,0];break;case 4===h:a=[3,h-4,0];break;case 6>=h:a=[4,h-5,1];break;case 8>=h:a=[5,h-7,1];break;case 12>=h:a=[6,h-9,2];break;case 16>=h:a=[7,h-13,2];break;case 24>=h:a=[8,h-17,3];break;case 32>=h:a=[9,h-25,3];break;case 48>=h:a=[10,h-33,4];break;case 64>=h:a=[11,h-49,4];break;case 96>=h:a=[12,h-65,5];break;case 128>=h:a=[13,h-97,5];break;case 192>=h:a=[14,h-129,6];break;case 256>=h:a=[15,h-193,6];break;case 384>=h:a=[16,h-257,7];break;case 512>=h:a=[17,h-385,7];break;case 768>=h:a=[18,h-513,8];break;case 1024>=h:a=[19,h-769,8];break;case 1536>=h:a=[20,h-1025,9];break;case 2048>=h:a=[21,h-1537,9];break;case 3072>=h:a=[22,h-2049,10];break;case 4096>=h:a=[23,h-3073,10];break;case 6144>=h:a=[24,h-4097,11];break;case 8192>=h:a=[25,h-6145,11];break;case 12288>=h:a=[26,h-8193,12];break;case 16384>=h:a=[27,h-12289,12];break;case 24576>=h:a=[28,h-16385,13];break;case 32768>=h:a=[29,h-24577,13];break;default:t("invalid distance")}for(i=a,c[f++]=i[0],c[f++]=i[1],c[f++]=i[2],o=0,s=c.length;o<s;++o)b[y++]=c[o];w[c[0]]++,v[c[3]]++,M=e.length+n-1,p=null}var s,h,c,f,l,u,g,p,d,m={},b=a?new Uint16Array(2*i.length):[],y=0,M=0,w=new(a?Uint32Array:Array)(286),v=new(a?Uint32Array:Array)(30),x=n.w;if(!a){for(c=0;285>=c;)w[c++]=0;for(c=0;29>=c;)v[c++]=0}for(w[256]=1,s=0,h=i.length;s<h;++s){for(c=l=0,f=3;c<f&&s+c!==h;++c)l=l<<8|i[s+c];if(m[l]===e&&(m[l]=[]),u=m[l],!(0<M--)){for(;0<u.length&&32768<s-u[0];)u.shift();if(s+3>=h){for(p&&o(p,-1),c=0,f=h-s;c<f;++c)d=i[s+c],b[y++]=d,++w[d];break}0<u.length?(g=E(i,s,u),p?p.length<g.length?(d=i[s-1],b[y++]=d,++w[d],o(g,0)):o(p,-1):g.length<x?p=g:o(g,0)):p?o(p,-1):(d=i[s],b[y++]=d,++w[d])}u.push(s)}return b[y++]=256,w[256]++,n.L=w,n.K=v,a?b.subarray(0,y):b}function E(t,e,r){var n,i,a,o,s,h,c=0,f=t.length;o=0,h=r.length;t:for(;o<h;o++){if(n=r[h-o-1],a=3,3<c){for(s=c;3<s;s--)if(t[n+s-1]!==t[e+s-1])continue t;a=c}for(;258>a&&e+a<f&&t[n+a]===t[e+a];)++a;if(a>c&&(i=n,c=a),258===a)break}return new w(c,e-i)}function I(t,e){var r,n,i,o,s,h=t.length,c=new g(572),f=new(a?Uint8Array:Array)(h);if(!a)for(o=0;o<h;o++)f[o]=0;for(o=0;o<h;++o)0<t[o]&&c.push(o,t[o]);if(r=Array(c.length/2),n=new(a?Uint32Array:Array)(c.length/2),1===r.length)return f[c.pop().index]=1,f;for(o=0,s=c.length/2;o<s;++o)r[o]=c.pop(),n[o]=r[o].value;for(i=function(t,e,r){function n(t){var r=p[t][d[t]];r===e?(n(t+1),n(t+1)):--u[r],++d[t]}var i,o,s,h,c,f=new(a?Uint16Array:Array)(r),l=new(a?Uint8Array:Array)(r),u=new(a?Uint8Array:Array)(e),g=Array(r),p=Array(r),d=Array(r),m=(1<<r)-e,b=1<<r-1;for(f[r-1]=e,o=0;o<r;++o)m<b?l[o]=0:(l[o]=1,m-=b),m<<=1,f[r-2-o]=(f[r-1-o]/2|0)+e;for(f[0]=l[0],g[0]=Array(f[0]),p[0]=Array(f[0]),o=1;o<r;++o)f[o]>2*f[o-1]+l[o]&&(f[o]=2*f[o-1]+l[o]),g[o]=Array(f[o]),p[o]=Array(f[o]);for(i=0;i<e;++i)u[i]=r;for(s=0;s<f[r-1];++s)g[r-1][s]=t[s],p[r-1][s]=s;for(i=0;i<r;++i)d[i]=0;for(1===l[r-1]&&(--u[0],++d[r-1]),o=r-2;0<=o;--o){for(h=i=0,c=d[o+1],s=0;s<f[o];s++)(h=g[o+1][c]+g[o+1][c+1])>t[i]?(g[o][s]=h,p[o][s]=e,c+=2):(g[o][s]=t[i],p[o][s]=i,++i);d[o]=0,1===l[o]&&n(o)}return u}(n,n.length,e),o=0,s=r.length;o<s;++o)f[r[o].index]=i[o];return f}function k(t){var e,r,n,i,o=new(a?Uint16Array:Array)(t.length),s=[],h=[],c=0;for(e=0,r=t.length;e<r;e++)s[t[e]]=1+(0|s[t[e]]);for(e=1,r=16;e<=r;e++)h[e]=c,c+=0|s[e],c<<=1;for(e=0,r=t.length;e<r;e++)for(c=h[t[e]],h[t[e]]+=1,n=o[e]=0,i=t[e];n<i;n++)o[e]=o[e]<<1|1&c,c>>>=1;return o}function P(e,r){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=a?new Uint8Array(e):e,this.s=!1,this.n=B,this.B=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.m=r.bufferSize),r.bufferType&&(this.n=r.bufferType),r.resize&&(this.B=r.resize)),this.n){case U:this.b=32768,this.a=new(a?Uint8Array:Array)(32768+this.m+258);break;case B:this.b=0,this.a=new(a?Uint8Array:Array)(this.m),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}var U=0,B=1,T={D:U,C:B};P.prototype.p=function(){for(;!this.s;){var n=H(this,3);switch(1&n&&(this.s=r),n>>>=1){case 0:var i=this.input,o=this.c,s=this.a,h=this.b,c=i.length,f=e,l=s.length,u=e;switch(this.e=this.g=0,o+1>=c&&t(Error("invalid uncompressed block header: LEN")),f=i[o++]|i[o++]<<8,o+1>=c&&t(Error("invalid uncompressed block header: NLEN")),f===~(i[o++]|i[o++]<<8)&&t(Error("invalid uncompressed block header: length verify")),o+f>i.length&&t(Error("input buffer is broken")),this.n){case U:for(;h+f>s.length;){if(f-=u=l-h,a)s.set(i.subarray(o,o+u),h),h+=u,o+=u;else for(;u--;)s[h++]=i[o++];this.b=h,s=this.f(),h=this.b}break;case B:for(;h+f>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(a)s.set(i.subarray(o,o+f),h),h+=f,o+=f;else for(;f--;)s[h++]=i[o++];this.c=o,this.b=h,this.a=s;break;case 1:this.o(J,Z);break;case 2:var g,d,m,b,y=H(this,5)+257,M=H(this,5)+1,w=H(this,4)+4,v=new(a?Uint8Array:Array)(C.length),A=e,x=e,E=e,I=e,k=e;for(k=0;k<w;++k)v[C[k]]=H(this,3);if(!a)for(k=w,w=v.length;k<w;++k)v[C[k]]=0;for(g=p(v),A=new(a?Uint8Array:Array)(y+M),k=0,b=y+M;k<b;)switch(x=$(this,g),x){case 16:for(I=3+H(this,2);I--;)A[k++]=E;break;case 17:for(I=3+H(this,3);I--;)A[k++]=0;E=0;break;case 18:for(I=11+H(this,7);I--;)A[k++]=0;E=0;break;default:E=A[k++]=x}d=p(a?A.subarray(0,y):A.slice(0,y)),m=p(a?A.subarray(y):A.slice(y)),this.o(d,m);break;default:t(Error("unknown BTYPE: "+n))}}return this.t()};var S,z,G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=a?new Uint16Array(G):G,N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],L=a?new Uint16Array(N):N,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],D=a?new Uint8Array(O):O,R=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],_=a?new Uint16Array(R):R,j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=a?new Uint8Array(j):j,Y=new(a?Uint8Array:Array)(288);for(S=0,z=Y.length;S<z;++S)Y[S]=143>=S?8:255>=S?9:279>=S?7:8;var W,q,J=p(Y),V=new(a?Uint8Array:Array)(30);for(W=0,q=V.length;W<q;++W)V[W]=5;var Z=p(V);function H(e,r){for(var n,i=e.g,a=e.e,o=e.input,s=e.c,h=o.length;a<r;)s>=h&&t(Error("input buffer is broken")),i|=o[s++]<<a,a+=8;return n=i&(1<<r)-1,e.g=i>>>r,e.e=a-r,e.c=s,n}function $(e,r){for(var n,i,a=e.g,o=e.e,s=e.input,h=e.c,c=s.length,f=r[0],l=r[1];o<l&&!(h>=c);)a|=s[h++]<<o,o+=8;return(i=(n=f[a&(1<<l)-1])>>>16)>o&&t(Error("invalid code length: "+i)),e.g=a>>i,e.e=o-i,e.c=h,65535&n}function K(t){if("string"==typeof t){var e,r,n=t.split("");for(e=0,r=n.length;e<r;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;t=n}for(var i,a=1,o=0,s=t.length,h=0;0<s;){s-=i=1024<s?1024:s;do{o+=a+=t[h++]}while(--i);a%=65521,o%=65521}return(o<<16|a)>>>0}function X(e,r){var n,i;if(this.input=e,this.c=0,!r&&(r={})||(r.index&&(this.c=r.index),r.verify&&(this.M=r.verify)),n=e[this.c++],i=e[this.c++],(15&n)===Q)this.method=Q;else t(Error("unsupported compression method"));0!=((n<<8)+i)%31&&t(Error("invalid fcheck flag:"+((n<<8)+i)%31)),32&i&&t(Error("fdict flag is not supported")),this.A=new P(e,{index:this.c,bufferSize:r.bufferSize,bufferType:r.bufferType,resize:r.resize})}P.prototype.o=function(t,e){var r=this.a,n=this.b;this.u=t;for(var i,a,o,s,h=r.length-258;256!==(i=$(this,t));)if(256>i)n>=h&&(this.b=n,r=this.f(),n=this.b),r[n++]=i;else for(s=L[a=i-257],0<D[a]&&(s+=H(this,D[a])),i=$(this,e),o=_[i],0<F[i]&&(o+=H(this,F[i])),n>=h&&(this.b=n,r=this.f(),n=this.b);s--;)r[n]=r[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},P.prototype.I=function(t,e){var r=this.a,n=this.b;this.u=t;for(var i,a,o,s,h=r.length;256!==(i=$(this,t));)if(256>i)n>=h&&(h=(r=this.f()).length),r[n++]=i;else for(s=L[a=i-257],0<D[a]&&(s+=H(this,D[a])),i=$(this,e),o=_[i],0<F[i]&&(o+=H(this,F[i])),n+s>h&&(h=(r=this.f()).length);s--;)r[n]=r[n++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},P.prototype.f=function(){var t,e,r=new(a?Uint8Array:Array)(this.b-32768),n=this.b-32768,i=this.a;if(a)r.set(i.subarray(32768,r.length));else for(t=0,e=r.length;t<e;++t)r[t]=i[t+32768];if(this.l.push(r),this.q+=r.length,a)i.set(i.subarray(n,n+32768));else for(t=0;32768>t;++t)i[t]=i[n+t];return this.b=32768,i},P.prototype.J=function(t){var e,r,n,i=this.input.length/this.c+1|0,o=this.input,s=this.a;return t&&("number"==typeof t.v&&(i=t.v),"number"==typeof t.F&&(i+=t.F)),2>i?r=(n=(o.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+n:s.length<<1:r=s.length*i,a?(e=new Uint8Array(r)).set(s):e=s,this.a=e},P.prototype.t=function(){var t,e,r,n,i,o=0,s=this.a,h=this.l,c=new(a?Uint8Array:Array)(this.q+(this.b-32768));if(0===h.length)return a?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,r=h.length;e<r;++e)for(n=0,i=(t=h[e]).length;n<i;++n)c[o++]=t[n];for(e=32768,r=this.b;e<r;++e)c[o++]=s[e];return this.l=[],this.buffer=c},P.prototype.H=function(){var t,e=this.b;return a?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},X.prototype.p=function(){var e,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&((r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0!==K(e)&&t(Error("invalid adler-32 checksum"))),e};var Q=8;function tt(t,e){this.input=t,this.a=new(a?Uint8Array:Array)(32768),this.h=et.k;var r,n={};for(r in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)n[r]=e[r];n.outputBuffer=this.a,this.z=new d(this.input,n)}var et=y;function rt(t,e){var r,n,a,o;if(Object.keys)r=Object.keys(e);else for(n in r=[],a=0,e)r[a++]=n;for(a=0,o=r.length;a<o;++a)i(t+"."+(n=r[a]),e[n])}tt.prototype.j=function(){var e,r,n,i,o,s,h,c=0;if(h=this.a,(e=Q)===Q)r=Math.LOG2E*Math.log(32768)-8;else t(Error("invalid compression method"));if(n=r<<4|e,h[c++]=n,e===Q)switch(this.h){case et.NONE:o=0;break;case et.r:o=1;break;case et.k:o=2;break;default:t(Error("unsupported compression type"))}else t(Error("invalid compression method"));return i=o<<6,h[c++]=i|31-(256*n+i)%31,s=K(this.input),this.z.b=c,c=(h=this.z.j()).length,a&&((h=new Uint8Array(h.buffer)).length<=c+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,c+4)),h[c++]=s>>24&255,h[c++]=s>>16&255,h[c++]=s>>8&255,h[c++]=255&s,h},i("Zlib.Inflate",X),i("Zlib.Inflate.prototype.decompress",X.prototype.p),rt("Zlib.Inflate.BufferType",{ADAPTIVE:T.C,BLOCK:T.D}),i("Zlib.Deflate",tt),i("Zlib.Deflate.compress",(function(t,e){return new tt(t,e).j()})),i("Zlib.Deflate.prototype.compress",tt.prototype.j),rt("Zlib.Deflate.CompressionType",{NONE:et.NONE,FIXED:et.r,DYNAMIC:et.k})}).call(self);var C="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var N,L=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t};function O(t,e,r){return t[0]=e,t[1]=r,t}N=new C(3),C!=Float32Array&&(N[0]=0,N[1]=0,N[2]=0),function(){var t=function(){var t=new C(2);return C!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const D=[],R=[],_=[],j=[],F=[],Y=[],W=32767,q=64,J=64,V=3,Z=-1e3,H=.001,$=256,K=4,X=.002;function Q(t,e,r){return(1-r)*t+r*e}const tt=new TextDecoder("utf-8");function et(t){return t>>1^-(1&t)}function rt(t,e,r){const n=function(t){if(t.length<1e3)return null;const e=new self.Zlib.Inflate(t);return e?e.decompress():null}(new Uint8Array(t));if(!n)throw new Error((i=new Uint8Array(t),tt.decode(i)));var i;const a=function(t){const e=t,r=q,n=J,i=new Uint8Array(r*n*K);let a,o,s,h,c;for(let t=0;t<n;t++)for(let f=0;f<r;f++){h=parseInt(149*t/(n-1)),c=parseInt(149*f/(r-1)),o=2*(150*h+c),a=e[o]+256*e[o+1],(a>1e4||a<-2e3)&&(a=0),s=4*(t*r+f);const l=(a+1e3)/H,u=$;i[s]=l/(u*u),i[s+1]=(l-i[s]*u*u)/u,i[s+2]=l-i[s]*u*u-i[s+1]*u,i[s+3]=255}return i}(n),o=function(t,e){const r=e,n=e,i=r+1,a=n+1,o=V,s=Z,h=H,c=$,f=X,l=new Float32Array(i*a);let u=0,g=1/0,p=-1/0;for(let e=0;e<i;e++){const i=e>=n?n-1:e;for(let e=0;e<a;e++){let n=0;const a=i*(4*r)+4*(e>=r?r-1:e);for(let e=0;e<o;e++)n=n*c+t[a+e];n=1*(n*h+s),n-=f,l[u]=n,n<g&&(g=n),n>p&&(p=n),u++}}return{data:l,min:g,max:p,width:0,height:0,tileSize:0,image:null}}(a,e-1);return o.width=o.height=e,o.tileSize=r,ct(o),o}class nt{constructor(t,e,r,n,i){this.p0=[],this.p1=[],this.p2=[],this.normal=[],this.min=[],this.max=[],this.set(t,e,r,n,i)}set(t,e,r,n,i){this.radius=i;let a=3*e,o=3*e+1,s=3*e+2;this.p0[0]=t[a]*i,this.p0[1]=t[o]*i,this.p0[2]=t[s],a=3*r,o=3*r+1,s=3*r+2,this.p1[0]=t[a]*i,this.p1[1]=t[o]*i,this.p1[2]=t[s],a=3*n,o=3*n+1,s=3*n+2,this.p2[0]=t[a]*i,this.p2[1]=t[o]*i,this.p2[2]=t[s],this.min[0]=Math.min(this.p0[0],this.p1[0],this.p2[0]),this.min[1]=Math.min(this.p0[1],this.p1[1],this.p2[1]),this.max[0]=Math.max(this.p0[0],this.p1[0],this.p2[0]),this.max[1]=Math.max(this.p0[1],this.p1[1],this.p2[1]);const h=L(D,this.p1,this.p0),c=L(R,this.p2,this.p1);this.normal=function(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}(this.normal,function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],h=r[2];return t[0]=i*h-a*s,t[1]=a*o-n*h,t[2]=n*s-i*o,t}(this.normal,h,c))}contains(t,e){if(t<this.min[0]||t>this.max[0]||e<this.min[1]||e>this.max[1])return!1;O(_,this.p0[0],this.p0[1]),O(j,this.p1[0],this.p1[1]),O(F,this.p2[0],this.p2[1]);const r=it(_[0],_[1],j[0],j[1],F[0],F[1]);return it(t,e,_[0],_[1],F[0],F[1])+it(t,e,_[0],_[1],j[0],j[1])+it(t,e,j[0],j[1],F[0],F[1])-r<=1e-4}getHeight(t,e){const r=this.normal;return this.p0[2]-((t-this.p0[0])*r[0]+(e-this.p0[1])*r[1])/r[2]}}function it(t,e,r,n,i,a){return.5*Math.abs(t*n+r*a+i*e-t*a-r*e-i*n)}let at=null;function ot(t,e,r){if(at&&at.contains(e,r))return at.getHeight(e,r);for(let n=0;n<t.length;n++)if(t[n].contains(e,r))return at=t[n],t[n].getHeight(e,r);return 0}const st=[];function ht(t,e,r){const n=function(t){let e=0;const r=3,n=Float64Array.BYTES_PER_ELEMENT*r,i=3,a=Uint16Array.BYTES_PER_ELEMENT*i,o=3;let s=Uint16Array.BYTES_PER_ELEMENT;const h=new DataView(t);e+=n;const c=h.getFloat32(e,!0);e+=Float32Array.BYTES_PER_ELEMENT;const f=h.getFloat32(e,!0);e+=Float32Array.BYTES_PER_ELEMENT,e+=n;const l=h.getFloat64(e,!0);e+=Float64Array.BYTES_PER_ELEMENT,e+=n;const u=h.getUint32(e,!0);e+=Uint32Array.BYTES_PER_ELEMENT;const g=new Uint16Array(t,e,3*u);e+=u*a,u>65536&&(s=Uint32Array.BYTES_PER_ELEMENT);const p=g.subarray(0,u),d=g.subarray(u,2*u),m=g.subarray(2*u,3*u);(function(t,e,r){const n=t.length;let i=0,a=0,o=0;for(let s=0;s<n;++s)i+=et(t[s]),a+=et(e[s]),t[s]=i,e[s]=a,r&&(o+=et(r[s]),r[s]=o)})(p,d,m),e%s!=0&&(e+=s-e%s);const b=h.getUint32(e,!0);e+=Uint32Array.BYTES_PER_ELEMENT;const y=u>65536?new Uint32Array(t,e,b*o):new Uint16Array(t,e,b*o);let M=0;const w=y.length;for(let t=0;t<w;++t){const e=y[t];y[t]=M-e,0===e&&++M}const v={minimumHeight:c,maximumHeight:f,quantizedVertices:g,indices:y},A=v.quantizedVertices,x=A.length/3,E=A.subarray(0,x),I=A.subarray(x,2*x),k=A.subarray(2*x,3*x),P=Y;for(let t=0;t<x;++t){const e=E[t],r=I[t],n=e/W,i=r/W,a=Q(c,f,k[t]/W);P[3*t]=n,P[3*t+1]=1-i,P[3*t+2]=a}return{positions:P,radius:l,min:c,max:f,indices:y}}(t),{positions:i,min:a,max:o,indices:s,radius:h}=n,c=[];let f=0;for(let t=0;t<s.length;t+=3){let e=st[f];e?e.set(i,s[t],s[t+1],s[t+2],2*h):e=st[f]=new nt(i,s[t],s[t+1],s[t+2],2*h),f++,c.push(e)}const l=new Float32Array(e*e);f=0;for(let t=0;t<e;t++)for(let r=0;r<e;r++)l[f++]=ot(c,r/e*h*2,t/e*h*2);const u={data:l,min:a,max:o,width:e,height:e,tileSize:r};return ct(u),console.log(u),u}function ct(t){const e=A(),{width:r,height:n,data:i,tileSize:a}=t;if(r&&n&&i)try{x(e,r,n);let o=E(e);const s=o.createImageData(r,n),h=[0,0,0];for(let t=0,e=i.length;t<e;t++){const e=i[t],[r,n,a]=u(e,h),o=4*t;s.data[o]=r,s.data[o+1]=n,s.data[o+2]=a,s.data[o+3]=255}o.putImageData(s,0,0);const c=e.transferToImageBitmap();x(e,a,a),o=E(e),o.drawImage(c,0,0,r,n,0,0,a,a),t.image=e.transferToImageBitmap()}catch(t){console.log(t)}}const ft=new G(200,(t=>{l(t)})),lt=new G(200,(t=>{}));const ut={};function gt(t,e){ut[t]=ut[t]||[],ut[t].push(e)}function pt(t){const e=[];for(let r in ut){const n=ut[r]||[];if(n.length){const e=n.indexOf(t);e>-1&&n.splice(e,1)}0===n.length&&e.push(r)}e.forEach((t=>{delete ut[t]}))}function dt(t,n={},i){return new Promise(((a,s)=>{const h=t=>{createImageBitmap(t).then((t=>{a(t)})).catch((t=>{s(t)}))},c=i.__taskId;if(!c)return void s(r("taskId is null"));const f=ft.get(t);if(f)h(f);else{const r=i.fetchOptions||{headers:n,referrer:i.referrer},a=i.timeout||0,f=new AbortController,l=f.signal;a&&e(a)&&a>0&&setTimeout((()=>{f.abort(o)}),a),r.signal=l,delete r.timeout,gt(c,f),fetch(t,r).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((e=>{!0!==i.disableCache&&ft.add(t,e),pt(f),h(e)})).catch((t=>{pt(f),s(t)}))}}))}function mt(t){const{urlTemplate:e,x:i,y:a,z:o,maxAvailableZoom:s,subdomains:c,returnBlobURL:f,globalCompositeOperation:u}=t;return new Promise(((g,p)=>{const d=n(e);for(let t=0,e=d.length;t<e;t++){const e=d[t];if(e&&e.indexOf("{s}")>-1&&(!c||0===c.length))return void p(r("not find subdomains"))}let m,b,y,M,w=i,v=a,I=o;const P=o-s;if(P>0){let t=i,e=a,r=o;for(;r>s;)t=Math.floor(t/2),e=Math.floor(e/2),r--;const n=Math.pow(2,P);let h=Math.floor(t*n),c=h+n,f=Math.floor(e*n),l=f+n;h>i&&(h--,c--),f>a&&(f--,l--),m=(i-h)/(c-h),b=(a-f)/(l-f),y=1/(c-h),M=1/(l-f),w=t,v=e,I=s}const z=d.map((t=>{let e="{x}";for(;t.indexOf(e)>-1;)t=t.replace(e,w);for(e="{y}";t.indexOf(e)>-1;)t=t.replace(e,v);for(e="{z}";t.indexOf(e)>-1;)t=t.replace(e,I);return function(t,e){if(!e||!e.length)return t;const r=e.length;let n=Math.floor(Math.random()*r);for(n=Math.min(n,r-1);t.indexOf("{s}")>-1;)t=t.replace("{s}",e[n]);return t}(t,c)})),G=Object.assign({},h,t.headers||{}),C=z.map((e=>dt(e,G,t)));Promise.all(C).then((e=>{const r=A(),n=k(e,u);if(n instanceof Error)return void p(n);const i=T(r,B(r,n,t.filter),t.gaussianBlurRadius);let a;if(P<=0)a=S(i,t.opacity);else{const{width:e,height:n}=i,o=function(t,e,r,n,i,a){x(t,e.width,e.height);const o=E(t);o.save(),o.drawImage(e,r,n,i,a,0,0,t.width,t.height),o.restore();const s=t.transferToImageBitmap();return l(e),s}(r,i,e*m,n*b,e*y,n*M);a=S(o,t.opacity)}f?U(a).then((t=>{const e=URL.createObjectURL(t);g(e)})).catch((t=>{p(t)})):g(a)})).catch((t=>{p(t)}))}))}function bt(t,i){return new Promise(((a,s)=>{const c=n(t),f=Object.assign({},h,i.headers||{}),{returnBlobURL:l,terrainWidth:g,tileSize:p,terrainType:d}=i;if("mapzen"===d){const t=c.map((t=>dt(t,f,i)));Promise.all(t).then((t=>{const e=A(),r=k(t);if(r instanceof Error)return void s(r);x(e,r.width,r.height);const n=E(e);n.drawImage(r,0,0);const i=n.getImageData(0,0,e.width,e.height);!function(t){const e=t.data,r=[0,0,0];for(let t=0,n=e.length;t<n;t+=4){const n=e[t],i=e[t+1],a=e[t+2];if(0===e[t+3])continue;const o=256*n+i+a/256-32768,[s,h,c]=u(o,r);e[t]=s,e[t+1]=h,e[t+2]=c}}(i),n.putImageData(i,0,0);(t=>{l?U(t).then((t=>{const e=URL.createObjectURL(t);a(e)})).catch((t=>{s(t)})):a(t)})(e.transferToImageBitmap())})).catch((t=>{s(t)}))}else if("tianditu"===d||"cesium"===d){const t=c.map((t=>function(t,n={},i){return new Promise(((a,s)=>{const h=t=>{a(t)},c=i.__taskId;if(!c)return void s(r("taskId is null"));const f=lt.get(t);if(f)h(f);else{const r=i.fetchOptions||{headers:n,referrer:i.referrer},a=i.timeout||0,f=new AbortController,l=f.signal;a&&e(a)&&a>0&&setTimeout((()=>{f.abort(o)}),a),r.signal=l,delete r.timeout,gt(c,f),fetch(t,r).then((t=>t.arrayBuffer())).then((e=>{!0!==i.disableCache&&lt.add(t,e),pt(f),h(e)})).catch((t=>{pt(f),s(t)}))}}))}(t,f,i)));Promise.all(t).then((t=>{if(!t||0===t.length)return void s(r("buffers is null"));const e=t[0];if(0===e.byteLength)return void s(r("buffer is empty"));let n;n="tianditu"===d?rt(e,g,p):ht(e,g,p),n.image?a(n.image):s(r("generate terrain data error,not find image data"))})).catch((t=>{s(t)}))}else s(r("not support terrainType:"+d))}))}const yt=512;function Mt(t){return new Promise(((e,r)=>{const n=t.debug,i=t.items,a=t._workerId,o=[];i.forEach(((t,s)=>{const h=new OffscreenCanvas(t.width,t.height);E(h).drawImage(t.image,0,0),n&&console.log("workerId:"+a+",image to blob url :"+(s+1)+"/"+i.length),h.convertToBlob().then((r=>{const n=URL.createObjectURL(r);t.url=n,o.push(1),l(t.image),delete t.image,o.length===i.length&&e(i)})).catch((t=>{console.error(t),r(t)}))}))}))}function wt(t,e){vt(t.geometry,e)}function vt(t,e){if(t)switch(t.type){case"Point":At(t.coordinates,e);break;case"MultiPoint":case"LineString":xt(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let r=0,n=t.length;r<n;r++)xt(t[r],e)}(t.coordinates,e);break;case"Polygon":Et(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let r=0,n=t.length;r<n;r++)Et(t[r],e)}(t.coordinates,e);break;case"GeometryCollection":const r=t.geometries.length;for(let n=0;n<r;n++)vt(t.geometries[n],e)}}function At(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function xt(t,e){for(let r=0,n=t.length;r<n;r++)At(t[r],e)}function Et(t,e){t.length&&xt(t[0],e)}var It=function(t){let e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const r=t.features.length;for(let n=0;n<r;n++)wt(t.features[n],e);break;case"Feature":wt(t,e);break;default:vt(t,e)}return e},kt=Pt;function Pt(t,e,r){var n,i,a,o,s,h=t.length,c=Bt(t[0],e),f=[];for(r||(r=[]),n=1;n<h;n++){for(i=t[n-1],o=s=Bt(a=t[n],e);;){if(!(c|o)){f.push(i),o!==s?(f.push(a),n<h-1&&(r.push(f),f=[])):n===h-1&&f.push(a);break}if(c&o)break;c?c=Bt(i=Ut(i,a,c,e),e):o=Bt(a=Ut(i,a,o,e),e)}c=s}return f.length&&r.push(f),r}function Ut(t,e,r,n){return 8&r?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:4&r?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:2&r?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:1&r?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function Bt(t,e){var r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Tt(t){const[e,r,n,i]=t;return[[e,r],[n,r],[n,i],[e,i]]}function St(t){let e=1/0,r=1/0,n=-1/0,i=-1/0;return t.forEach((t=>{e=Math.min(e,t[0]),n=Math.max(n,t[0]),r=Math.min(r,t[1]),i=Math.max(i,t[1])})),[e,r,n,i]}Pt.polyline=Pt,Pt.polygon=function(t,e){var r,n,i,a,o,s,h;for(n=1;n<=8;n*=2){for(r=[],a=!(Bt(i=t[t.length-1],e)&n),o=0;o<t.length;o++)(h=!(Bt(s=t[o],e)&n))!==a&&r.push(Ut(i,s,n,e)),h&&r.push(s),i=s,a=h;if(!(t=r).length)break}return r};const zt={};function Gt(t,e){return function(t){if(!t)return!1;const e=(t.geometry||{type:null}).type;return"Polygon"===e||"MultiPolygon"===e}(e)?zt[t]?r("the"+t+" geojson Already exists"):(zt[t]=e,function(t){t.bbox=t.bbox||It(t)}(e),e):r("geojson.feature is not Polygon")}function Ct(t,e){if(s(t)){const t=e=>{const r=[];for(let n=0,a=e.length;n<a;n++){const a=e[n];Array.isArray(a[0])?r.push(t(a)):r[n]=i(a)}return r};return t(e)}return e}function Nt(t,e,r){const[n,i,a,o]=t,s=(a-n)/e,h=(o-i)/e,[c,f]=r;return[(c-n)/s,e-(f-i)/h]}function Lt(t,e,r,n){const[a,o,h,c]=e,f=(t,e)=>{const n=[];for(let i=0,a=t.length;i<a;i++){const a=t[i];Array.isArray(a[0])?n.push(f(a,e)):n[i]=Nt(e,r,a)}return n};if(s(t)){const[t,e]=i([a,o]),[r,s]=i([h,c]);return f(n,[t,e,r,s])}return f(n,e)}const Ot=Math.PI/180,Dt=180/Math.PI,Rt=6378137,_t=20037508.342789244,jt="900913",Ft={};function Yt(t){return Number(t)===t&&t%1!=0}
/**
     * @preserve
     * gcoord 1.0.7, geographic coordinate library
     * Copyright (c) 2025 Jiulong Hu <me@hujiulong.com>
     */
const{sin:Wt,cos:qt,sqrt:Jt,abs:Vt,PI:Zt}=Math,Ht=6378245,$t=.006693421622965823;function Kt(t,e){return t>=72.004&&t<=137.8347&&e>=.8293&&e<=55.8271}function Xt(t,e){let r=function(t,e){let r=300+t+2*e+.1*t*t+.1*t*e+.1*Jt(Vt(t));return r+=2*(20*Wt(6*t*Zt)+20*Wt(2*t*Zt))/3,r+=2*(20*Wt(t*Zt)+40*Wt(t/3*Zt))/3,r+=2*(150*Wt(t/12*Zt)+300*Wt(t/30*Zt))/3,r}(t-105,e-35),n=function(t,e){let r=2*t-100+3*e+.2*e*e+.1*t*e+.2*Jt(Vt(t));return r+=2*(20*Wt(6*t*Zt)+20*Wt(2*t*Zt))/3,r+=2*(20*Wt(e*Zt)+40*Wt(e/3*Zt))/3,r+=2*(160*Wt(e/12*Zt)+320*Wt(e*Zt/30))/3,r}(t-105,e-35);const i=e/180*Zt;let a=Wt(i);a=1-$t*a*a;const o=Jt(a);return r=180*r/(Ht/o*qt(i)*Zt),n=180*n/(Ht*(1-$t)/(a*o)*Zt),[r,n]}function Qt(t){const[e,r]=t;if(!Kt(e,r))return[e,r];const n=Xt(e,r);return[e+n[0],r+n[1]]}function te(t){const[e,r]=t;if(!Kt(e,r))return[e,r];let[n,i]=[e,r],a=Qt([n,i]),o=a[0]-e,s=a[1]-r;for(;Vt(o)>1e-6||Vt(s)>1e-6;)n-=o,i-=s,a=Qt([n,i]),o=a[0]-e,s=a[1]-r;return[n,i]}const{sin:ee,cos:re,atan2:ne,sqrt:ie,PI:ae}=Math,oe=3e3*ae/180;function se(t){const[e,r]=t,n=e-.0065,i=r-.006,a=ie(n*n+i*i)-2e-5*ee(i*oe),o=ne(i,n)-3e-6*re(n*oe);return[a*re(o),a*ee(o)]}function he(t){const[e,r]=t,n=e,i=r,a=ie(n*n+i*i)+2e-5*ee(i*oe),o=ne(i,n)+3e-6*re(n*oe);return[a*re(o)+.0065,a*ee(o)+.006]}const ce=180/Math.PI,fe=Math.PI/180,le=6378137,ue=20037508.342789244;function ge(t){return[t[0]*ce/le,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/le)))*ce]}function pe(t){const e=Math.abs(t[0])<=180?t[0]:t[0]-360*(t[0]<0?-1:1),r=[le*e*fe,le*Math.log(Math.tan(.25*Math.PI+.5*t[1]*fe))];return r[0]>ue&&(r[0]=ue),r[0]<-ue&&(r[0]=-ue),r[1]>ue&&(r[1]=ue),r[1]<-ue&&(r[1]=-ue),r}const{abs:de}=Math,me=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],be=[75,60,45,30,15,0],ye=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],Me=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]];function we(t,e,r){const n=de(e)/r[9];let i=r[0]+r[1]*de(t),a=r[2]+r[3]*n+r[4]*Math.pow(n,2)+r[5]*Math.pow(n,3)+r[6]*Math.pow(n,4)+r[7]*Math.pow(n,5)+r[8]*Math.pow(n,6);return i*=t<0?-1:1,a*=e<0?-1:1,[i,a]}function ve(t){const[e,r]=t;let n=[];for(let t=0;t<be.length;t++)if(de(r)>be[t]){n=Me[t];break}return we(e,r,n)}function Ae(t){const[e,r]=t;let n=[];for(let t=0;t<me.length;t++)if(de(r)>=me[t]){n=ye[t];break}return we(e,r,n)}function xe(t,e){if(!t)throw new Error(e)}function Ee(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}function Ie(t){return!isNaN(Number(t))&&null!==t&&!Ee(t)}function ke(...t){const e=t.length-1;return function(...r){let n=e,i=t[e].apply(null,r);for(;n--;)i=t[n].call(null,i);return i}}function Pe(t,e,r=!1){if(null===t)return;let n,i,a,o,s,h,c,f,l=0,u=0;const{type:g}=t,p="FeatureCollection"===g,d="Feature"===g,m=p?t.features.length:1;for(let g=0;g<m;g++){c=p?t.features[g].geometry:d?t.geometry:t,f=!!c&&"GeometryCollection"===c.type,h=f?c.geometries.length:1;for(let t=0;t<h;t++){let h=0,p=0;if(o=f?c.geometries[t]:c,null===o)continue;const d=o.type;switch(l=!r||"Polygon"!==d&&"MultiPolygon"!==d?0:1,d){case null:break;case"Point":if(s=o.coordinates,!1===e(s,u,g,h,p))return!1;u++,h++;break;case"LineString":case"MultiPoint":for(s=o.coordinates,n=0;n<s.length;n++){if(!1===e(s[n],u,g,h,p))return!1;u++,"MultiPoint"===d&&h++}"LineString"===d&&h++;break;case"Polygon":case"MultiLineString":for(s=o.coordinates,n=0;n<s.length;n++){for(i=0;i<s[n].length-l;i++){if(!1===e(s[n][i],u,g,h,p))return!1;u++}"MultiLineString"===d&&h++,"Polygon"===d&&p++}"Polygon"===d&&h++;break;case"MultiPolygon":for(s=o.coordinates,n=0;n<s.length;n++){for(p=0,i=0;i<s[n].length;i++){for(a=0;a<s[n][i].length-l;a++){if(!1===e(s[n][i][a],u,g,h,p))return!1;u++}p++}h++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===Pe(o.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}var Ue;!function(t){t.WGS84="WGS84",t.WGS1984="WGS84",t.EPSG4326="WGS84",t.GCJ02="GCJ02",t.AMap="GCJ02",t.BD09="BD09",t.BD09LL="BD09",t.Baidu="BD09",t.BMap="BD09",t.BD09MC="BD09MC",t.BD09Meter="BD09MC",t.EPSG3857="EPSG3857",t.EPSG900913="EPSG3857",t.EPSG102100="EPSG3857",t.WebMercator="EPSG3857",t.WM="EPSG3857"}(Ue||(Ue={}));var Be={WGS84:{to:{[Ue.GCJ02]:Qt,[Ue.BD09]:ke(he,Qt),[Ue.BD09MC]:ke(ve,he,Qt),[Ue.EPSG3857]:pe}},GCJ02:{to:{[Ue.WGS84]:te,[Ue.BD09]:he,[Ue.BD09MC]:ke(ve,he),[Ue.EPSG3857]:ke(pe,te)}},BD09:{to:{[Ue.WGS84]:ke(te,se),[Ue.GCJ02]:se,[Ue.EPSG3857]:ke(pe,te,se),[Ue.BD09MC]:ve}},EPSG3857:{to:{[Ue.WGS84]:ge,[Ue.GCJ02]:ke(Qt,ge),[Ue.BD09]:ke(he,Qt,ge),[Ue.BD09MC]:ke(ve,he,Qt,ge)}},BD09MC:{to:{[Ue.WGS84]:ke(te,se,Ae),[Ue.GCJ02]:ke(se,Ae),[Ue.EPSG3857]:ke(pe,te,se,Ae),[Ue.BD09]:Ae}}};const Te=Object.assign(Object.assign({},Ue),{CRSTypes:Ue,transform:function(t,e,r){if(xe(!!t,"The args[0] input coordinate is required"),xe(!!e,"The args[1] original coordinate system is required"),xe(!!r,"The args[2] target coordinate system is required"),e===r)return t;const n=Be[e];xe(!!n,`Invalid original coordinate system: ${e}`);const i=n.to[r];xe(!!i,`Invalid target coordinate system: ${r}`);const a=typeof t;if(xe("string"===a||"object"===a,`Invalid input coordinate type: ${a}`),"string"===a)try{t=JSON.parse(t)}catch(e){throw new Error(`Invalid input coordinate: ${t}`)}let o=!1;Ee(t)&&(xe(t.length>=2,`Invalid input coordinate: ${t}`),xe(Ie(t[0])&&Ie(t[1]),`Invalid input coordinate: ${t}`),t=t.map(Number),o=!0);const s=i;return o?s(t):(Pe(t,(t=>{[t[0],t[1]]=s(t)})),t)}}),Se=256,ze=[-180,90],Ge=[-20037508.342787,20037508.342787],Ce=new class{#t;#e;#r;#n;#i;#a;constructor(t={}){if(this.#t=t.size||256,this.#e=t.antimeridian?2:1,!Ft[this.#t]){let t=this.#t;const e=Ft[this.#t]={};e.Bc=[],e.Cc=[],e.zc=[],e.Ac=[];for(let r=0;r<30;r++)e.Bc.push(t/360),e.Cc.push(t/(2*Math.PI)),e.zc.push(t/2),e.Ac.push(t),t*=2}this.#r=Ft[this.#t].Bc,this.#n=Ft[this.#t].Cc,this.#i=Ft[this.#t].zc,this.#a=Ft[this.#t].Ac}px(t,e){if(Yt(e)){const r=this.#t*Math.pow(2,e),n=r/2,i=r/360,a=r/(2*Math.PI),o=r,s=Math.min(Math.max(Math.sin(Ot*t[1]),-.9999),.9999);let h=n+t[0]*i,c=n+.5*Math.log((1+s)/(1-s))*-a;return h>o*this.#e&&(h=o*this.#e),c>o&&(c=o),[h,c]}{const r=this.#i[e],n=Math.min(Math.max(Math.sin(Ot*t[1]),-.9999),.9999);let i=Math.round(r+t[0]*this.#r[e]),a=Math.round(r+.5*Math.log((1+n)/(1-n))*-this.#n[e]);return i>this.#a[e]*this.#e&&(i=this.#a[e]*this.#e),a>this.#a[e]&&(a=this.#a[e]),[i,a]}}ll(t,e){if(Yt(e)){const r=this.#t*Math.pow(2,e),n=r/360,i=r/(2*Math.PI),a=r/2,o=(t[1]-a)/-i;return[(t[0]-a)/n,Dt*(2*Math.atan(Math.exp(o))-.5*Math.PI)]}{const r=(t[1]-this.#i[e])/-this.#n[e];return[(t[0]-this.#i[e])/this.#r[e],Dt*(2*Math.atan(Math.exp(r))-.5*Math.PI)]}}convert(t,e){return e===jt?[...this.forward(t.slice(0,2)),...this.forward(t.slice(2,4))]:[...this.inverse(t.slice(0,2)),...this.inverse(t.slice(2,4))]}inverse(t){return[t[0]*Dt/Rt,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/Rt)))*Dt]}forward(t){const e=[Rt*t[0]*Ot,Rt*Math.log(Math.tan(.25*Math.PI+.5*t[1]*Ot))];return e[0]>_t&&(e[0]=_t),e[0]<-_t&&(e[0]=-_t),e[1]>_t&&(e[1]=_t),e[1]<-_t&&(e[1]=-_t),e}bbox(t,e,r,n,i){n&&(e=Math.pow(2,r)-1-e);const a=[t*this.#t,(+e+1)*this.#t],o=[(+t+1)*this.#t,e*this.#t],s=[...this.ll(a,r),...this.ll(o,r)];return i===jt?this.convert(s,jt):s}xyz(t,e,r,n){const i=n===jt?this.convert(t,"WGS84"):t,a=[i[0],i[1]],o=[i[2],i[3]],s=this.px(a,e),h=this.px(o,e),c=[Math.floor(s[0]/this.#t),Math.floor((h[0]-1)/this.#t)],f=[Math.floor(h[1]/this.#t),Math.floor((s[1]-1)/this.#t)],l={minX:Math.min.apply(Math,c)<0?0:Math.min.apply(Math,c),minY:Math.min.apply(Math,f)<0?0:Math.min.apply(Math,f),maxX:Math.max.apply(Math,c),maxY:Math.max.apply(Math,f)};if(r){const t={minY:Math.pow(2,e)-1-l.maxY,maxY:Math.pow(2,e)-1-l.minY};l.minY=t.minY,l.maxY=t.maxY}return l}}({size:Se});function Ne(t){return 1.40625/Math.pow(2,t)}function Le(t,e,r){if(!r)return;const n=Tt(t).map((t=>{if("EPSG:3857"===e){return Te.transform(t,Te.WebMercator,Te.WGS84)}return t})).map((t=>Te.transform(t,Te.WGS84,Te.AMap)));let a=1/0,o=1/0,s=-1/0,h=-1/0;if(n.forEach((t=>{const[e,r]=t;a=Math.min(a,e),o=Math.min(o,r),s=Math.max(s,e),h=Math.max(h,r)})),"EPSG:4326"===e)t[0]=a,t[1]=o,t[2]=s,t[3]=h;else{const e=Tt([a,o,s,s]).map((t=>i(t)));let r=1/0,n=1/0,h=-1/0,c=-1/0;e.forEach((t=>{const[e,i]=t;r=Math.min(r,e),n=Math.min(n,i),h=Math.max(h,e),c=Math.max(c,i)})),t[0]=r,t[1]=n,t[2]=h,t[3]=c}}function Oe(t,e,r,n=0,i){n=n||0;const[a,o]=Ge,s=(h=r,156543.03392804097/Math.pow(2,h)*Se);var h;const c=function(t,e,r){const[n,i]=ze,a=Ne(r)*Se;let o=t,s=e;return o=Math.floor(o),s=Math.floor(s),[n+o*a,s*a-i,n+(o+1)*a,(s+1)*a-i]}(t,e,r);Le(c,"EPSG:4326",i);const f=St(Tt(c).map((t=>Ce.forward(t)))),[l,u,g,p]=f;let d=(l-a)/s,m=(g-a)/s,b=(o-p)/s,y=(o-u)/s;if(d=Math.floor(d),m=Math.floor(m),b=Math.floor(b),y=Math.floor(y),m<d||y<b)return;const M=[];for(let t=b;t<=y;t++)for(let e=d;e<=m;e++)M.push([e,t,r+n]);const w=M.map((t=>{const[e,r,n]=t;return Ce.bbox(e,r,n,!1,"900913")})),[v,A,x,E]=function(t){let e=1/0,r=1/0,n=-1/0,i=-1/0;return t.forEach((t=>{const[a,o,s,h]=t;e=Math.min(e,a),n=Math.max(n,s),r=Math.min(r,o),i=Math.max(i,h)})),[e,r,n,i]}(w);return{tiles:M,tilesbbox:[v,A,x,E],bbox:c,mbbox:f,x:t,y:e,z:r}}function De(t,e,r,n){const{width:i,height:a}=t,[o,s,h,c]=e,f=(h-o)/i,u=(c-s)/a;let[g,p,d,m]=r;g-=f,d+=f,p-=u,m+=u;let b=(g-o)/f,y=(c-m)/u,M=(d-o)/f,w=(c-p)/u;b=Math.floor(b),y=Math.floor(y),M=Math.ceil(M),w=Math.ceil(w);const v=M-b,I=w-y,k=A();x(k,v,I);const P=E(k);P.drawImage(t,b,y,v,I,0,0,v,I),l(t);const U=P.getImageData(0,0,v,I).data,B=[];let T=1/0,S=1/0,z=-1/0,G=-1/0,C=-1;const N="EPSG:4326"===n?Ce.forward:Ce.inverse;for(let t=1;t<=I;t++){const e=m-(t-1)*u,r=e-u;for(let n=1;n<=v;n++){const i=(t-1)*v*4+4*(n-1),a=U[i],o=U[i+1],s=U[i+2],h=U[i+3],c=g+(n-1)*f,l=N([c,e]);T=Math.min(T,l[0]),z=Math.max(z,l[0]),S=Math.min(S,l[1]),G=Math.max(G,l[1]);const u=[c,r];B[++C]={point:l,point1:N(u),r:a,g:o,b:s,a:h}}}return{pixels:B,bbox:[T,S,z,G],width:v,height:I,image:k.transferToImageBitmap()}}function Re(t,e,r){const[n,i,a,o]=e,s=(a-n)/Se,h=(o-i)/Se,{pixels:c,bbox:f}=t,[l,u,g,p]=f;let d=(g-l)/s,m=(p-u)/h;if(d=Math.round(d),m=Math.round(m),isNaN(d)||isNaN(m)||0===Math.min(d,m)||Math.abs(d)===1/0||Math.abs(m)===1/0)return;const b=A();x(b,d,m);const y=E(b);function M(t,e){let r=Math.round((t-l)/s+1);r=Math.min(r,d);let n=Math.round((p-e)/h+1);return n=Math.min(n,m),[r,n]}const w=y.createImageData(d,m),v=w.data;for(let t=0,e=c.length;t<e;t++){const{point:e,point1:r,r:n,g:i,b:a,a:o}=c[t],[s,h]=e,[f,l]=r,[u,g]=M(s,h),[p,m]=M(f,l);for(let t=g;t<=m;t++){const e=(t-1)*d*4+4*(u-1);v[e]=n,v[e+1]=i,v[e+2]=a,v[e+3]=o}}y.putImageData(w,0,0);const I=b.transferToImageBitmap(),k=Math.round((n-l)/s),P=Math.round((p-o)/h),U=A();x(U,Se,Se);const B=E(b);return B.drawImage(I,k-1,P,Se,Se,0,0,Se,Se),function(t){const e=t.canvas,{width:r,height:n}=e,i=t.getImageData(0,0,r,n),a=i.data,o=()=>{for(let t=1;t<=n;t++){if(a[4*r*(t-1)+0+3]>0)return!1}return!0},s=t=>{for(let e=1;e<=n;e++){if(a[4*r*(e-1)+4*(t-1)+3]>0)return!1}return!0},h=()=>{for(let t=1;t<=r;t++){if(a[4*(t-1)+(n-1)*r*4+3]>0)return!1}return!0};if(o())for(let t=1;t<=n;t++){const e=4*r*(t-1)+0,n=e+4,i=a[n],o=a[n+1],s=a[n+2],h=a[n+3];a[e]=i,a[e+1]=o,a[e+2]=s,a[e+3]=h}if(h())for(let t=1;t<=r;t++){const e=4*(t-1)+(n-1)*r*4,i=4*(t-1)+(n-2)*r*4,o=a[i],s=a[i+1],h=a[i+2],c=a[i+3];a[e]=o,a[e+1]=s,a[e+2]=h,a[e+3]=c}const c=[];for(let t=1,e=r;t<=e;t++)c.push(s(t));if(c.indexOf(!0)>-1){const t=(t,e)=>{for(let i=1;i<=n;i++){const n=4*r*(i-1)+4*(t-1),o=4*r*(i-1)+4*(e-1),s=a[o],h=a[o+1],c=a[o+2],f=a[o+3];a[n]=s,a[n+1]=h,a[n+2]=c,a[n+3]=f}};for(let e=1;e<=r;e++){if(!c[e-1])continue;const r=c[e],n=c[e-1];r?n||t(e,e-1):t(e,e+1)}}t.putImageData(i,0,0)}(B),r&&(B.lineWidth=.4,B.strokeStyle="red",B.rect(0,0,Se,Se),B.stroke()),U.transferToImageBitmap()}function _e(t){return new Promise(((e,r)=>{const{x:n,y:a,z:o,projection:s,zoomOffset:h,errorLog:c,debug:f,returnBlobURL:u,isGCJ02:g}=t,p=t=>{u?U(t).then((t=>{const r=URL.createObjectURL(t);e(r)})).catch((t=>{r(t)})):e(t)};(()=>{let e;"EPSG:4326"===s?e=function(t,e,r,n=0,a){n=n||0;const[o,s]=ze,h=Ne(r)*Se,c=Ce.bbox(t,e,r);Le(c,"EPSG:4326",a);const[f,l,u,g]=c;let p=(f-o)/h,d=(u-o)/h,m=(s-g)/h,b=(s-l)/h;if(p=Math.floor(p),d=Math.floor(d),m=Math.floor(m),b=Math.floor(b),d<p||b<m)return;const y=[];for(let t=m;t<=b;t++)for(let e=p;e<=d;e++)y.push([e-1,t,r+n]);return{tiles:y,tilesbbox:[o+(p-1)*h,s-(b+1)*h,o+d*h,s-m*h],bbox:c,mbbox:St(Tt(c).map((t=>i(t)))),x:t,y:e,z:r}}(n,a,o,h||0,g):"EPSG:3857"===s&&(e=Oe(n,a,o,h||0,g));const{tiles:r}=e||{};if(!r||0===r.length)return void p(I());e.loadCount=0;const u=()=>{if(e.loadCount>=r.length){const t=function(t,e){let r=1/0,n=1/0,i=-1/0,a=-1/0,o=256;t.forEach((t=>{const[e,s]=t;r=Math.min(e,r),n=Math.min(s,n),i=Math.max(e,i),a=Math.max(s,a),o=t.tileImage.width}));const s=(i-r+1)*o,h=(a-n+1)*o,c=A();x(c,s,h);const f=E(c);return e&&(f.font="bold 48px serif",f.textAlign="center",f.textBaseline="middle",f.fillStyle="red"),t.forEach((t=>{const[i,a,s]=t,h=(i-r)*o,c=(a-n)*o;let l=t.tileImage;f.drawImage(l,h,c,o,o),e&&f.fillText([i,a,s].join("_").toString(),h+100,c+100)})),l(t.map((t=>t.tileImage))),c.transferToImageBitmap()}(r,f);let n;if("EPSG:4326"===s){n=Re(De(t,e.tilesbbox,e.bbox,s),e.mbbox,f),p(n||I())}else{n=Re(De(t,e.tilesbbox,e.mbbox,s),e.bbox,f),p(n||I())}}else{const n=r[e.loadCount],[i,a,o]=n;mt(Object.assign({},t,{x:i,y:a,z:o,returnBlobURL:!1})).then((t=>{n.tileImage=t,e.loadCount++,u()})).catch((t=>{c&&console.error(t),n.tileImage=I(),e.loadCount++,u()}))}};u()})()}))}function je(t){const e=[];return f(t)&&e.push(t),e}t.initialize=function(){},t.onmessage=function(t,e){const i=t.data||{},o=i._type;if("getTile"===o){const{url:t}=i;return void function(t,e){return new Promise(((r,i)=>{const a=n(t),o=Object.assign({},h,e.headers||{}),s=a.map((t=>dt(t,o,e))),{returnBlobURL:c,globalCompositeOperation:f}=e;Promise.all(s).then((t=>{const n=A(),a=k(t,f);if(a instanceof Error)return void i(a);const o=S(T(n,B(n,a,e.filter),e.gaussianBlurRadius),e.opacity);c?U(o).then((t=>{const e=URL.createObjectURL(t);r(e)})).catch((t=>{i(t)})):r(o)})).catch((t=>{i(t)}))}))}(t,i).then((t=>{e(null,t,je(t))})).catch((t=>{e(t)}))}if("getTileWithMaxZoom"===o)return void mt(i).then((t=>{e(null,t,je(t))})).catch((t=>{e(t)}));if("clipTile"===o)return void(s=i,new Promise(((t,e)=>{const{tile:n,tileBBOX:i,projection:a,tileSize:o,maskId:h,returnBlobURL:c,reverse:f}=s,l=zt[h];if(!l)return void e(r("not find mask by maskId:"+h));const u=A(o),g=r=>{c?U(r).then((e=>{const r=URL.createObjectURL(e);t(r)})).catch((t=>{e(t)})):t(r)},p=l.bbox;if(!p)return void g(n);const{coordinates:d,type:m}=l.geometry;if(!d.length)return void g(n);const b=()=>{g(f?n:I(o))};if(M=i,(y=p)[2]<M[0]||y[1]>M[3]||y[0]>M[2]||y[3]<M[1])return void b();var y,M;let w,v=d;if("Polygon"===m&&(v=[v]),function(t,e){const[r,n,i,a]=t;return r>=e[0]&&i<=e[2]&&n>=e[1]&&a<=e[3]}(p,i)){w=Ct(a,v);const t=P(u,Lt(a,i,o,w),n,f);return void g(t)}const x=t=>{if(t.length>0){let e=1/0,r=-1/0,n=1/0,i=-1/0;for(let a=0,o=t.length;a<o;a++){const[o,s]=t[a];e=Math.min(o,e),n=Math.min(s,n),r=Math.max(o,r),i=Math.max(s,i)}if(e!==r&&n!==i)return!0}return!1},E=[];for(let t=0,e=v.length;t<e;t++){const e=v[t];for(let t=0,r=e.length;t<r;t++){const r=e[t],n=kt.polygon(r,i);x(n)&&E.push([n])}}if(0===E.length)return void b();w=Ct(a,E);const k=P(u,Lt(a,i,o,w),n,f);g(k)}))).then((t=>{e(null,t,je(t))})).catch((t=>{e(t)}));var s,u;if("transformTile"===o)return void _e(i).then((t=>{e(null,t,je(t))})).catch((t=>{e(t)}));if("injectMask"===o){const t=Gt(i.maskId,i.geojsonFeature);return t instanceof Error?void e(t):void e()}if("removeMask"===o)return u=i.maskId,delete zt[u],void e();if("cancelFetch"===o){const t=i.taskId||i.__taskId;return t?(function(t){const e=ut[t]||[];e.length&&e.forEach((t=>{t.abort(a)})),delete ut[t]}(t),void e()):void e(r("cancelFetch need taskId"))}if("imageSlicing"===o)return void function(t){return t.disableCache=!0,new Promise(((e,r)=>{const i=n(t.url),a=Object.assign({},h,t.headers||{}),o=i.map((e=>dt(e,a,t)));Promise.all(o).then((n=>{const i=A(yt),a=k(n);if(a instanceof Error)return void r(a);const{width:o,height:s}=a,h=Math.ceil(s/yt),f=Math.ceil(o/yt),u=[];for(let e=1;e<=h;e++){const r=(e-1)*yt,n=Math.min(s,e*yt);for(let s=1;s<=f;s++){const h=(s-1)*yt,f=Math.min(o,s*yt)-h,l=n-r;x(i,f,l),E(i).drawImage(a,h,r,f,l,0,0,i.width,i.height);const g=i.transferToImageBitmap(),p=S(T(i,B(i,g,t.filter),t.gaussianBlurRadius),t.opacity);u.push({id:(c++,c),x:h,y:r,width:f,height:l,row:e,col:s,image:p})}}const g={rows:h,cols:f,rowWidth:yt,colsHeight:yt,width:o,height:s,items:u};l(a),e(g)})).catch((t=>{r(t)}))}))}(i).then((t=>{const r=[];(t.items||[]).forEach((t=>{f(t.image)&&r.push(t.image)})),e(null,t,r)})).catch((t=>{e(t)}));if("imageToBlobURL"===o)return void Mt(i).then((t=>{e(null,t,[])})).catch((t=>{e(t)}));if("encodeTerrainTile"===o){const{url:t}=i;return void bt(t,i).then((t=>{e(null,t,je(t))})).catch((t=>{e(t)}))}const g="not support message type:"+o;console.error(g),e(r(g))},Object.defineProperty(t,"__esModule",{value:!0})})
