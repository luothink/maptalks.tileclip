export default `(function(t){"use strict";function e(t,e){n(t.geometry,e)}function n(t,e){if(t)switch(t.type){case"Point":r(t.coordinates,e);break;case"MultiPoint":case"LineString":o(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let n=0,r=t.length;n<r;n++)o(t[n],e)}(t.coordinates,e);break;case"Polygon":i(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let n=0,r=t.length;n<r;n++)i(t[n],e)}(t.coordinates,e);break;case"GeometryCollection":const s=t.geometries.length;for(let r=0;r<s;r++)n(t.geometries[r],e)}}function r(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function o(t,e){for(let n=0,o=t.length;n<o;n++)r(t[n],e)}function i(t,e){t.length&&o(t[0],e)}var s=function(t){let r=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const o=t.features.length;for(let n=0;n<o;n++)e(t.features[n],r);break;case"Feature":e(t,r);break;default:n(t,r)}return r},a=c;function c(t,e,n){var r,o,i,s,a,c=t.length,l=u(t[0],e),f=[];for(n||(n=[]),r=1;r<c;r++){for(o=t[r-1],s=a=u(i=t[r],e);;){if(!(l|s)){f.push(o),s!==a?(f.push(i),r<c-1&&(n.push(f),f=[])):r===c-1&&f.push(i);break}if(l&s)break;l?l=u(o=h(o,i,l,e),e):s=u(i=h(o,i,s,e),e)}l=a}return f.length&&n.push(f),n}function h(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function u(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function l(t){return"number"==typeof t}function f(t){return Array.isArray(t)?t:[t]}let d;function g(t=256){return!d&&OffscreenCanvas&&(d=new OffscreenCanvas(1,1)),d&&(d.width=d.height=t),d}function m(t){const e=t.canvas;t.clearRect(0,0,e.width,e.height)}function p(t){return t.getContext("2d")}function v(t){const e=g(t);return m(p(e)),e.transferToImageBitmap()}function w(t){if(1===t.length)return t[0];if(0===t.length)return new Error("merge tiles error,not find imagebitmaps");for(let e=0,n=t.length;e<n;e++){if(!(t[e]instanceof ImageBitmap))return new Error("merge tiles error,images not imagebitmap")}const e=t[0].width,n=g(e),r=p(n);return m(r),t.forEach((t=>{r.drawImage(t,0,0,e,e)})),n.transferToImageBitmap()}function I(t,e,n){const r=p(t);m(r),r.save();r.beginPath(),e.forEach((t=>{(t=>{for(let e=0,n=t.length;e<n;e++){const n=t[e],o=n[0],i=n[n.length-1],[s,a]=o,[c,h]=i;s===c&&a===h||n.push(o);for(let t=0,e=n.length;t<e;t++){const[e,o]=n[t];0===t?r.moveTo(e,o):r.lineTo(e,o)}}})(t)})),r.clip("evenodd"),r.drawImage(n,0,0,t.width,t.height);const o=t.transferToImageBitmap();return r.restore(),o}function b(t,e,n){if(!n)return e;t.width=e.width,t.height=e.height;const r=p(t);m(r),r.save(),r.filter=n,r.drawImage(e,0,0),r.restore();return t.transferToImageBitmap()}function y(t,e=1){if(!l(e)||1===e||e<0||e>1)return t;const n=g();n.width=t.width,n.height=t.height;const r=p(n);m(r),r.globalAlpha=e,r.drawImage(t,0,0);const o=n.transferToImageBitmap();return r.globalAlpha=1,o}c.polyline=c,c.polygon=function(t,e){var n,r,o,i,s,a,c;for(r=1;r<=8;r*=2){for(n=[],i=!(u(o=t[t.length-1],e)&r),s=0;s<t.length;s++)(c=!(u(a=t[s],e)&r))!==i&&n.push(h(o,a,r,e)),c&&n.push(a),o=a,i=c;if(!(t=n).length)break}return n};const x={};function M(t){return"EPSG:3857"===t}function E(t,e){return function(t){if(!t)return!1;const e=(t.geometry||{type:null}).type;return"Polygon"===e||"MultiPolygon"===e}(e)?x[t]?new Error("the"+t+" geojson Already exists"):(x[t]=e,function(t){t.bbox=t.bbox||s(t)}(e),e):new Error("geojson.feature is not Polygon")}function k(t){const[e,n]=t,r=6378137,o=e*Math.PI/180*r,i=n*Math.PI/180;return[o,3189068.5*Math.log((1+Math.sin(i))/(1-Math.sin(i)))]}function T(t,e){if(M(t)){const t=e=>{const n=[];for(let r=0,o=e.length;r<o;r++){const o=e[r];Array.isArray(o[0])?n.push(t(o)):n[r]=k(o)}return n};return t(e)}return e}function P(t,e,n){const[r,o,i,s]=t,a=(i-r)/e,c=(s-o)/e,[h,u]=n;return[(h-r)/a,e-(u-o)/c]}function A(t,e,n,r){const[o,i,s,a]=e,c=(t,e)=>{const r=[];for(let o=0,i=t.length;o<i;o++){const i=t[o];Array.isArray(i[0])?r.push(c(i,e)):r[o]=P(e,n,i)}return r};if(M(t)){const[t,e]=k([o,i]),[n,h]=k([s,a]);return c(r,[t,e,n,h])}return c(r,e)}function B(t){return new Promise(((e,n)=>{const{tile:r,tileBBOX:o,projection:i,tileSize:s,maskId:c,returnBlobURL:h}=t;if(!r)return void n(new Error("tile is null.It should be a ImageBitmap"));if(!o)return void n(new Error("tileBBOX is null"));if(!i)return void n(new Error("projection is null"));if(!s)return void n(new Error("tileSize is null"));if(!c)return void n(new Error("maskId is null"));const u=x[c];if(!u)return void n(new Error("not find mask by maskId:"+c));const l=g(s);if(!l)return void n(new Error("not find canvas.The current environment does not support OffscreenCanvas"));const f=t=>{h?function(t){const e=g();e.width=t.width,e.height=t.height;const n=p(e);return m(n),n.drawImage(t,0,0),e.convertToBlob()}(t).then((t=>{const n=URL.createObjectURL(t);e(n)})).catch((t=>{n(t)})):e(t)},d=u.bbox;if(!d)return void f(r);const{coordinates:w,type:b}=u.geometry;if(!w.length)return void f(r);if(M=o,(y=d)[2]<M[0]||y[1]>M[3]||y[0]>M[2]||y[3]<M[1])return void f(v(s));var y,M;let E,k=w;if("Polygon"===b&&(k=[k]),function(t,e){const[n,r,o,i]=t;return n>=e[0]&&o<=e[2]&&r>=e[1]&&i<=e[3]}(d,o)){E=T(i,k);return void f(I(l,A(i,o,s,E),r))}const P=t=>{if(t.length>0){let e=1/0,n=-1/0,r=1/0,o=-1/0;for(let i=0,s=t.length;i<s;i++){const[s,a]=t[i];e=Math.min(s,e),r=Math.min(a,r),n=Math.max(s,n),o=Math.max(a,o)}if(e!==n&&r!==o)return!0}return!1},B=[];for(let t=0,e=k.length;t<e;t++){const e=k[t];for(let t=0,n=e.length;t<n;t++){const n=e[t],r=a.polygon(n,o);P(r)&&B.push([r])}}if(0===B.length)return void f(v());E=T(i,B);f(I(l,A(i,o,s,E),r))}))}const O=()=>{};const N=new Error("not find canvas.The current environment does not support OffscreenCanvas"),z={accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.26"},R=new class{constructor(t,e){this.max=t,this.onRemove=e||O,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):(this.data.set(t,e),this.data.size>this.max&&this.shrink()),this):this}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const r of n)t[e++]=r;return t}shrink(){const t=this.data.keys();let e=t.next();for(;this.data.size>this.max;){const n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){if(!this.has(t))return null;return this.data.get(t)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.data.size>this.max&&this.shrink(),this}}(200,(t=>{t&&t.close&&t.close()}));function j(t,e={},n){return new Promise(((r,o)=>{const i=t=>{createImageBitmap(t).then((t=>{r(t)})).catch((t=>{o(t)}))},s=R.get(t);if(s)i(s);else{const r=n.fetchOptions||{headers:e,referrer:n.referrer};fetch(t,r).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((e=>{R.add(t,e),i(e)})).catch((t=>{o(t)}))}}))}function S(t){const{urlTemplate:e,x:n,y:r,z:o,maxAvailableZoom:i}=t,s=i&&l(i)&&i>=1;return new Promise(((a,c)=>{if(!s)return void c(new Error("maxAvailableZoom is error"));if(!e)return void c(new Error("urlTemplate is error"));if(!l(n)||!l(r)||!l(o))return void c(new Error("x/y/z is error"));const h=f(e);let u,d,v,I,x=n,M=r,E=o;const k=o-i;if(k>0){let t=n,e=r,s=o;for(;s>i;)t=Math.floor(t/2),e=Math.floor(e/2),s--;const a=Math.pow(2,k);let c=Math.floor(t*a),h=c+a,l=Math.floor(e*a),f=l+a;c>n&&(c--,h--),l>r&&(l--,f--),u=(n-c)/(h-c),d=(r-l)/(f-l),v=1/(h-c),I=1/(f-l),x=t,M=e,E=i}const T=h.map((t=>{let e="{x}";for(;t.indexOf(e)>-1;)t=t.replace(e,x);for(e="{y}";t.indexOf(e)>-1;)t=t.replace(e,M);for(e="{z}";t.indexOf(e)>-1;)t=t.replace(e,E);return t})),P=Object.assign({},z,t.headers||{}),A=T.map((e=>j(e,P,t)));Promise.all(A).then((e=>{const n=g();if(!n)return void c(N);const r=w(e);if(r instanceof Error)return void c(r);let o;const i=t.filter;if(o=i?b(n,r,i):r,k<=0)return void a(y(o,t.opacity));const{width:s,height:h}=o,l=function(t,e,n,r,o,i){t.width=e.width,t.height=e.height;const s=p(t);return m(s),s.save(),s.drawImage(e,n,r,o,i,0,0,t.width,t.height),s.restore(),t.transferToImageBitmap()}(n,o,s*u,h*d,s*v,h*I);a(y(l,t.opacity))})).catch((t=>{c(t)}))}))}t.initialize=function(){},t.onmessage=function(t,e){const n=t.data||{},r=n._type;if("getTile"!==r)if("getTileWithMaxZoom"!==r)if("clipTile"!==r){if("injectMask"===r){const t=E(n.maskId,n.geojsonFeature);return t instanceof Error?void e(t):void e()}if("removeMask"===r)return o=n.maskId,delete x[o],void e();var o;console.error("not support message type:",r)}else B(n).then((t=>{const n=[];t instanceof ImageBitmap&&n.push(t),e(null,t,n)})).catch((t=>{e(t)}));else S(n).then((t=>{e(null,t,[t])})).catch((t=>{e(t)}));else{const{url:t}=n;(function(t,e){return new Promise(((n,r)=>{if(!t)return void r(new Error("url is null"));const o=f(t),i=Object.assign({},z,e.headers||{}),s=o.map((t=>j(t,i,e)));Promise.all(s).then((t=>{const o=g();if(!o)return void r(N);const i=w(t);if(i instanceof Error)return void r(i);const s=e.filter;let a;a=s?b(o,i,s):i,n(y(a,e.opacity))})).catch((t=>{r(t)}))}))})(t,n).then((t=>{e(null,t,[t])})).catch((t=>{e(t)}))}},Object.defineProperty(t,"__esModule",{value:!0})})`
