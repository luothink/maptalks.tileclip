export default `(function(t){"use strict";function e(t){return"number"==typeof t}function r(t){return new Error(t)}function n(t){return Array.isArray(t)?t:[t]}const i=r("not find canvas.The current environment does not support OffscreenCanvas");function a(t){const[e,r]=t,n=6378137,i=e*Math.PI/180*n,a=r*Math.PI/180;return[i,3189068.5*Math.log((1+Math.sin(a))/(1-Math.sin(a)))]}const s=r("fetch tile data cancel"),o=r("fetch tile data timeout");function h(t){return"EPSG:3857"===t}const c={accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.26"};let f=0;function l(t){return t&&t instanceof ImageBitmap}function u(t){Array.isArray(t)||(t=[t]),t.forEach((t=>{t&&t.close&&t.close()}))}function d(t,e){const r=Math.floor(10*(t+1e4)),n=r>>16,i=r>>8&255,a=255&r;return e?(e[0]=n,e[1]=i,e[2]=a,e):[n,i,a]}var g,p,m,b,y,v;function w(t,e,r,n,i,a){var s,o,h,c,f,l,u,d,g,p,m,b,y,v,w,M,A,x,I,k,E,U,T,z,B,P,N,O,S,R;for(B=0;B<a;B++){for(T=B,z=0,h=(s=t[U=B*i])>>8&255,c=s>>16&255,f=s>>24&255,v=x=(o=255&s)*n[6],w=I=h*n[6],M=k=c*n[6],A=E=f*n[6],N=n[0],O=n[1],S=n[4],R=n[5],P=0;P<i;P++)p=(l=255&(s=t[U]))*N+o*O+v*S+x*R,m=(u=s>>8&255)*N+h*O+w*S+I*R,b=(d=s>>16&255)*N+c*O+M*S+k*R,y=(g=s>>24&255)*N+f*O+A*S+E*R,x=v,I=w,k=M,E=A,v=p,w=m,M=b,A=y,o=l,h=u,c=d,f=g,r[z]=v,r[z+1]=w,r[z+2]=M,r[z+3]=A,z+=4,U++;for(z-=4,T+=a*(i-1),h=(s=t[--U])>>8&255,c=s>>16&255,f=s>>24&255,v=x=(o=255&s)*n[7],w=I=h*n[7],M=k=c*n[7],A=E=f*n[7],l=o,u=h,d=c,g=f,N=n[2],O=n[3],P=i-1;P>=0;P--)p=l*N+o*O+v*S+x*R,m=u*N+h*O+w*S+I*R,b=d*N+c*O+M*S+k*R,y=g*N+f*O+A*S+E*R,x=v,I=w,k=M,E=A,v=p,w=m,M=b,A=y,o=l,h=u,c=d,f=g,l=255&(s=t[U]),u=s>>8&255,d=s>>16&255,g=s>>24&255,s=(r[z]+v|0)+(r[z+1]+w<<8)+(r[z+2]+M<<16)+(r[z+3]+A<<24),e[T]=s,U--,z-=4,T-=a}}var M=function(t,e,r,n){if(n){var i=new Uint32Array(t.buffer),a=new Uint32Array(i.length),s=new Float32Array(4*Math.max(e,r)),o=function(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,r=Math.exp(-e),n=Math.exp(-2*e),i=(1-r)*(1-r)/(1+2*e*r-n);return g=i,p=i*(e-1)*r,m=i*(e+1)*r,b=-i*n,y=2*r,v=-n,new Float32Array([g,p,m,b,y,v,(g+p)/(1-y-v),(m+b)/(1-y-v)])}(n);w(i,a,s,o,e,r),w(a,i,s,o,r,e)}};let A;function x(t=256){return!A&&OffscreenCanvas&&(A=new OffscreenCanvas(1,1)),A&&I(A,t,t),A}function I(t,e,r){t&&(t.width=e,t.height=r)}function k(t){const e=t.getContext("2d",{willReadFrequently:!0});return function(t){const e=t.canvas;t.clearRect(0,0,e.width,e.height)}(e),e}function E(t){const e=x(t);return k(e),e.transferToImageBitmap()}function U(t,e){if(1===t.length)return t[0];if(0===t.length)return r("merge tiles error,not find imagebitmaps");for(let e=0,n=t.length;e<n;e++){if(!l(t[e]))return r("merge tiles error,images not imagebitmap")}const n=t[0].width,i=x(n),a=k(i);return e&&(a.save(),a.globalCompositeOperation=e),t.forEach((t=>{a.drawImage(t,0,0,n,n)})),e&&a.restore(),u(t),i.transferToImageBitmap()}function T(t,e,r,n){const i=k(t);i.save();i.beginPath(),n&&i.rect(0,0,t.width,t.height),e.forEach((t=>{(t=>{for(let e=0,r=t.length;e<r;e++){const r=t[e],n=r[0],a=r[r.length-1],[s,o]=n,[h,c]=a;s===h&&o===c||r.push(n);for(let t=0,e=r.length;t<e;t++){const[e,n]=r[t];0===t?i.moveTo(e,n):i.lineTo(e,n)}}})(t)})),i.clip("evenodd"),i.drawImage(r,0,0,t.width,t.height);const a=t.transferToImageBitmap();return i.restore(),u(r),a}function z(t){const e=x();I(e,t.width,t.height);return k(e).drawImage(t,0,0),u(t),e.convertToBlob()}function B(t,e,r){if(!r)return e;I(t,e.width,e.height);const n=k(t);n.save(),n.filter=r,n.drawImage(e,0,0),n.restore();const i=t.transferToImageBitmap();return u(e),i}function P(t,r,n){if(!e(n)||n<=0)return r;I(t,r.width,r.height);const i=k(t);i.drawImage(r,0,0);const a=i.getImageData(0,0,t.width,t.height);M(a.data,t.width,t.height,n),i.putImageData(a,0,0);const s=t.transferToImageBitmap();return u(r),s}function N(t,r=1){if(!e(r)||1===r||r<0||r>1)return t;const n=x();I(n,t.width,t.height);const i=k(n);i.globalAlpha=r,i.drawImage(t,0,0);const a=n.transferToImageBitmap();return i.globalAlpha=1,u(t),a}const O=()=>{};class S{constructor(t,e){this.max=t,this.onRemove=e||O,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):(this.data.set(t,e),this.data.size>this.max&&this.shrink()),this):this}keys(){const t=new Array(this.data.size);let e=0;const r=this.data.keys();for(const n of r)t[e++]=n;return t}shrink(){const t=this.data.keys();let e=t.next();for(;this.data.size>this.max;){const r=this.getAndRemove(e.value);r&&this.onRemove(r),e=t.next()}}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){if(!this.has(t))return null;return this.data.get(t)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.data.size>this.max&&this.shrink(),this}}
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){function t(t){throw t}var e=void 0,r=!0,n=this;function i(t,r){var i,a=t.split("."),s=n;!(a[0]in s)&&s.execScript&&s.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||r===e?s=s[i]?s[i]:s[i]={}:s[i]=r}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function s(e,r){this.index="number"==typeof r?r:0,this.i=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var t,e=this.buffer,r=e.length,n=new(a?Uint8Array:Array)(r<<1);if(a)n.set(e);else for(t=0;t<r;++t)n[t]=e[t];return this.buffer=n},s.prototype.d=function(t,e,r){var n,i=this.buffer,a=this.index,s=this.i,o=i[a];if(r&&1<e&&(t=8<e?(u[255&t]<<24|u[t>>>8&255]<<16|u[t>>>16&255]<<8|u[t>>>24&255])>>32-e:u[t]>>8-e),8>e+s)o=o<<e|t,s+=e;else for(n=0;n<e;++n)o=o<<1|t>>e-n-1&1,8==++s&&(s=0,i[a++]=u[o],o=0,a===i.length&&(i=this.f()));i[a]=o,this.buffer=i,this.i=s,this.index=a},s.prototype.finish=function(){var t,e=this.buffer,r=this.index;return 0<this.i&&(e[r]<<=8-this.i,e[r]=u[e[r]],r++),a?t=e.subarray(0,r):(e.length=r,t=e),t};var o,h=new(a?Uint8Array:Array)(256);for(o=0;256>o;++o){for(var c=l=o,f=7,l=l>>>1;l;l>>>=1)c<<=1,c|=1&l,--f;h[o]=(c<<f&255)>>>0}var u=h;function d(t){this.buffer=new(a?Uint16Array:Array)(2*t),this.length=0}function g(t){var e,r,n,i,s,o,h,c,f,l,u=t.length,d=0,g=Number.POSITIVE_INFINITY;for(c=0;c<u;++c)t[c]>d&&(d=t[c]),t[c]<g&&(g=t[c]);for(e=1<<d,r=new(a?Uint32Array:Array)(e),n=1,i=0,s=2;n<=d;){for(c=0;c<u;++c)if(t[c]===n){for(o=0,h=i,f=0;f<n;++f)o=o<<1|1&h,h>>=1;for(l=n<<16|c,f=o;f<e;f+=s)r[f]=l;++i}++n,i<<=1,s<<=1}return[r,d,g]}function p(t,e){this.h=b,this.w=0,this.input=a&&t instanceof Array?new Uint8Array(t):t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=a&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}d.prototype.getParent=function(t){return 2*((t-2)/4|0)},d.prototype.push=function(t,e){var r,n,i,a=this.buffer;for(r=this.length,a[this.length++]=e,a[this.length++]=t;0<r&&(n=this.getParent(r),a[r]>a[n]);)i=a[r],a[r]=a[n],a[n]=i,i=a[r+1],a[r+1]=a[n+1],a[n+1]=i,r=n;return this.length},d.prototype.pop=function(){var t,e,r,n,i,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],i=0;!((n=2*i+2)>=this.length)&&(n+2<this.length&&a[n+2]>a[n]&&(n+=2),a[n]>a[i]);)r=a[i],a[i]=a[n],a[n]=r,r=a[i+1],a[i+1]=a[n+1],a[n+1]=r,i=n;return{index:t,value:e,length:this.length}};var m,b=2,y={NONE:0,r:1,k:b,N:3},v=[];for(m=0;288>m;m++)switch(r){case 143>=m:v.push([m+48,8]);break;case 255>=m:v.push([m-144+400,9]);break;case 279>=m:v.push([m-256+0,7]);break;case 287>=m:v.push([m-280+192,8]);break;default:t("invalid literal: "+m)}function w(t,e){this.length=t,this.G=e}p.prototype.j=function(){var n,i,o,h,c=this.input;switch(this.h){case 0:for(o=0,h=c.length;o<h;){var f,l,u,d=i=a?c.subarray(o,o+65535):c.slice(o,o+65535),g=(o+=i.length)===h,p=e,m=e,y=this.a,w=this.b;if(a){for(y=new Uint8Array(this.a.buffer);y.length<=w+d.length+5;)y=new Uint8Array(y.length<<1);y.set(this.a)}if(f=g?1:0,y[w++]=0|f,u=65536+~(l=d.length)&65535,y[w++]=255&l,y[w++]=l>>>8&255,y[w++]=255&u,y[w++]=u>>>8&255,a)y.set(d,w),w+=d.length,y=y.subarray(0,w);else{for(p=0,m=d.length;p<m;++p)y[w++]=d[p];y.length=w}this.b=w,this.a=y}break;case 1:var M=new s(a?new Uint8Array(this.a.buffer):this.a,this.b);M.d(1,1,r),M.d(1,2,r);var A,I,U,T=x(this,c);for(A=0,I=T.length;A<I;A++)if(U=T[A],s.prototype.d.apply(M,v[U]),256<U)M.d(T[++A],T[++A],r),M.d(T[++A],5),M.d(T[++A],T[++A],r);else if(256===U)break;this.a=M.finish(),this.b=this.a.length;break;case b:var z,B,P,N,O,S,R,L,C,_,j,F,Y,D,G,Z=new s(a?new Uint8Array(this.a.buffer):this.a,this.b),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(z=b,Z.d(1,1,r),Z.d(z,2,r),B=x(this,c),R=E(S=k(this.L,15)),C=E(L=k(this.K,7)),P=286;257<P&&0===S[P-1];P--);for(N=30;1<N&&0===L[N-1];N--);var H,W,K,X,J,Q,$=P,tt=N,et=new(a?Uint32Array:Array)($+tt),rt=new(a?Uint32Array:Array)(316),nt=new(a?Uint8Array:Array)(19);for(H=W=0;H<$;H++)et[W++]=S[H];for(H=0;H<tt;H++)et[W++]=L[H];if(!a)for(H=0,X=nt.length;H<X;++H)nt[H]=0;for(H=J=0,X=et.length;H<X;H+=W){for(W=1;H+W<X&&et[H+W]===et[H];++W);if(K=W,0===et[H])if(3>K)for(;0<K--;)rt[J++]=0,nt[0]++;else for(;0<K;)(Q=138>K?K:138)>K-3&&Q<K&&(Q=K-3),10>=Q?(rt[J++]=17,rt[J++]=Q-3,nt[17]++):(rt[J++]=18,rt[J++]=Q-11,nt[18]++),K-=Q;else if(rt[J++]=et[H],nt[et[H]]++,3>--K)for(;0<K--;)rt[J++]=et[H],nt[et[H]]++;else for(;0<K;)(Q=6>K?K:6)>K-3&&Q<K&&(Q=K-3),rt[J++]=16,rt[J++]=Q-3,nt[16]++,K-=Q}for(n=a?rt.subarray(0,J):rt.slice(0,J),_=k(nt,7),D=0;19>D;D++)q[D]=_[V[D]];for(O=19;4<O&&0===q[O-1];O--);for(j=E(_),Z.d(P-257,5,r),Z.d(N-1,5,r),Z.d(O-4,4,r),D=0;D<O;D++)Z.d(q[D],3,r);for(D=0,G=n.length;D<G;D++)if(F=n[D],Z.d(j[F],_[F],r),16<=F){switch(D++,F){case 16:Y=2;break;case 17:Y=3;break;case 18:Y=7;break;default:t("invalid code: "+F)}Z.d(n[D],Y,r)}var it,at,st,ot,ht,ct,ft,lt,ut=[R,S],dt=[C,L];for(ht=ut[0],ct=ut[1],ft=dt[0],lt=dt[1],it=0,at=B.length;it<at;++it)if(st=B[it],Z.d(ht[st],ct[st],r),256<st)Z.d(B[++it],B[++it],r),ot=B[++it],Z.d(ft[ot],lt[ot],r),Z.d(B[++it],B[++it],r);else if(256===st)break;this.a=Z.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var M=function(){function e(e){switch(r){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var n,i,a=[];for(n=3;258>=n;n++)i=e(n),a[n]=i[2]<<24|i[1]<<16|i[0];return a}(),A=a?new Uint32Array(M):M;function x(n,i){function s(e,n){var i,a,s,o,h=e.G,c=[],f=0;switch(i=A[e.length],c[f++]=65535&i,c[f++]=i>>16&255,c[f++]=i>>24,r){case 1===h:a=[0,h-1,0];break;case 2===h:a=[1,h-2,0];break;case 3===h:a=[2,h-3,0];break;case 4===h:a=[3,h-4,0];break;case 6>=h:a=[4,h-5,1];break;case 8>=h:a=[5,h-7,1];break;case 12>=h:a=[6,h-9,2];break;case 16>=h:a=[7,h-13,2];break;case 24>=h:a=[8,h-17,3];break;case 32>=h:a=[9,h-25,3];break;case 48>=h:a=[10,h-33,4];break;case 64>=h:a=[11,h-49,4];break;case 96>=h:a=[12,h-65,5];break;case 128>=h:a=[13,h-97,5];break;case 192>=h:a=[14,h-129,6];break;case 256>=h:a=[15,h-193,6];break;case 384>=h:a=[16,h-257,7];break;case 512>=h:a=[17,h-385,7];break;case 768>=h:a=[18,h-513,8];break;case 1024>=h:a=[19,h-769,8];break;case 1536>=h:a=[20,h-1025,9];break;case 2048>=h:a=[21,h-1537,9];break;case 3072>=h:a=[22,h-2049,10];break;case 4096>=h:a=[23,h-3073,10];break;case 6144>=h:a=[24,h-4097,11];break;case 8192>=h:a=[25,h-6145,11];break;case 12288>=h:a=[26,h-8193,12];break;case 16384>=h:a=[27,h-12289,12];break;case 24576>=h:a=[28,h-16385,13];break;case 32768>=h:a=[29,h-24577,13];break;default:t("invalid distance")}for(i=a,c[f++]=i[0],c[f++]=i[1],c[f++]=i[2],s=0,o=c.length;s<o;++s)b[y++]=c[s];w[c[0]]++,M[c[3]]++,v=e.length+n-1,g=null}var o,h,c,f,l,u,d,g,p,m={},b=a?new Uint16Array(2*i.length):[],y=0,v=0,w=new(a?Uint32Array:Array)(286),M=new(a?Uint32Array:Array)(30),x=n.w;if(!a){for(c=0;285>=c;)w[c++]=0;for(c=0;29>=c;)M[c++]=0}for(w[256]=1,o=0,h=i.length;o<h;++o){for(c=l=0,f=3;c<f&&o+c!==h;++c)l=l<<8|i[o+c];if(m[l]===e&&(m[l]=[]),u=m[l],!(0<v--)){for(;0<u.length&&32768<o-u[0];)u.shift();if(o+3>=h){for(g&&s(g,-1),c=0,f=h-o;c<f;++c)p=i[o+c],b[y++]=p,++w[p];break}0<u.length?(d=I(i,o,u),g?g.length<d.length?(p=i[o-1],b[y++]=p,++w[p],s(d,0)):s(g,-1):d.length<x?g=d:s(d,0)):g?s(g,-1):(p=i[o],b[y++]=p,++w[p])}u.push(o)}return b[y++]=256,w[256]++,n.L=w,n.K=M,a?b.subarray(0,y):b}function I(t,e,r){var n,i,a,s,o,h,c=0,f=t.length;s=0,h=r.length;t:for(;s<h;s++){if(n=r[h-s-1],a=3,3<c){for(o=c;3<o;o--)if(t[n+o-1]!==t[e+o-1])continue t;a=c}for(;258>a&&e+a<f&&t[n+a]===t[e+a];)++a;if(a>c&&(i=n,c=a),258===a)break}return new w(c,e-i)}function k(t,e){var r,n,i,s,o,h=t.length,c=new d(572),f=new(a?Uint8Array:Array)(h);if(!a)for(s=0;s<h;s++)f[s]=0;for(s=0;s<h;++s)0<t[s]&&c.push(s,t[s]);if(r=Array(c.length/2),n=new(a?Uint32Array:Array)(c.length/2),1===r.length)return f[c.pop().index]=1,f;for(s=0,o=c.length/2;s<o;++s)r[s]=c.pop(),n[s]=r[s].value;for(i=function(t,e,r){function n(t){var r=g[t][p[t]];r===e?(n(t+1),n(t+1)):--u[r],++p[t]}var i,s,o,h,c,f=new(a?Uint16Array:Array)(r),l=new(a?Uint8Array:Array)(r),u=new(a?Uint8Array:Array)(e),d=Array(r),g=Array(r),p=Array(r),m=(1<<r)-e,b=1<<r-1;for(f[r-1]=e,s=0;s<r;++s)m<b?l[s]=0:(l[s]=1,m-=b),m<<=1,f[r-2-s]=(f[r-1-s]/2|0)+e;for(f[0]=l[0],d[0]=Array(f[0]),g[0]=Array(f[0]),s=1;s<r;++s)f[s]>2*f[s-1]+l[s]&&(f[s]=2*f[s-1]+l[s]),d[s]=Array(f[s]),g[s]=Array(f[s]);for(i=0;i<e;++i)u[i]=r;for(o=0;o<f[r-1];++o)d[r-1][o]=t[o],g[r-1][o]=o;for(i=0;i<r;++i)p[i]=0;for(1===l[r-1]&&(--u[0],++p[r-1]),s=r-2;0<=s;--s){for(h=i=0,c=p[s+1],o=0;o<f[s];o++)(h=d[s+1][c]+d[s+1][c+1])>t[i]?(d[s][o]=h,g[s][o]=e,c+=2):(d[s][o]=t[i],g[s][o]=i,++i);p[s]=0,1===l[s]&&n(s)}return u}(n,n.length,e),s=0,o=r.length;s<o;++s)f[r[s].index]=i[s];return f}function E(t){var e,r,n,i,s=new(a?Uint16Array:Array)(t.length),o=[],h=[],c=0;for(e=0,r=t.length;e<r;e++)o[t[e]]=1+(0|o[t[e]]);for(e=1,r=16;e<=r;e++)h[e]=c,c+=0|o[e],c<<=1;for(e=0,r=t.length;e<r;e++)for(c=h[t[e]],h[t[e]]+=1,n=s[e]=0,i=t[e];n<i;n++)s[e]=s[e]<<1|1&c,c>>>=1;return s}function U(e,r){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=a?new Uint8Array(e):e,this.s=!1,this.n=z,this.B=!1,!r&&(r={})||(r.index&&(this.c=r.index),r.bufferSize&&(this.m=r.bufferSize),r.bufferType&&(this.n=r.bufferType),r.resize&&(this.B=r.resize)),this.n){case T:this.b=32768,this.a=new(a?Uint8Array:Array)(32768+this.m+258);break;case z:this.b=0,this.a=new(a?Uint8Array:Array)(this.m),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}var T=0,z=1,B={D:T,C:z};U.prototype.p=function(){for(;!this.s;){var n=K(this,3);switch(1&n&&(this.s=r),n>>>=1){case 0:var i=this.input,s=this.c,o=this.a,h=this.b,c=i.length,f=e,l=o.length,u=e;switch(this.e=this.g=0,s+1>=c&&t(Error("invalid uncompressed block header: LEN")),f=i[s++]|i[s++]<<8,s+1>=c&&t(Error("invalid uncompressed block header: NLEN")),f===~(i[s++]|i[s++]<<8)&&t(Error("invalid uncompressed block header: length verify")),s+f>i.length&&t(Error("input buffer is broken")),this.n){case T:for(;h+f>o.length;){if(f-=u=l-h,a)o.set(i.subarray(s,s+u),h),h+=u,s+=u;else for(;u--;)o[h++]=i[s++];this.b=h,o=this.f(),h=this.b}break;case z:for(;h+f>o.length;)o=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(a)o.set(i.subarray(s,s+f),h),h+=f,s+=f;else for(;f--;)o[h++]=i[s++];this.c=s,this.b=h,this.a=o;break;case 1:this.o(q,W);break;case 2:var d,p,m,b,y=K(this,5)+257,v=K(this,5)+1,w=K(this,4)+4,M=new(a?Uint8Array:Array)(S.length),A=e,x=e,I=e,k=e,E=e;for(E=0;E<w;++E)M[S[E]]=K(this,3);if(!a)for(E=w,w=M.length;E<w;++E)M[S[E]]=0;for(d=g(M),A=new(a?Uint8Array:Array)(y+v),E=0,b=y+v;E<b;)switch(x=X(this,d),x){case 16:for(k=3+K(this,2);k--;)A[E++]=I;break;case 17:for(k=3+K(this,3);k--;)A[E++]=0;I=0;break;case 18:for(k=11+K(this,7);k--;)A[E++]=0;I=0;break;default:I=A[E++]=x}p=g(a?A.subarray(0,y):A.slice(0,y)),m=g(a?A.subarray(y):A.slice(y)),this.o(p,m);break;default:t(Error("unknown BTYPE: "+n))}}return this.t()};var P,N,O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=a?new Uint16Array(O):O,R=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],L=a?new Uint16Array(R):R,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],_=a?new Uint8Array(C):C,j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],F=a?new Uint16Array(j):j,Y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=a?new Uint8Array(Y):Y,G=new(a?Uint8Array:Array)(288);for(P=0,N=G.length;P<N;++P)G[P]=143>=P?8:255>=P?9:279>=P?7:8;var Z,V,q=g(G),H=new(a?Uint8Array:Array)(30);for(Z=0,V=H.length;Z<V;++Z)H[Z]=5;var W=g(H);function K(e,r){for(var n,i=e.g,a=e.e,s=e.input,o=e.c,h=s.length;a<r;)o>=h&&t(Error("input buffer is broken")),i|=s[o++]<<a,a+=8;return n=i&(1<<r)-1,e.g=i>>>r,e.e=a-r,e.c=o,n}function X(e,r){for(var n,i,a=e.g,s=e.e,o=e.input,h=e.c,c=o.length,f=r[0],l=r[1];s<l&&!(h>=c);)a|=o[h++]<<s,s+=8;return(i=(n=f[a&(1<<l)-1])>>>16)>s&&t(Error("invalid code length: "+i)),e.g=a>>i,e.e=s-i,e.c=h,65535&n}function J(t){if("string"==typeof t){var e,r,n=t.split("");for(e=0,r=n.length;e<r;e++)n[e]=(255&n[e].charCodeAt(0))>>>0;t=n}for(var i,a=1,s=0,o=t.length,h=0;0<o;){o-=i=1024<o?1024:o;do{s+=a+=t[h++]}while(--i);a%=65521,s%=65521}return(s<<16|a)>>>0}function Q(e,r){var n,i;if(this.input=e,this.c=0,!r&&(r={})||(r.index&&(this.c=r.index),r.verify&&(this.M=r.verify)),n=e[this.c++],i=e[this.c++],(15&n)===$)this.method=$;else t(Error("unsupported compression method"));0!=((n<<8)+i)%31&&t(Error("invalid fcheck flag:"+((n<<8)+i)%31)),32&i&&t(Error("fdict flag is not supported")),this.A=new U(e,{index:this.c,bufferSize:r.bufferSize,bufferType:r.bufferType,resize:r.resize})}U.prototype.o=function(t,e){var r=this.a,n=this.b;this.u=t;for(var i,a,s,o,h=r.length-258;256!==(i=X(this,t));)if(256>i)n>=h&&(this.b=n,r=this.f(),n=this.b),r[n++]=i;else for(o=L[a=i-257],0<_[a]&&(o+=K(this,_[a])),i=X(this,e),s=F[i],0<D[i]&&(s+=K(this,D[i])),n>=h&&(this.b=n,r=this.f(),n=this.b);o--;)r[n]=r[n++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},U.prototype.I=function(t,e){var r=this.a,n=this.b;this.u=t;for(var i,a,s,o,h=r.length;256!==(i=X(this,t));)if(256>i)n>=h&&(h=(r=this.f()).length),r[n++]=i;else for(o=L[a=i-257],0<_[a]&&(o+=K(this,_[a])),i=X(this,e),s=F[i],0<D[i]&&(s+=K(this,D[i])),n+o>h&&(h=(r=this.f()).length);o--;)r[n]=r[n++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=n},U.prototype.f=function(){var t,e,r=new(a?Uint8Array:Array)(this.b-32768),n=this.b-32768,i=this.a;if(a)r.set(i.subarray(32768,r.length));else for(t=0,e=r.length;t<e;++t)r[t]=i[t+32768];if(this.l.push(r),this.q+=r.length,a)i.set(i.subarray(n,n+32768));else for(t=0;32768>t;++t)i[t]=i[n+t];return this.b=32768,i},U.prototype.J=function(t){var e,r,n,i=this.input.length/this.c+1|0,s=this.input,o=this.a;return t&&("number"==typeof t.v&&(i=t.v),"number"==typeof t.F&&(i+=t.F)),2>i?r=(n=(s.length-this.c)/this.u[2]/2*258|0)<o.length?o.length+n:o.length<<1:r=o.length*i,a?(e=new Uint8Array(r)).set(o):e=o,this.a=e},U.prototype.t=function(){var t,e,r,n,i,s=0,o=this.a,h=this.l,c=new(a?Uint8Array:Array)(this.q+(this.b-32768));if(0===h.length)return a?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,r=h.length;e<r;++e)for(n=0,i=(t=h[e]).length;n<i;++n)c[s++]=t[n];for(e=32768,r=this.b;e<r;++e)c[s++]=o[e];return this.l=[],this.buffer=c},U.prototype.H=function(){var t,e=this.b;return a?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},Q.prototype.p=function(){var e,r=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&((r[this.c++]<<24|r[this.c++]<<16|r[this.c++]<<8|r[this.c++])>>>0!==J(e)&&t(Error("invalid adler-32 checksum"))),e};var $=8;function tt(t,e){this.input=t,this.a=new(a?Uint8Array:Array)(32768),this.h=et.k;var r,n={};for(r in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)n[r]=e[r];n.outputBuffer=this.a,this.z=new p(this.input,n)}var et=y;function rt(t,e){var r,n,a,s;if(Object.keys)r=Object.keys(e);else for(n in r=[],a=0,e)r[a++]=n;for(a=0,s=r.length;a<s;++a)i(t+"."+(n=r[a]),e[n])}tt.prototype.j=function(){var e,r,n,i,s,o,h,c=0;if(h=this.a,(e=$)===$)r=Math.LOG2E*Math.log(32768)-8;else t(Error("invalid compression method"));if(n=r<<4|e,h[c++]=n,e===$)switch(this.h){case et.NONE:s=0;break;case et.r:s=1;break;case et.k:s=2;break;default:t(Error("unsupported compression type"))}else t(Error("invalid compression method"));return i=s<<6,h[c++]=i|31-(256*n+i)%31,o=J(this.input),this.z.b=c,c=(h=this.z.j()).length,a&&((h=new Uint8Array(h.buffer)).length<=c+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,c+4)),h[c++]=o>>24&255,h[c++]=o>>16&255,h[c++]=o>>8&255,h[c++]=255&o,h},i("Zlib.Inflate",Q),i("Zlib.Inflate.prototype.decompress",Q.prototype.p),rt("Zlib.Inflate.BufferType",{ADAPTIVE:B.C,BLOCK:B.D}),i("Zlib.Deflate",tt),i("Zlib.Deflate.compress",(function(t,e){return new tt(t,e).j()})),i("Zlib.Deflate.prototype.compress",tt.prototype.j),rt("Zlib.Deflate.CompressionType",{NONE:et.NONE,FIXED:et.r,DYNAMIC:et.k})}).call(self);var R="undefined"!=typeof Float32Array?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var L,C=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t};function _(t,e,r){return t[0]=e,t[1]=r,t}L=new R(3),R!=Float32Array&&(L[0]=0,L[1]=0,L[2]=0),function(){var t=function(){var t=new R(2);return R!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const j=[],F=[],Y=[],D=[],G=[],Z=[],V=32767,q=64,H=64,W=3,K=-1e3,X=.001,J=256,Q=4,$=.002;function tt(t,e,r){return(1-r)*t+r*e}const et=new TextDecoder("utf-8");function rt(t){return t>>1^-(1&t)}function nt(t,e,r){const n=function(t){if(t.length<1e3)return null;const e=new self.Zlib.Inflate(t);return e?e.decompress():null}(new Uint8Array(t));if(!n)throw new Error((i=new Uint8Array(t),et.decode(i)));var i;const a=function(t){const e=t,r=q,n=H,i=new Uint8Array(r*n*Q);let a,s,o,h,c;for(let t=0;t<n;t++)for(let f=0;f<r;f++){h=parseInt(149*t/(n-1)),c=parseInt(149*f/(r-1)),s=2*(150*h+c),a=e[s]+256*e[s+1],(a>1e4||a<-2e3)&&(a=0),o=4*(t*r+f);const l=(a+1e3)/X,u=J;i[o]=l/(u*u),i[o+1]=(l-i[o]*u*u)/u,i[o+2]=l-i[o]*u*u-i[o+1]*u,i[o+3]=255}return i}(n),s=function(t,e){const r=e,n=e,i=r+1,a=n+1,s=W,o=K,h=X,c=J,f=$,l=new Float32Array(i*a);let u=0,d=1/0,g=-1/0;for(let e=0;e<i;e++){const i=e>=n?n-1:e;for(let e=0;e<a;e++){let n=0;const a=i*(4*r)+4*(e>=r?r-1:e);for(let e=0;e<s;e++)n=n*c+t[a+e];n=1*(n*h+o),n-=f,l[u]=n,n<d&&(d=n),n>g&&(g=n),u++}}return{data:l,min:d,max:g,width:0,height:0,tileSize:0,image:null}}(a,e-1);return s.width=s.height=e,s.tileSize=r,ft(s),s}class it{constructor(t,e,r,n,i){this.p0=[],this.p1=[],this.p2=[],this.normal=[],this.min=[],this.max=[],this.set(t,e,r,n,i)}set(t,e,r,n,i){this.radius=i;let a=3*e,s=3*e+1,o=3*e+2;this.p0[0]=t[a]*i,this.p0[1]=t[s]*i,this.p0[2]=t[o],a=3*r,s=3*r+1,o=3*r+2,this.p1[0]=t[a]*i,this.p1[1]=t[s]*i,this.p1[2]=t[o],a=3*n,s=3*n+1,o=3*n+2,this.p2[0]=t[a]*i,this.p2[1]=t[s]*i,this.p2[2]=t[o],this.min[0]=Math.min(this.p0[0],this.p1[0],this.p2[0]),this.min[1]=Math.min(this.p0[1],this.p1[1],this.p2[1]),this.max[0]=Math.max(this.p0[0],this.p1[0],this.p2[0]),this.max[1]=Math.max(this.p0[1],this.p1[1],this.p2[1]);const h=C(j,this.p1,this.p0),c=C(F,this.p2,this.p1);this.normal=function(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}(this.normal,function(t,e,r){var n=e[0],i=e[1],a=e[2],s=r[0],o=r[1],h=r[2];return t[0]=i*h-a*o,t[1]=a*s-n*h,t[2]=n*o-i*s,t}(this.normal,h,c))}contains(t,e){if(t<this.min[0]||t>this.max[0]||e<this.min[1]||e>this.max[1])return!1;_(Y,this.p0[0],this.p0[1]),_(D,this.p1[0],this.p1[1]),_(G,this.p2[0],this.p2[1]);const r=at(Y[0],Y[1],D[0],D[1],G[0],G[1]);return at(t,e,Y[0],Y[1],G[0],G[1])+at(t,e,Y[0],Y[1],D[0],D[1])+at(t,e,D[0],D[1],G[0],G[1])-r<=1e-4}getHeight(t,e){const r=this.normal;return this.p0[2]-((t-this.p0[0])*r[0]+(e-this.p0[1])*r[1])/r[2]}}function at(t,e,r,n,i,a){return.5*Math.abs(t*n+r*a+i*e-t*a-r*e-i*n)}let st=null;function ot(t,e,r){if(st&&st.contains(e,r))return st.getHeight(e,r);for(let n=0;n<t.length;n++)if(t[n].contains(e,r))return st=t[n],t[n].getHeight(e,r);return 0}const ht=[];function ct(t,e,r){const n=function(t){let e=0;const r=3,n=Float64Array.BYTES_PER_ELEMENT*r,i=3,a=Uint16Array.BYTES_PER_ELEMENT*i,s=3;let o=Uint16Array.BYTES_PER_ELEMENT;const h=new DataView(t);e+=n;const c=h.getFloat32(e,!0);e+=Float32Array.BYTES_PER_ELEMENT;const f=h.getFloat32(e,!0);e+=Float32Array.BYTES_PER_ELEMENT,e+=n;const l=h.getFloat64(e,!0);e+=Float64Array.BYTES_PER_ELEMENT,e+=n;const u=h.getUint32(e,!0);e+=Uint32Array.BYTES_PER_ELEMENT;const d=new Uint16Array(t,e,3*u);e+=u*a,u>65536&&(o=Uint32Array.BYTES_PER_ELEMENT);const g=d.subarray(0,u),p=d.subarray(u,2*u),m=d.subarray(2*u,3*u);(function(t,e,r){const n=t.length;let i=0,a=0,s=0;for(let o=0;o<n;++o)i+=rt(t[o]),a+=rt(e[o]),t[o]=i,e[o]=a,r&&(s+=rt(r[o]),r[o]=s)})(g,p,m),e%o!=0&&(e+=o-e%o);const b=h.getUint32(e,!0);e+=Uint32Array.BYTES_PER_ELEMENT;const y=u>65536?new Uint32Array(t,e,b*s):new Uint16Array(t,e,b*s);let v=0;const w=y.length;for(let t=0;t<w;++t){const e=y[t];y[t]=v-e,0===e&&++v}const M={minimumHeight:c,maximumHeight:f,quantizedVertices:d,indices:y},A=M.quantizedVertices,x=A.length/3,I=A.subarray(0,x),k=A.subarray(x,2*x),E=A.subarray(2*x,3*x),U=Z;for(let t=0;t<x;++t){const e=I[t],r=k[t],n=e/V,i=r/V,a=tt(c,f,E[t]/V);U[3*t]=n,U[3*t+1]=1-i,U[3*t+2]=a}return{positions:U,radius:l,min:c,max:f,indices:y}}(t),{positions:i,min:a,max:s,indices:o,radius:h}=n,c=[];let f=0;for(let t=0;t<o.length;t+=3){let e=ht[f];e?e.set(i,o[t],o[t+1],o[t+2],2*h):e=ht[f]=new it(i,o[t],o[t+1],o[t+2],2*h),f++,c.push(e)}const l=new Float32Array(e*e);f=0;for(let t=0;t<e;t++)for(let r=0;r<e;r++)l[f++]=ot(c,r/e*h*2,t/e*h*2);const u={data:l,min:a,max:s,width:e,height:e,tileSize:r};return ft(u),console.log(u),u}function ft(t){const e=x(),{width:r,height:n,data:i,tileSize:a}=t;if(r&&n&&i)try{I(e,r,n);let s=k(e);const o=s.createImageData(r,n),h=[0,0,0];for(let t=0,e=i.length;t<e;t++){const e=i[t],[r,n,a]=d(e,h),s=4*t;o.data[s]=r,o.data[s+1]=n,o.data[s+2]=a,o.data[s+3]=255}s.putImageData(o,0,0);const c=e.transferToImageBitmap();I(e,a,a),s=k(e),s.drawImage(c,0,0,r,n,0,0,a,a),t.image=e.transferToImageBitmap()}catch(t){console.log(t)}}const lt=new S(200,(t=>{u(t)})),ut=new S(200,(t=>{}));const dt={};function gt(t,e){dt[t]=dt[t]||[],dt[t].push(e)}function pt(t){const e=[];for(let r in dt){const n=dt[r]||[];if(n.length){const e=n.indexOf(t);e>-1&&n.splice(e,1)}0===n.length&&e.push(r)}e.forEach((t=>{delete dt[t]}))}function mt(t,n={},i){return new Promise(((a,s)=>{const h=t=>{createImageBitmap(t).then((t=>{a(t)})).catch((t=>{s(t)}))},c=i.__taskId;if(!c)return void s(r("taskId is null"));const f=lt.get(t);if(f)h(f);else{const r=i.fetchOptions||{headers:n,referrer:i.referrer},a=i.timeout||0,f=new AbortController,l=f.signal;a&&e(a)&&a>0&&setTimeout((()=>{f.abort(o)}),a),r.signal=l,delete r.timeout,gt(c,f),fetch(t,r).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((e=>{!0!==i.disableCache&&lt.add(t,e),pt(f),h(e)})).catch((t=>{pt(f),s(t)}))}}))}function bt(t){const{urlTemplate:a,x:s,y:o,z:h,maxAvailableZoom:f,subdomains:l,returnBlobURL:d,globalCompositeOperation:g}=t,p=f&&e(f)&&f>=1;return new Promise(((m,b)=>{if(!p)return void b(r("maxAvailableZoom is error"));if(!a)return void b(r("urlTemplate is error"));if(!e(s)||!e(o)||!e(h))return void b(r("x/y/z is error"));const y=n(a);for(let t=0,e=y.length;t<e;t++){const e=y[t];if(e&&e.indexOf("{s}")>-1&&(!l||0===l.length))return void b(r("not find subdomains"))}let v,w,M,A,E=s,T=o,O=h;const S=h-f;if(S>0){let t=s,e=o,r=h;for(;r>f;)t=Math.floor(t/2),e=Math.floor(e/2),r--;const n=Math.pow(2,S);let i=Math.floor(t*n),a=i+n,c=Math.floor(e*n),l=c+n;i>s&&(i--,a--),c>o&&(c--,l--),v=(s-i)/(a-i),w=(o-c)/(l-c),M=1/(a-i),A=1/(l-c),E=t,T=e,O=f}const R=y.map((t=>{let e="{x}";for(;t.indexOf(e)>-1;)t=t.replace(e,E);for(e="{y}";t.indexOf(e)>-1;)t=t.replace(e,T);for(e="{z}";t.indexOf(e)>-1;)t=t.replace(e,O);return function(t,e){if(!e||!e.length)return t;const r=e.length;let n=Math.floor(Math.random()*r);for(n=Math.min(n,r-1);t.indexOf("{s}")>-1;)t=t.replace("{s}",e[n]);return t}(t,l)})),L=Object.assign({},c,t.headers||{}),C=R.map((e=>mt(e,L,t)));Promise.all(C).then((e=>{const r=x();if(!r)return void b(i);const n=U(e,g);if(n instanceof Error)return void b(n);const a=P(r,B(r,n,t.filter),t.gaussianBlurRadius);let s;if(S<=0)s=N(a,t.opacity);else{const{width:e,height:n}=a,i=function(t,e,r,n,i,a){I(t,e.width,e.height);const s=k(t);s.save(),s.drawImage(e,r,n,i,a,0,0,t.width,t.height),s.restore();const o=t.transferToImageBitmap();return u(e),o}(r,a,e*v,n*w,e*M,n*A);s=N(i,t.opacity)}d?z(s).then((t=>{const e=URL.createObjectURL(t);m(e)})).catch((t=>{b(t)})):m(s)})).catch((t=>{b(t)}))}))}function yt(t,a){return new Promise(((s,h)=>{if(!t)return void h(r("url is null"));const{terrainType:f}=a;if(!f)return void h(r("terrainType is null"));const l=n(t),u=Object.assign({},c,a.headers||{}),{returnBlobURL:g,terrainWidth:p,tileSize:m}=a;if("mapzen"===f){const t=l.map((t=>mt(t,u,a)));Promise.all(t).then((t=>{const e=x();if(!e)return void h(i);const r=U(t);if(r instanceof Error)return void h(r);I(e,r.width,r.height);const n=k(e);n.drawImage(r,0,0);const a=n.getImageData(0,0,e.width,e.height);!function(t){const e=t.data,r=[0,0,0];for(let t=0,n=e.length;t<n;t+=4){const n=e[t],i=e[t+1],a=e[t+2];if(0===e[t+3])continue;const s=256*n+i+a/256-32768,[o,h,c]=d(s,r);e[t]=o,e[t+1]=h,e[t+2]=c}}(a),n.putImageData(a,0,0);(t=>{g?z(t).then((t=>{const e=URL.createObjectURL(t);s(e)})).catch((t=>{h(t)})):s(t)})(e.transferToImageBitmap())})).catch((t=>{h(t)}))}else if("tianditu"===f||"cesium"===f){const t=l.map((t=>function(t,n={},i){return new Promise(((a,s)=>{const h=t=>{a(t)},c=i.__taskId;if(!c)return void s(r("taskId is null"));const f=ut.get(t);if(f)h(f);else{const r=i.fetchOptions||{headers:n,referrer:i.referrer},a=i.timeout||0,f=new AbortController,l=f.signal;a&&e(a)&&a>0&&setTimeout((()=>{f.abort(o)}),a),r.signal=l,delete r.timeout,gt(c,f),fetch(t,r).then((t=>t.arrayBuffer())).then((e=>{!0!==i.disableCache&&ut.add(t,e),pt(f),h(e)})).catch((t=>{pt(f),s(t)}))}}))}(t,u,a)));Promise.all(t).then((t=>{if(!x())return void h(i);if(!t||0===t.length)return void h(r("buffers is null"));const e=t[0];if(0===e.byteLength)return void h(r("buffer is empty"));let n;n="tianditu"===f?nt(e,p,m):ct(e,p,m),n.image?s(n.image):h(r("generate terrain data error,not find image data"))})).catch((t=>{h(t)}))}else h(r("not support terrainType:"+f))}))}const vt=512;function wt(t){return new Promise(((e,r)=>{const n=t.debug,i=t.items,a=t._workerId,s=[];i.forEach(((t,o)=>{const h=new OffscreenCanvas(t.width,t.height);k(h).drawImage(t.image,0,0),n&&console.log("workerId:"+a+",image to blob url :"+(o+1)+"/"+i.length),h.convertToBlob().then((r=>{const n=URL.createObjectURL(r);t.url=n,s.push(1),u(t.image),delete t.image,s.length===i.length&&e(i)})).catch((t=>{console.error(t),r(t)}))}))}))}function Mt(t,e){At(t.geometry,e)}function At(t,e){if(t)switch(t.type){case"Point":xt(t.coordinates,e);break;case"MultiPoint":case"LineString":It(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let r=0,n=t.length;r<n;r++)It(t[r],e)}(t.coordinates,e);break;case"Polygon":kt(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let r=0,n=t.length;r<n;r++)kt(t[r],e)}(t.coordinates,e);break;case"GeometryCollection":const r=t.geometries.length;for(let n=0;n<r;n++)At(t.geometries[n],e)}}function xt(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function It(t,e){for(let r=0,n=t.length;r<n;r++)xt(t[r],e)}function kt(t,e){t.length&&It(t[0],e)}var Et=function(t){let e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const r=t.features.length;for(let n=0;n<r;n++)Mt(t.features[n],e);break;case"Feature":Mt(t,e);break;default:At(t,e)}return e},Ut=Tt;function Tt(t,e,r){var n,i,a,s,o,h=t.length,c=Bt(t[0],e),f=[];for(r||(r=[]),n=1;n<h;n++){for(i=t[n-1],s=o=Bt(a=t[n],e);;){if(!(c|s)){f.push(i),s!==o?(f.push(a),n<h-1&&(r.push(f),f=[])):n===h-1&&f.push(a);break}if(c&s)break;c?c=Bt(i=zt(i,a,c,e),e):s=Bt(a=zt(i,a,s,e),e)}c=o}return f.length&&r.push(f),r}function zt(t,e,r,n){return 8&r?[t[0]+(e[0]-t[0])*(n[3]-t[1])/(e[1]-t[1]),n[3]]:4&r?[t[0]+(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1]),n[1]]:2&r?[n[2],t[1]+(e[1]-t[1])*(n[2]-t[0])/(e[0]-t[0])]:1&r?[n[0],t[1]+(e[1]-t[1])*(n[0]-t[0])/(e[0]-t[0])]:null}function Bt(t,e){var r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Pt(t){const[e,r,n,i]=t;return[[e,r],[n,r],[n,i],[e,i]]}function Nt(t){let e=1/0,r=1/0,n=-1/0,i=-1/0;return t.forEach((t=>{e=Math.min(e,t[0]),n=Math.max(n,t[0]),r=Math.min(r,t[1]),i=Math.max(i,t[1])})),[e,r,n,i]}Tt.polyline=Tt,Tt.polygon=function(t,e){var r,n,i,a,s,o,h;for(n=1;n<=8;n*=2){for(r=[],a=!(Bt(i=t[t.length-1],e)&n),s=0;s<t.length;s++)(h=!(Bt(o=t[s],e)&n))!==a&&r.push(zt(i,o,n,e)),h&&r.push(o),i=o,a=h;if(!(t=r).length)break}return r};const Ot={};function St(t,e){return function(t){if(!t)return!1;const e=(t.geometry||{type:null}).type;return"Polygon"===e||"MultiPolygon"===e}(e)?Ot[t]?r("the"+t+" geojson Already exists"):(Ot[t]=e,function(t){t.bbox=t.bbox||Et(t)}(e),e):r("geojson.feature is not Polygon")}function Rt(t,e){if(h(t)){const t=e=>{const r=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];Array.isArray(i[0])?r.push(t(i)):r[n]=a(i)}return r};return t(e)}return e}function Lt(t,e,r){const[n,i,a,s]=t,o=(a-n)/e,h=(s-i)/e,[c,f]=r;return[(c-n)/o,e-(f-i)/h]}function Ct(t,e,r,n){const[i,s,o,c]=e,f=(t,e)=>{const n=[];for(let i=0,a=t.length;i<a;i++){const a=t[i];Array.isArray(a[0])?n.push(f(a,e)):n[i]=Lt(e,r,a)}return n};if(h(t)){const[t,e]=a([i,s]),[r,h]=a([o,c]);return f(n,[t,e,r,h])}return f(n,e)}const _t=Math.PI/180,jt=180/Math.PI,Ft=6378137,Yt=20037508.342789244,Dt="900913",Gt={};function Zt(t){return Number(t)===t&&t%1!=0}const Vt=256,qt=[-180,90],Ht=[-20037508.342787,20037508.342787],Wt=["EPSG:4326","EPSG:3857"],Kt=new class{#t;#e;#r;#n;#i;#a;constructor(t={}){if(this.#t=t.size||256,this.#e=t.antimeridian?2:1,!Gt[this.#t]){let t=this.#t;const e=Gt[this.#t]={};e.Bc=[],e.Cc=[],e.zc=[],e.Ac=[];for(let r=0;r<30;r++)e.Bc.push(t/360),e.Cc.push(t/(2*Math.PI)),e.zc.push(t/2),e.Ac.push(t),t*=2}this.#r=Gt[this.#t].Bc,this.#n=Gt[this.#t].Cc,this.#i=Gt[this.#t].zc,this.#a=Gt[this.#t].Ac}px(t,e){if(Zt(e)){const r=this.#t*Math.pow(2,e),n=r/2,i=r/360,a=r/(2*Math.PI),s=r,o=Math.min(Math.max(Math.sin(_t*t[1]),-.9999),.9999);let h=n+t[0]*i,c=n+.5*Math.log((1+o)/(1-o))*-a;return h>s*this.#e&&(h=s*this.#e),c>s&&(c=s),[h,c]}{const r=this.#i[e],n=Math.min(Math.max(Math.sin(_t*t[1]),-.9999),.9999);let i=Math.round(r+t[0]*this.#r[e]),a=Math.round(r+.5*Math.log((1+n)/(1-n))*-this.#n[e]);return i>this.#a[e]*this.#e&&(i=this.#a[e]*this.#e),a>this.#a[e]&&(a=this.#a[e]),[i,a]}}ll(t,e){if(Zt(e)){const r=this.#t*Math.pow(2,e),n=r/360,i=r/(2*Math.PI),a=r/2,s=(t[1]-a)/-i;return[(t[0]-a)/n,jt*(2*Math.atan(Math.exp(s))-.5*Math.PI)]}{const r=(t[1]-this.#i[e])/-this.#n[e];return[(t[0]-this.#i[e])/this.#r[e],jt*(2*Math.atan(Math.exp(r))-.5*Math.PI)]}}convert(t,e){return e===Dt?[...this.forward(t.slice(0,2)),...this.forward(t.slice(2,4))]:[...this.inverse(t.slice(0,2)),...this.inverse(t.slice(2,4))]}inverse(t){return[t[0]*jt/Ft,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/Ft)))*jt]}forward(t){const e=[Ft*t[0]*_t,Ft*Math.log(Math.tan(.25*Math.PI+.5*t[1]*_t))];return e[0]>Yt&&(e[0]=Yt),e[0]<-Yt&&(e[0]=-Yt),e[1]>Yt&&(e[1]=Yt),e[1]<-Yt&&(e[1]=-Yt),e}bbox(t,e,r,n,i){n&&(e=Math.pow(2,r)-1-e);const a=[t*this.#t,(+e+1)*this.#t],s=[(+t+1)*this.#t,e*this.#t],o=[...this.ll(a,r),...this.ll(s,r)];return i===Dt?this.convert(o,Dt):o}xyz(t,e,r,n){const i=n===Dt?this.convert(t,"WGS84"):t,a=[i[0],i[1]],s=[i[2],i[3]],o=this.px(a,e),h=this.px(s,e),c=[Math.floor(o[0]/this.#t),Math.floor((h[0]-1)/this.#t)],f=[Math.floor(h[1]/this.#t),Math.floor((o[1]-1)/this.#t)],l={minX:Math.min.apply(Math,c)<0?0:Math.min.apply(Math,c),minY:Math.min.apply(Math,f)<0?0:Math.min.apply(Math,f),maxX:Math.max.apply(Math,c),maxY:Math.max.apply(Math,f)};if(r){const t={minY:Math.pow(2,e)-1-l.maxY,maxY:Math.pow(2,e)-1-l.minY};l.minY=t.minY,l.maxY=t.maxY}return l}}({size:Vt});function Xt(t){return 1.40625/Math.pow(2,t)}function Jt(t,e,r,n=0){n=n||0;const[i,a]=Ht,s=(o=r,156543.03392804097/Math.pow(2,o)*Vt);var o;const h=function(t,e,r){const[n,i]=qt,a=Xt(r)*Vt;let s=t,o=e;return s=Math.floor(s),o=Math.floor(o),[n+s*a,o*a-i,n+(s+1)*a,(o+1)*a-i]}(t,e,r),c=Nt(Pt(h).map((t=>Kt.forward(t)))),[f,l,u,d]=c;let g=(f-i)/s,p=(u-i)/s,m=(a-d)/s,b=(a-l)/s;if(g=Math.floor(g),p=Math.floor(p),m=Math.floor(m),b=Math.floor(b),p<g||b<m)return;const y=[];for(let t=m;t<=b;t++)for(let e=g;e<=p;e++)y.push([e,t,r+n]);const v=y.map((t=>{const[e,r,n]=t;return Kt.bbox(e,r,n,!1,"900913")})),[w,M,A,x]=function(t){let e=1/0,r=1/0,n=-1/0,i=-1/0;return t.forEach((t=>{const[a,s,o,h]=t;e=Math.min(e,a),n=Math.max(n,o),r=Math.min(r,s),i=Math.max(i,h)})),[e,r,n,i]}(v);return{tiles:y,tilesbbox:[w,M,A,x],bbox:h,mbbox:c,x:t,y:e,z:r}}function Qt(t,e,r,n){const{width:i,height:a}=t,[s,o,h,c]=e,f=(h-s)/i,l=(c-o)/a;let[d,g,p,m]=r;d-=f,p+=f,g-=l,m+=l;let b=(d-s)/f,y=(c-m)/l,v=(p-s)/f,w=(c-g)/l;b=Math.floor(b),y=Math.floor(y),v=Math.ceil(v),w=Math.ceil(w);const M=v-b,A=w-y,E=x();I(E,M,A);const U=k(E);U.drawImage(t,b,y,M,A,0,0,M,A),u(t);const T=U.getImageData(0,0,M,A).data,z=[];let B=1/0,P=1/0,N=-1/0,O=-1/0,S=-1;const R="EPSG:4326"===n?Kt.forward:Kt.inverse;for(let t=1;t<=A;t++){const e=m-(t-1)*l,r=e-l;for(let n=1;n<=M;n++){const i=(t-1)*M*4+4*(n-1),a=T[i],s=T[i+1],o=T[i+2],h=T[i+3],c=d+(n-1)*f,l=R([c,e]);B=Math.min(B,l[0]),N=Math.max(N,l[0]),P=Math.min(P,l[1]),O=Math.max(O,l[1]);const u=[c,r];z[++S]={point:l,point1:R(u),r:a,g:s,b:o,a:h}}}return{pixels:z,bbox:[B,P,N,O],width:M,height:A,image:E.transferToImageBitmap()}}function $t(t,e,r){const[n,i,a,s]=e,o=(a-n)/Vt,h=(s-i)/Vt,{pixels:c,bbox:f}=t,[l,u,d,g]=f;let p=(d-l)/o,m=(g-u)/h;if(p=Math.round(p),m=Math.round(m),isNaN(p)||isNaN(m)||0===Math.min(p,m)||Math.abs(p)===1/0||Math.abs(m)===1/0)return;const b=x();I(b,p,m);const y=k(b);function v(t,e){let r=Math.round((t-l)/o+1);r=Math.min(r,p);let n=Math.round((g-e)/h+1);return n=Math.min(n,m),[r,n]}const w=y.createImageData(p,m),M=w.data;for(let t=0,e=c.length;t<e;t++){const{point:e,point1:r,r:n,g:i,b:a,a:s}=c[t],[o,h]=e,[f,l]=r,[u,d]=v(o,h),[g,m]=v(f,l);for(let t=d;t<=m;t++){const e=(t-1)*p*4+4*(u-1);M[e]=n,M[e+1]=i,M[e+2]=a,M[e+3]=s}}y.putImageData(w,0,0);const A=b.transferToImageBitmap(),E=Math.round((n-l)/o),U=Math.round((g-s)/h),T=x();I(T,Vt,Vt);const z=k(b);return z.drawImage(A,E-1,U,Vt,Vt,0,0,Vt,Vt),function(t){const e=t.canvas,{width:r,height:n}=e,i=t.getImageData(0,0,r,n),a=i.data,s=()=>{for(let t=1;t<=n;t++){if(a[4*r*(t-1)+0+3]>0)return!1}return!0},o=()=>{for(let t=1;t<=r;t++){if(a[4*(t-1)+(n-1)*r*4+3]>0)return!1}return!0};if(s())for(let t=1;t<=n;t++){const e=4*r*(t-1)+0,n=e+4,i=a[n],s=a[n+1],o=a[n+2],h=a[n+3];a[e]=i,a[e+1]=s,a[e+2]=o,a[e+3]=h}if(o())for(let t=1;t<=r;t++){const e=4*(t-1)+(n-1)*r*4,i=4*(t-1)+(n-2)*r*4,s=a[i],o=a[i+1],h=a[i+2],c=a[i+3];a[e]=s,a[e+1]=o,a[e+2]=h,a[e+3]=c}t.putImageData(i,0,0)}(z),r&&(z.lineWidth=.4,z.strokeStyle="red",z.rect(0,0,Vt,Vt),z.stroke()),T.transferToImageBitmap()}function te(t){return new Promise(((n,i)=>{const{urlTemplate:s,x:o,y:h,z:c,maxAvailableZoom:f,projection:l,zoomOffset:d,errorLog:g,debug:p,returnBlobURL:m}=t,b=f&&e(f)&&f>=1;if(!l)return void i(r("not find projection"));if(-1===Wt.indexOf(l))return void i(r("not support projection:"+l+".the support:"+Wt.join(",").toString()));if(!b)return void i(r("maxAvailableZoom is error"));if(!s)return void i(r("urlTemplate is error"));if(!e(o)||!e(h)||!e(c))return void i(r("x/y/z is error"));const y=t=>{m?z(t).then((t=>{const e=URL.createObjectURL(t);n(e)})).catch((t=>{i(t)})):n(t)};(()=>{let e;"EPSG:4326"===l?e=function(t,e,r,n=0){n=n||0;const[i,s]=qt,o=Xt(r)*Vt,h=Kt.bbox(t,e,r),[c,f,l,u]=h;let d=(c-i)/o,g=(l-i)/o,p=(s-u)/o,m=(s-f)/o;if(d=Math.floor(d),g=Math.floor(g),p=Math.floor(p),m=Math.floor(m),g<d||m<p)return;const b=[];for(let t=p;t<=m;t++)for(let e=d;e<=g;e++)b.push([e-1,t,r+n]);return{tiles:b,tilesbbox:[i+(d-1)*o,s-(m+1)*o,i+g*o,s-p*o],bbox:h,mbbox:Nt(Pt(h).map((t=>a(t)))),x:t,y:e,z:r}}(o,h,c,d||0):"EPSG:3857"===l&&(e=Jt(o,h,c,d||0));const{tiles:r}=e||{};if(!r||0===r.length)return void y(E());e.loadCount=0;const n=()=>{if(e.loadCount>=r.length){const t=function(t,e){let r=1/0,n=1/0,i=-1/0,a=-1/0,s=256;t.forEach((t=>{const[e,o]=t;r=Math.min(e,r),n=Math.min(o,n),i=Math.max(e,i),a=Math.max(o,a),s=t.tileImage.width}));const o=(i-r+1)*s,h=(a-n+1)*s,c=x();I(c,o,h);const f=k(c);return e&&(f.font="bold 48px serif",f.textAlign="center",f.textBaseline="middle",f.fillStyle="red"),t.forEach((t=>{const[i,a,o]=t,h=(i-r)*s,c=(a-n)*s;let l=t.tileImage;f.drawImage(l,h,c,s,s),e&&f.fillText([i,a,o].join("_").toString(),h+100,c+100)})),u(t.map((t=>t.tileImage))),c.transferToImageBitmap()}(r,p);let n;if("EPSG:4326"===l){n=$t(Qt(t,e.tilesbbox,e.bbox,l),e.mbbox,p),y(n||E())}else{n=$t(Qt(t,e.tilesbbox,e.mbbox,l),e.bbox,p),y(n||E())}}else{const i=r[e.loadCount],[a,s,o]=i;bt(Object.assign({},t,{x:a,y:s,z:o,returnBlobURL:!1})).then((t=>{i.tileImage=t,e.loadCount++,n()})).catch((t=>{g&&console.error(t),i.tileImage=E(),e.loadCount++,n()}))}};n()})()}))}function ee(t){const e=[];return l(t)&&e.push(t),e}t.initialize=function(){},t.onmessage=function(t,e){const a=t.data||{},o=a._type;if("getTile"===o){const{url:t}=a;return void function(t,e){return new Promise(((a,s)=>{if(!t)return void s(r("url is null"));const o=n(t),h=Object.assign({},c,e.headers||{}),f=o.map((t=>mt(t,h,e))),{returnBlobURL:l,globalCompositeOperation:u}=e;Promise.all(f).then((t=>{const r=x();if(!r)return void s(i);const n=U(t,u);if(n instanceof Error)return void s(n);const o=N(P(r,B(r,n,e.filter),e.gaussianBlurRadius),e.opacity);l?z(o).then((t=>{const e=URL.createObjectURL(t);a(e)})).catch((t=>{s(t)})):a(o)})).catch((t=>{s(t)}))}))}(t,a).then((t=>{e(null,t,ee(t))})).catch((t=>{e(t)}))}if("getTileWithMaxZoom"===o)return void bt(a).then((t=>{e(null,t,ee(t))})).catch((t=>{e(t)}));if("clipTile"===o)return void(h=a,new Promise(((t,e)=>{const{tile:n,tileBBOX:a,projection:s,tileSize:o,maskId:c,returnBlobURL:f,reverse:l}=h;if(!n)return void e(r("tile is null.It should be a ImageBitmap"));if(!a)return void e(r("tileBBOX is null"));if(!s)return void e(r("projection is null"));if(!o)return void e(r("tileSize is null"));if(!c)return void e(r("maskId is null"));const u=Ot[c];if(!u)return void e(r("not find mask by maskId:"+c));const d=x(o);if(!d)return void e(i);const g=r=>{f?z(r).then((e=>{const r=URL.createObjectURL(e);t(r)})).catch((t=>{e(t)})):t(r)},p=u.bbox;if(!p)return void g(n);const{coordinates:m,type:b}=u.geometry;if(!m.length)return void g(n);const y=()=>{g(l?n:E(o))};if(w=a,(v=p)[2]<w[0]||v[1]>w[3]||v[0]>w[2]||v[3]<w[1])return void y();var v,w;let M,A=m;if("Polygon"===b&&(A=[A]),function(t,e){const[r,n,i,a]=t;return r>=e[0]&&i<=e[2]&&n>=e[1]&&a<=e[3]}(p,a)){M=Rt(s,A);const t=T(d,Ct(s,a,o,M),n,l);return void g(t)}const I=t=>{if(t.length>0){let e=1/0,r=-1/0,n=1/0,i=-1/0;for(let a=0,s=t.length;a<s;a++){const[s,o]=t[a];e=Math.min(s,e),n=Math.min(o,n),r=Math.max(s,r),i=Math.max(o,i)}if(e!==r&&n!==i)return!0}return!1},k=[];for(let t=0,e=A.length;t<e;t++){const e=A[t];for(let t=0,r=e.length;t<r;t++){const r=e[t],n=Ut.polygon(r,a);I(n)&&k.push([n])}}if(0===k.length)return void y();M=Rt(s,k);const U=T(d,Ct(s,a,o,M),n,l);g(U)}))).then((t=>{e(null,t,ee(t))})).catch((t=>{e(t)}));var h,d;if("transformTile"===o)return void te(a).then((t=>{e(null,t,ee(t))})).catch((t=>{e(t)}));if("injectMask"===o){const t=St(a.maskId,a.geojsonFeature);return t instanceof Error?void e(t):void e()}if("removeMask"===o)return d=a.maskId,delete Ot[d],void e();if("cancelFetch"===o){const t=a.taskId||a.__taskId;return t?(function(t){const e=dt[t]||[];e.length&&e.forEach((t=>{t.abort(s)})),delete dt[t]}(t),void e()):void e(r("cancelFetch need taskId"))}if("imageSlicing"===o)return void function(t){return t.disableCache=!0,new Promise(((e,a)=>{const{url:s}=t;if(!s)return void a(r("url is null"));const o=n(s),h=Object.assign({},c,t.headers||{}),l=o.map((e=>mt(e,h,t)));Promise.all(l).then((r=>{const n=x(vt);if(!n)return void a(i);const s=U(r);if(s instanceof Error)return void a(s);const{width:o,height:h}=s,c=Math.ceil(h/vt),l=Math.ceil(o/vt),d=[];for(let e=1;e<=c;e++){const r=(e-1)*vt,i=Math.min(h,e*vt);for(let a=1;a<=l;a++){const h=(a-1)*vt,c=Math.min(o,a*vt)-h,l=i-r;I(n,c,l),k(n).drawImage(s,h,r,c,l,0,0,n.width,n.height);const u=n.transferToImageBitmap(),g=N(P(n,B(n,u,t.filter),t.gaussianBlurRadius),t.opacity);d.push({id:(f++,f),x:h,y:r,width:c,height:l,row:e,col:a,image:g})}}const g={rows:c,cols:l,rowWidth:vt,colsHeight:vt,width:o,height:h,items:d};u(s),e(g)})).catch((t=>{a(t)}))}))}(a).then((t=>{const r=[];(t.items||[]).forEach((t=>{l(t.image)&&r.push(t.image)})),e(null,t,r)})).catch((t=>{e(t)}));if("imageToBlobURL"===o)return void wt(a).then((t=>{e(null,t,[])})).catch((t=>{e(t)}));if("encodeTerrainTile"===o){const{url:t}=a;return void yt(t,a).then((t=>{e(null,t,ee(t))})).catch((t=>{e(t)}))}const g="not support message type:"+o;console.error(g),e(r(g))},Object.defineProperty(t,"__esModule",{value:!0})})`
