export default `(function(t){"use strict";function e(t){return"number"==typeof t}function n(t){return new Error(t)}function r(t){return Array.isArray(t)?t:[t]}const o=n("not find canvas.The current environment does not support OffscreenCanvas");function i(t){const[e,n]=t,r=6378137,o=e*Math.PI/180*r,i=n*Math.PI/180;return[o,3189068.5*Math.log((1+Math.sin(i))/(1-Math.sin(i)))]}const a=n("fetch tile data cancel"),s=n("fetch tile data timeout");function h(t){return"EPSG:3857"===t}const c={accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.26"};let l=0;function u(t){return t&&t instanceof ImageBitmap}function f(t){Array.isArray(t)||(t=[t]),t.forEach((t=>{t&&t.close&&t.close()}))}var m,d,g,p,M,b;function x(t,e,n,r,o,i){var a,s,h,c,l,u,f,m,d,g,p,M,b,x,v,I,w,y,z,P,B,T,A,k,E,R,O,C,j,S;for(E=0;E<i;E++){for(A=E,k=0,h=(a=t[T=E*o])>>8&255,c=a>>16&255,l=a>>24&255,x=y=(s=255&a)*r[6],v=z=h*r[6],I=P=c*r[6],w=B=l*r[6],O=r[0],C=r[1],j=r[4],S=r[5],R=0;R<o;R++)g=(u=255&(a=t[T]))*O+s*C+x*j+y*S,p=(f=a>>8&255)*O+h*C+v*j+z*S,M=(m=a>>16&255)*O+c*C+I*j+P*S,b=(d=a>>24&255)*O+l*C+w*j+B*S,y=x,z=v,P=I,B=w,x=g,v=p,I=M,w=b,s=u,h=f,c=m,l=d,n[k]=x,n[k+1]=v,n[k+2]=I,n[k+3]=w,k+=4,T++;for(k-=4,A+=i*(o-1),h=(a=t[--T])>>8&255,c=a>>16&255,l=a>>24&255,x=y=(s=255&a)*r[7],v=z=h*r[7],I=P=c*r[7],w=B=l*r[7],u=s,f=h,m=c,d=l,O=r[2],C=r[3],R=o-1;R>=0;R--)g=u*O+s*C+x*j+y*S,p=f*O+h*C+v*j+z*S,M=m*O+c*C+I*j+P*S,b=d*O+l*C+w*j+B*S,y=x,z=v,P=I,B=w,x=g,v=p,I=M,w=b,s=u,h=f,c=m,l=d,u=255&(a=t[T]),f=a>>8&255,m=a>>16&255,d=a>>24&255,a=(n[k]+x|0)+(n[k+1]+v<<8)+(n[k+2]+I<<16)+(n[k+3]+w<<24),e[A]=a,T--,k-=4,A-=i}}var v=function(t,e,n,r){if(r){var o=new Uint32Array(t.buffer),i=new Uint32Array(o.length),a=new Float32Array(4*Math.max(e,n)),s=function(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,n=Math.exp(-e),r=Math.exp(-2*e),o=(1-n)*(1-n)/(1+2*e*n-r);return m=o,d=o*(e-1)*n,g=o*(e+1)*n,p=-o*r,M=2*n,b=-r,new Float32Array([m,d,g,p,M,b,(m+d)/(1-M-b),(g+p)/(1-M-b)])}(r);x(o,i,a,s,e,n),x(i,o,a,s,n,e)}};let I;function w(t=256){return!I&&OffscreenCanvas&&(I=new OffscreenCanvas(1,1)),I&&y(I,t,t),I}function y(t,e,n){t&&(t.width=e,t.height=n)}function z(t){const e=t.getContext("2d",{willReadFrequently:!0});return function(t){const e=t.canvas;t.clearRect(0,0,e.width,e.height)}(e),e}function P(t){const e=w(t);return z(e),e.transferToImageBitmap()}function B(t){if(1===t.length)return t[0];if(0===t.length)return n("merge tiles error,not find imagebitmaps");for(let e=0,r=t.length;e<r;e++){if(!u(t[e]))return n("merge tiles error,images not imagebitmap")}const e=t[0].width,r=w(e),o=z(r);return t.forEach((t=>{o.drawImage(t,0,0,e,e)})),f(t),r.transferToImageBitmap()}function T(t,e,n,r){const o=z(t);o.save();o.beginPath(),r&&o.rect(0,0,t.width,t.height),e.forEach((t=>{(t=>{for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n[0],i=n[n.length-1],[a,s]=r,[h,c]=i;a===h&&s===c||n.push(r);for(let t=0,e=n.length;t<e;t++){const[e,r]=n[t];0===t?o.moveTo(e,r):o.lineTo(e,r)}}})(t)})),o.clip("evenodd"),o.drawImage(n,0,0,t.width,t.height);const i=t.transferToImageBitmap();return o.restore(),f(n),i}function A(t){const e=w();y(e,t.width,t.height);return z(e).drawImage(t,0,0),f(t),e.convertToBlob()}function k(t,e,n){if(!n)return e;y(t,e.width,e.height);const r=z(t);r.save(),r.filter=n,r.drawImage(e,0,0),r.restore();const o=t.transferToImageBitmap();return f(e),o}function E(t,n,r){if(!e(r)||r<=0)return n;y(t,n.width,n.height);const o=z(t);o.drawImage(n,0,0);const i=o.getImageData(0,0,t.width,t.height);v(i.data,t.width,t.height,r),o.putImageData(i,0,0);const a=t.transferToImageBitmap();return f(n),a}function R(t,n=1){if(!e(n)||1===n||n<0||n>1)return t;const r=w();y(r,t.width,t.height);const o=z(r);o.globalAlpha=n,o.drawImage(t,0,0);const i=r.transferToImageBitmap();return o.globalAlpha=1,f(t),i}const O=()=>{};const C=new class{constructor(t,e){this.max=t,this.onRemove=e||O,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):(this.data.set(t,e),this.data.size>this.max&&this.shrink()),this):this}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const r of n)t[e++]=r;return t}shrink(){const t=this.data.keys();let e=t.next();for(;this.data.size>this.max;){const n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){if(!this.has(t))return null;return this.data.get(t)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.data.size>this.max&&this.shrink(),this}}(200,(t=>{f(t)}));const j={};function S(t){const e=[];for(let n in j){const r=j[n]||[];if(r.length){const e=r.indexOf(t);e>-1&&r.splice(e,1)}0===r.length&&e.push(n)}e.forEach((t=>{delete j[t]}))}function L(t,r={},o){return new Promise(((i,a)=>{const h=t=>{createImageBitmap(t).then((t=>{i(t)})).catch((t=>{a(t)}))},c=o.__taskId;if(!c)return void a(n("taskId is null"));const l=C.get(t);if(l)h(l);else{const n=o.fetchOptions||{headers:r,referrer:o.referrer},i=o.timeout||0,l=new AbortController,u=l.signal;i&&e(i)&&i>0&&setTimeout((()=>{l.abort(s)}),i),n.signal=u,delete n.timeout,function(t,e){j[t]=j[t]||[],j[t].push(e)}(c,l),fetch(t,n).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((e=>{!0!==o.disableCache&&C.add(t,e),S(l),h(e)})).catch((t=>{S(l),a(t)}))}}))}function N(t){const{urlTemplate:i,x:a,y:s,z:h,maxAvailableZoom:l,subdomains:u,returnBlobURL:m}=t,d=l&&e(l)&&l>=1;return new Promise(((g,p)=>{if(!d)return void p(n("maxAvailableZoom is error"));if(!i)return void p(n("urlTemplate is error"));if(!e(a)||!e(s)||!e(h))return void p(n("x/y/z is error"));const M=r(i);for(let t=0,e=M.length;t<e;t++){const e=M[t];if(e&&e.indexOf("{s}")>-1&&(!u||0===u.length))return void p(n("not find subdomains"))}let b,x,v,I,P=a,T=s,O=h;const C=h-l;if(C>0){let t=a,e=s,n=h;for(;n>l;)t=Math.floor(t/2),e=Math.floor(e/2),n--;const r=Math.pow(2,C);let o=Math.floor(t*r),i=o+r,c=Math.floor(e*r),u=c+r;o>a&&(o--,i--),c>s&&(c--,u--),b=(a-o)/(i-o),x=(s-c)/(u-c),v=1/(i-o),I=1/(u-c),P=t,T=e,O=l}const j=M.map((t=>{let e="{x}";for(;t.indexOf(e)>-1;)t=t.replace(e,P);for(e="{y}";t.indexOf(e)>-1;)t=t.replace(e,T);for(e="{z}";t.indexOf(e)>-1;)t=t.replace(e,O);return function(t,e){if(!e||!e.length)return t;const n=e.length;let r=Math.floor(Math.random()*n);for(r=Math.min(r,n-1);t.indexOf("{s}")>-1;)t=t.replace("{s}",e[r]);return t}(t,u)})),S=Object.assign({},c,t.headers||{}),N=j.map((e=>L(e,S,t)));Promise.all(N).then((e=>{const n=w();if(!n)return void p(o);const r=B(e);if(r instanceof Error)return void p(r);const i=E(n,k(n,r,t.filter),t.gaussianBlurRadius);let a;if(C<=0)a=R(i,t.opacity);else{const{width:e,height:r}=i,o=function(t,e,n,r,o,i){y(t,e.width,e.height);const a=z(t);a.save(),a.drawImage(e,n,r,o,i,0,0,t.width,t.height),a.restore();const s=t.transferToImageBitmap();return f(e),s}(n,i,e*b,r*x,e*v,r*I);a=R(o,t.opacity)}m?A(a).then((t=>{const e=URL.createObjectURL(t);g(e)})).catch((t=>{p(t)})):g(a)})).catch((t=>{p(t)}))}))}const U=512;function Y(t){return new Promise(((e,n)=>{const r=t.debug,o=t.items,i=t._workerId,a=[];o.forEach(((t,s)=>{const h=new OffscreenCanvas(t.width,t.height);z(h).drawImage(t.image,0,0),r&&console.log("workerId:"+i+",image to blob url :"+(s+1)+"/"+o.length),h.convertToBlob().then((n=>{const r=URL.createObjectURL(n);t.url=r,a.push(1),f(t.image),delete t.image,a.length===o.length&&e(o)})).catch((t=>{console.error(t),n(t)}))}))}))}function _(t,e){F(t.geometry,e)}function F(t,e){if(t)switch(t.type){case"Point":G(t.coordinates,e);break;case"MultiPoint":case"LineString":D(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let n=0,r=t.length;n<r;n++)D(t[n],e)}(t.coordinates,e);break;case"Polygon":W(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let n=0,r=t.length;n<r;n++)W(t[n],e)}(t.coordinates,e);break;case"GeometryCollection":const n=t.geometries.length;for(let r=0;r<n;r++)F(t.geometries[r],e)}}function G(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function D(t,e){for(let n=0,r=t.length;n<r;n++)G(t[n],e)}function W(t,e){t.length&&D(t[0],e)}var Z=function(t){let e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const n=t.features.length;for(let r=0;r<n;r++)_(t.features[r],e);break;case"Feature":_(t,e);break;default:F(t,e)}return e},V=X;function X(t,e,n){var r,o,i,a,s,h=t.length,c=H(t[0],e),l=[];for(n||(n=[]),r=1;r<h;r++){for(o=t[r-1],a=s=H(i=t[r],e);;){if(!(c|a)){l.push(o),a!==s?(l.push(i),r<h-1&&(n.push(l),l=[])):r===h-1&&l.push(i);break}if(c&a)break;c?c=H(o=q(o,i,c,e),e):a=H(i=q(o,i,a,e),e)}c=s}return l.length&&n.push(l),n}function q(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function H(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function K(t){const[e,n,r,o]=t;return[[e,n],[r,n],[r,o],[e,o]]}function J(t){let e=1/0,n=1/0,r=-1/0,o=-1/0;return t.forEach((t=>{e=Math.min(e,t[0]),r=Math.max(r,t[0]),n=Math.min(n,t[1]),o=Math.max(o,t[1])})),[e,n,r,o]}X.polyline=X,X.polygon=function(t,e){var n,r,o,i,a,s,h;for(r=1;r<=8;r*=2){for(n=[],i=!(H(o=t[t.length-1],e)&r),a=0;a<t.length;a++)(h=!(H(s=t[a],e)&r))!==i&&n.push(q(o,s,r,e)),h&&n.push(s),o=s,i=h;if(!(t=n).length)break}return n};const Q={};function $(t,e){return function(t){if(!t)return!1;const e=(t.geometry||{type:null}).type;return"Polygon"===e||"MultiPolygon"===e}(e)?Q[t]?n("the"+t+" geojson Already exists"):(Q[t]=e,function(t){t.bbox=t.bbox||Z(t)}(e),e):n("geojson.feature is not Polygon")}function tt(t,e){if(h(t)){const t=e=>{const n=[];for(let r=0,o=e.length;r<o;r++){const o=e[r];Array.isArray(o[0])?n.push(t(o)):n[r]=i(o)}return n};return t(e)}return e}function et(t,e,n){const[r,o,i,a]=t,s=(i-r)/e,h=(a-o)/e,[c,l]=n;return[(c-r)/s,e-(l-o)/h]}function nt(t,e,n,r){const[o,a,s,c]=e,l=(t,e)=>{const r=[];for(let o=0,i=t.length;o<i;o++){const i=t[o];Array.isArray(i[0])?r.push(l(i,e)):r[o]=et(e,n,i)}return r};if(h(t)){const[t,e]=i([o,a]),[n,h]=i([s,c]);return l(r,[t,e,n,h])}return l(r,e)}const rt=Math.PI/180,ot=180/Math.PI,it=6378137,at=20037508.342789244,st="900913",ht={};function ct(t){return Number(t)===t&&t%1!=0}const lt=256,ut=[-180,90],ft=[-20037508.342787,20037508.342787],mt=["EPSG:4326","EPSG:3857"],dt=new class{#t;#e;#n;#r;#o;#i;constructor(t={}){if(this.#t=t.size||256,this.#e=t.antimeridian?2:1,!ht[this.#t]){let t=this.#t;const e=ht[this.#t]={};e.Bc=[],e.Cc=[],e.zc=[],e.Ac=[];for(let n=0;n<30;n++)e.Bc.push(t/360),e.Cc.push(t/(2*Math.PI)),e.zc.push(t/2),e.Ac.push(t),t*=2}this.#n=ht[this.#t].Bc,this.#r=ht[this.#t].Cc,this.#o=ht[this.#t].zc,this.#i=ht[this.#t].Ac}px(t,e){if(ct(e)){const n=this.#t*Math.pow(2,e),r=n/2,o=n/360,i=n/(2*Math.PI),a=n,s=Math.min(Math.max(Math.sin(rt*t[1]),-.9999),.9999);let h=r+t[0]*o,c=r+.5*Math.log((1+s)/(1-s))*-i;return h>a*this.#e&&(h=a*this.#e),c>a&&(c=a),[h,c]}{const n=this.#o[e],r=Math.min(Math.max(Math.sin(rt*t[1]),-.9999),.9999);let o=Math.round(n+t[0]*this.#n[e]),i=Math.round(n+.5*Math.log((1+r)/(1-r))*-this.#r[e]);return o>this.#i[e]*this.#e&&(o=this.#i[e]*this.#e),i>this.#i[e]&&(i=this.#i[e]),[o,i]}}ll(t,e){if(ct(e)){const n=this.#t*Math.pow(2,e),r=n/360,o=n/(2*Math.PI),i=n/2,a=(t[1]-i)/-o;return[(t[0]-i)/r,ot*(2*Math.atan(Math.exp(a))-.5*Math.PI)]}{const n=(t[1]-this.#o[e])/-this.#r[e];return[(t[0]-this.#o[e])/this.#n[e],ot*(2*Math.atan(Math.exp(n))-.5*Math.PI)]}}convert(t,e){return e===st?[...this.forward(t.slice(0,2)),...this.forward(t.slice(2,4))]:[...this.inverse(t.slice(0,2)),...this.inverse(t.slice(2,4))]}inverse(t){return[t[0]*ot/it,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/it)))*ot]}forward(t){const e=[it*t[0]*rt,it*Math.log(Math.tan(.25*Math.PI+.5*t[1]*rt))];return e[0]>at&&(e[0]=at),e[0]<-at&&(e[0]=-at),e[1]>at&&(e[1]=at),e[1]<-at&&(e[1]=-at),e}bbox(t,e,n,r,o){r&&(e=Math.pow(2,n)-1-e);const i=[t*this.#t,(+e+1)*this.#t],a=[(+t+1)*this.#t,e*this.#t],s=[...this.ll(i,n),...this.ll(a,n)];return o===st?this.convert(s,st):s}xyz(t,e,n,r){const o=r===st?this.convert(t,"WGS84"):t,i=[o[0],o[1]],a=[o[2],o[3]],s=this.px(i,e),h=this.px(a,e),c=[Math.floor(s[0]/this.#t),Math.floor((h[0]-1)/this.#t)],l=[Math.floor(h[1]/this.#t),Math.floor((s[1]-1)/this.#t)],u={minX:Math.min.apply(Math,c)<0?0:Math.min.apply(Math,c),minY:Math.min.apply(Math,l)<0?0:Math.min.apply(Math,l),maxX:Math.max.apply(Math,c),maxY:Math.max.apply(Math,l)};if(n){const t={minY:Math.pow(2,e)-1-u.maxY,maxY:Math.pow(2,e)-1-u.minY};u.minY=t.minY,u.maxY=t.maxY}return u}}({size:lt});function gt(t){return 1.40625/Math.pow(2,t)}function pt(t,e,n,r=0){r=r||0;const[o,i]=ft,a=(s=n,156543.03392804097/Math.pow(2,s)*lt);var s;const h=function(t,e,n){const[r,o]=ut,i=gt(n)*lt;let a=t,s=e;return a=Math.floor(a),s=Math.floor(s),[r+a*i,s*i-o,r+(a+1)*i,(s+1)*i-o]}(t,e,n),c=J(K(h).map((t=>dt.forward(t)))),[l,u,f,m]=c;let d=(l-o)/a,g=(f-o)/a,p=(i-m)/a,M=(i-u)/a;if(d=Math.floor(d),g=Math.floor(g),p=Math.floor(p),M=Math.floor(M),g<d||M<p)return;const b=[];for(let t=p;t<=M;t++)for(let e=d;e<=g;e++)b.push([e,t,n+r]);const x=b.map((t=>{const[e,n,r]=t;return dt.bbox(e,n,r,!1,"900913")})),[v,I,w,y]=function(t){let e=1/0,n=1/0,r=-1/0,o=-1/0;return t.forEach((t=>{const[i,a,s,h]=t;e=Math.min(e,i),r=Math.max(r,s),n=Math.min(n,a),o=Math.max(o,h)})),[e,n,r,o]}(x);return{tiles:b,tilesbbox:[v,I,w,y],bbox:h,mbbox:c,x:t,y:e,z:n}}function Mt(t,e,n,r){const{width:o,height:i}=t,[a,s,h,c]=e,l=(h-a)/o,u=(c-s)/i;let[m,d,g,p]=n;m-=l,g+=l,d-=u,p+=u;let M=(m-a)/l,b=(c-p)/u,x=(g-a)/l,v=(c-d)/u;M=Math.floor(M),b=Math.floor(b),x=Math.ceil(x),v=Math.ceil(v);const I=x-M,P=v-b,B=w();y(B,I,P);const T=z(B);T.drawImage(t,M,b,I,P,0,0,I,P),f(t);const A=T.getImageData(0,0,I,P).data,k=[];let E=1/0,R=1/0,O=-1/0,C=-1/0,j=-1;const S="EPSG:4326"===r?dt.forward:dt.inverse;for(let t=1;t<=P;t++){const e=p-(t-1)*u,n=e-u;for(let r=1;r<=I;r++){const o=(t-1)*I*4+4*(r-1),i=A[o],a=A[o+1],s=A[o+2],h=A[o+3],c=m+(r-1)*l,u=S([c,e]);E=Math.min(E,u[0]),O=Math.max(O,u[0]),R=Math.min(R,u[1]),C=Math.max(C,u[1]);const f=[c,n];k[++j]={point:u,point1:S(f),r:i,g:a,b:s,a:h}}}return{pixels:k,bbox:[E,R,O,C],width:I,height:P,image:B.transferToImageBitmap()}}function bt(t,e,n){const[r,o,i,a]=e,s=(i-r)/lt,h=(a-o)/lt,{pixels:c,bbox:l}=t,[u,f,m,d]=l;let g=(m-u)/s,p=(d-f)/h;if(g=Math.round(g),p=Math.round(p),isNaN(g)||isNaN(p)||0===Math.min(g,p)||Math.abs(g)===1/0||Math.abs(p)===1/0)return;const M=w();y(M,g,p);const b=z(M);function x(t,e){let n=Math.round((t-u)/s+1);n=Math.min(n,g);let r=Math.round((d-e)/h+1);return r=Math.min(r,p),[n,r]}const v=b.createImageData(g,p),I=v.data;for(let t=0,e=c.length;t<e;t++){const{point:e,point1:n,r:r,g:o,b:i,a:a}=c[t],[s,h]=e,[l,u]=n,[f,m]=x(s,h),[d,p]=x(l,u);for(let t=m;t<=p;t++){const e=(t-1)*g*4+4*(f-1);I[e]=r,I[e+1]=o,I[e+2]=i,I[e+3]=a}}b.putImageData(v,0,0);const P=M.transferToImageBitmap(),B=Math.round((r-u)/s),T=Math.round((d-a)/h),A=w();y(A,lt,lt);const k=z(M);return k.drawImage(P,B-1,T,lt,lt,0,0,lt,lt),function(t){const e=t.canvas,{width:n,height:r}=e,o=t.getImageData(0,0,n,r),i=o.data,a=()=>{for(let t=1;t<=r;t++){if(i[4*n*(t-1)+0+3]>0)return!1}return!0},s=()=>{for(let t=1;t<=n;t++){if(i[4*(t-1)+(r-1)*n*4+3]>0)return!1}return!0};if(a())for(let t=1;t<=r;t++){const e=4*n*(t-1)+0,r=e+4,o=i[r],a=i[r+1],s=i[r+2],h=i[r+3];i[e]=o,i[e+1]=a,i[e+2]=s,i[e+3]=h}if(s())for(let t=1;t<=n;t++){const e=4*(t-1)+(r-1)*n*4,o=4*(t-1)+(r-2)*n*4,a=i[o],s=i[o+1],h=i[o+2],c=i[o+3];i[e]=a,i[e+1]=s,i[e+2]=h,i[e+3]=c}t.putImageData(o,0,0)}(k),n&&(k.lineWidth=.4,k.strokeStyle="red",k.rect(0,0,lt,lt),k.stroke()),A.transferToImageBitmap()}function xt(t){return new Promise(((r,o)=>{const{urlTemplate:a,x:s,y:h,z:c,maxAvailableZoom:l,projection:u,zoomOffset:m,errorLog:d,debug:g,returnBlobURL:p}=t,M=l&&e(l)&&l>=1;if(!u)return void o(n("not find projection"));if(-1===mt.indexOf(u))return void o(n("not support projection:"+u+".the support:"+mt.join(",").toString()));if(!M)return void o(n("maxAvailableZoom is error"));if(!a)return void o(n("urlTemplate is error"));if(!e(s)||!e(h)||!e(c))return void o(n("x/y/z is error"));const b=t=>{p?A(t).then((t=>{const e=URL.createObjectURL(t);r(e)})).catch((t=>{o(t)})):r(t)};(()=>{let e;"EPSG:4326"===u?e=function(t,e,n,r=0){r=r||0;const[o,a]=ut,s=gt(n)*lt,h=dt.bbox(t,e,n),[c,l,u,f]=h;let m=(c-o)/s,d=(u-o)/s,g=(a-f)/s,p=(a-l)/s;if(m=Math.floor(m),d=Math.floor(d),g=Math.floor(g),p=Math.floor(p),d<m||p<g)return;const M=[];for(let t=g;t<=p;t++)for(let e=m;e<=d;e++)M.push([e-1,t,n+r]);return{tiles:M,tilesbbox:[o+(m-1)*s,a-(p+1)*s,o+d*s,a-g*s],bbox:h,mbbox:J(K(h).map((t=>i(t)))),x:t,y:e,z:n}}(s,h,c,m||0):"EPSG:3857"===u&&(e=pt(s,h,c,m||0));const{tiles:n}=e||{};if(!n||0===n.length)return void b(P());e.loadCount=0;const r=()=>{if(e.loadCount>=n.length){const t=function(t,e){let n=1/0,r=1/0,o=-1/0,i=-1/0,a=256;t.forEach((t=>{const[e,s]=t;n=Math.min(e,n),r=Math.min(s,r),o=Math.max(e,o),i=Math.max(s,i),a=t.tileImage.width}));const s=(o-n+1)*a,h=(i-r+1)*a,c=w();y(c,s,h);const l=z(c);return e&&(l.font="bold 48px serif",l.textAlign="center",l.textBaseline="middle",l.fillStyle="red"),t.forEach((t=>{const[o,i,s]=t,h=(o-n)*a,c=(i-r)*a;let u=t.tileImage;l.drawImage(u,h,c,a,a),e&&l.fillText([o,i,s].join("_").toString(),h+100,c+100)})),f(t.map((t=>t.tileImage))),c.transferToImageBitmap()}(n,g);let r;if("EPSG:4326"===u){r=bt(Mt(t,e.tilesbbox,e.bbox,u),e.mbbox,g),b(r||P())}else{r=bt(Mt(t,e.tilesbbox,e.mbbox,u),e.bbox,g),b(r||P())}}else{const o=n[e.loadCount],[i,a,s]=o;N(Object.assign({},t,{x:i,y:a,z:s,returnBlobURL:!1})).then((t=>{o.tileImage=t,e.loadCount++,r()})).catch((t=>{d&&console.error(t),o.tileImage=P(),e.loadCount++,r()}))}};r()})()}))}function vt(t){const e=[];return u(t)&&e.push(t),e}t.initialize=function(){},t.onmessage=function(t,e){const i=t.data||{},s=i._type;if("getTile"===s){const{url:t}=i;return void function(t,e){return new Promise(((i,a)=>{if(!t)return void a(n("url is null"));const s=r(t),h=Object.assign({},c,e.headers||{}),l=s.map((t=>L(t,h,e))),{returnBlobURL:u}=e;Promise.all(l).then((t=>{const n=w();if(!n)return void a(o);const r=B(t);if(r instanceof Error)return void a(r);const s=R(E(n,k(n,r,e.filter),e.gaussianBlurRadius),e.opacity);u?A(s).then((t=>{const e=URL.createObjectURL(t);i(e)})).catch((t=>{a(t)})):i(s)})).catch((t=>{a(t)}))}))}(t,i).then((t=>{e(null,t,vt(t))})).catch((t=>{e(t)}))}if("getTileWithMaxZoom"===s)return void N(i).then((t=>{e(null,t,vt(t))})).catch((t=>{e(t)}));if("clipTile"===s)return void(h=i,new Promise(((t,e)=>{const{tile:r,tileBBOX:i,projection:a,tileSize:s,maskId:c,returnBlobURL:l,reverse:u}=h;if(!r)return void e(n("tile is null.It should be a ImageBitmap"));if(!i)return void e(n("tileBBOX is null"));if(!a)return void e(n("projection is null"));if(!s)return void e(n("tileSize is null"));if(!c)return void e(n("maskId is null"));const f=Q[c];if(!f)return void e(n("not find mask by maskId:"+c));const m=w(s);if(!m)return void e(o);const d=n=>{l?A(n).then((e=>{const n=URL.createObjectURL(e);t(n)})).catch((t=>{e(t)})):t(n)},g=f.bbox;if(!g)return void d(r);const{coordinates:p,type:M}=f.geometry;if(!p.length)return void d(r);const b=()=>{d(u?r:P(s))};if(v=i,(x=g)[2]<v[0]||x[1]>v[3]||x[0]>v[2]||x[3]<v[1])return void b();var x,v;let I,y=p;if("Polygon"===M&&(y=[y]),function(t,e){const[n,r,o,i]=t;return n>=e[0]&&o<=e[2]&&r>=e[1]&&i<=e[3]}(g,i)){I=tt(a,y);const t=T(m,nt(a,i,s,I),r,u);return void d(t)}const z=t=>{if(t.length>0){let e=1/0,n=-1/0,r=1/0,o=-1/0;for(let i=0,a=t.length;i<a;i++){const[a,s]=t[i];e=Math.min(a,e),r=Math.min(s,r),n=Math.max(a,n),o=Math.max(s,o)}if(e!==n&&r!==o)return!0}return!1},B=[];for(let t=0,e=y.length;t<e;t++){const e=y[t];for(let t=0,n=e.length;t<n;t++){const n=e[t],r=V.polygon(n,i);z(r)&&B.push([r])}}if(0===B.length)return void b();I=tt(a,B);const k=T(m,nt(a,i,s,I),r,u);d(k)}))).then((t=>{e(null,t,vt(t))})).catch((t=>{e(t)}));var h,m;if("transformTile"===s)return void xt(i).then((t=>{e(null,t,vt(t))})).catch((t=>{e(t)}));if("injectMask"===s){const t=$(i.maskId,i.geojsonFeature);return t instanceof Error?void e(t):void e()}if("removeMask"===s)return m=i.maskId,delete Q[m],void e();if("cancelFetch"===s){const t=i.taskId||i.__taskId;return t?(function(t){const e=j[t]||[];e.length&&e.forEach((t=>{t.abort(a)})),delete j[t]}(t),void e()):void e(n("cancelFetch need taskId"))}if("imageSlicing"===s)return void function(t){return t.disableCache=!0,new Promise(((e,i)=>{const{url:a}=t;if(!a)return void i(n("url is null"));const s=r(a),h=Object.assign({},c,t.headers||{}),u=s.map((e=>L(e,h,t)));Promise.all(u).then((n=>{const r=w(U);if(!r)return void i(o);const a=B(n);if(a instanceof Error)return void i(a);const{width:s,height:h}=a,c=Math.ceil(h/U),u=Math.ceil(s/U),m=[];for(let e=1;e<=c;e++){const n=(e-1)*U,o=Math.min(h,e*U);for(let i=1;i<=u;i++){const h=(i-1)*U,c=Math.min(s,i*U)-h,u=o-n;y(r,c,u),z(r).drawImage(a,h,n,c,u,0,0,r.width,r.height);const f=r.transferToImageBitmap(),d=R(E(r,k(r,f,t.filter),t.gaussianBlurRadius),t.opacity);m.push({id:(l++,l),x:h,y:n,width:c,height:u,row:e,col:i,image:d})}}const d={rows:c,cols:u,rowWidth:U,colsHeight:U,width:s,height:h,items:m};f(a),e(d)})).catch((t=>{i(t)}))}))}(i).then((t=>{const n=[];(t.items||[]).forEach((t=>{u(t.image)&&n.push(t.image)})),e(null,t,n)})).catch((t=>{e(t)}));if("imageToBlobURL"===s)return void Y(i).then((t=>{e(null,t,[])})).catch((t=>{e(t)}));const d="not support message type:"+s;console.error(d),e(n(d))},Object.defineProperty(t,"__esModule",{value:!0})})`
